(self.webpackChunkTP_Comanda=self.webpackChunkTP_Comanda||[]).push([[7556],{2965:(e,t,n)=>{"use strict";n.d(t,{nm:()=>N});var r=n(6643);n(3018),n(2329);var i=n(5452),s=n(6034),o=n(3854),a=n(5601);const c=new Map,u={activated:!1,tokenObservers:[]},h={initialized:!1,enabled:!1};function l(e){return c.get(e)||u}function d(e,t){c.set(e,t)}function f(){return h}class p{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new o.BH,await(t=this.getNextRun(e),new Promise(e=>{setTimeout(e,t)})),this.pending.resolve(),await this.pending.promise,this.pending=new o.BH,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(n){this.retryPolicy(n)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}const g=new o.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error."}),m="firebase-app-check-store";let y=null;const v=new a.Yd("@firebase/app-check");function w(e,t){return(0,o.hl)()?function(e,t){return async function(e,t){const n=(await(y||(y=new Promise((e,t)=>{try{const n=indexedDB.open("firebase-app-check-database",1);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(g.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(m,{keyPath:"compositeKey"})}}}catch(n){t(g.create("storage-open",{originalErrorMessage:n.message}))}}),y))).transaction(m,"readwrite"),r=n.objectStore(m).put({compositeKey:e,value:t});return new Promise((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(g.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})}(function(e){return`${e.options.appId}-${e.name}`}(e),t)}(e,t).catch(e=>{v.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}const I={error:"UNKNOWN_ERROR"};async function T(e,t=!1){const n=e.app;!function(e){if(!l(e).activated)throw g.create("use-before-activation",{appName:e.name})}(n);const r=l(n);let i,s,a=r.token;if(!a){const e=await r.cachedTokenPromise;e&&E(e)&&(a=e,d(n,Object.assign(Object.assign({},r),{token:a})),b(n,{token:a.token}))}if(!t&&a&&E(a))return{token:a.token};if(f().enabled){const t=await async function({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());const s={method:"POST",body:JSON.stringify(t),headers:r};let o,a;try{o=await fetch(e,s)}catch(l){throw g.create("fetch-network-error",{originalErrorMessage:l.message})}if(200!==o.status)throw g.create("fetch-status-error",{httpStatus:o.status});try{a=await o.json()}catch(l){throw g.create("fetch-parse-error",{originalErrorMessage:l.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw g.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const u=1e3*Number(c[1]),h=Date.now();return{token:a.attestationToken,expireTimeMillis:h+u,issuedAtTimeMillis:h}}(function(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1beta/projects/${n}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:t}}}(n,await async function(){const e=f();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}()),e.platformLoggerProvider);return await w(n,t),d(n,Object.assign(Object.assign({},r),{token:t})),{token:t.token}}try{a=await r.provider.getToken()}catch(c){v.error(c),i=c}return a?(s={token:a.token},d(n,Object.assign(Object.assign({},r),{token:a})),await w(n,a)):s=function(e){return{token:(t=I,o.US.encodeString(JSON.stringify(t),!1)),error:e};var t}(i),b(n,s),s}function _(e,t){const n=l(e),r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),d(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function b(e,t){const n=l(e).tokenObservers;for(const i of n)try{"EXTERNAL"===i.type&&null!=t.error?i.error(t.error):i.next(t)}catch(r){}}function E(e){return e.expireTimeMillis-Date.now()>0}class S{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){const{tokenObservers:e}=l(this.app);for(const t of e)_(this.app,t.next);return Promise.resolve()}}const k="app-check-internal";(0,i._registerComponent)(new s.wA("app-check",e=>{return t=e.getProvider("app").getImmediate(),n=e.getProvider("platform-logger"),new S(t,n);var t,n},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(k).initialize()})),(0,i._registerComponent)(new s.wA(k,e=>{return t=e.getProvider("app-check").getImmediate(),{getToken:e=>T(t,e),addTokenListener:e=>function(e,t,n,r){const{app:i}=e,s=l(i),o={next:n,error:void 0,type:"INTERNAL"},a=Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]});if(!a.tokenRefresher){const t=function(e){const{app:t}=e;return new p(async()=>{let n;if(n=l(t).token?await T(e,!0):await T(e),n.error)throw n.error},()=>!0,()=>{const e=l(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return t=Math.min(t,e.token.expireTimeMillis-3e5),Math.max(0,t-Date.now())}return 0},3e4,96e4)}(e);a.tokenRefresher=t}if(!a.tokenRefresher.isRunning()&&s.isTokenAutoRefreshEnabled&&a.tokenRefresher.start(),s.token&&E(s.token)){const e=s.token;Promise.resolve().then(()=>n({token:e.token})).catch(()=>{})}else null==s.token&&s.cachedTokenPromise.then(e=>{e&&E(e)&&n({token:e.token})}).catch(()=>{});d(i,a)}(t,0,e),removeTokenListener:e=>_(t.app,e)};var t},"PUBLIC").setInstantiationMode("EXPLICIT")),(0,i.registerVersion)("@firebase/app-check","0.4.2");class N{constructor(){return(0,r.vb)("app-check")}}"undefined"!=typeof window&&window},8006:(e,t,n)=>{"use strict";n.d(t,{zQ:()=>O,rT:()=>R,f7:()=>P,L6:()=>A,_Q:()=>C,lh:()=>D,Qv:()=>N,nw:()=>x});var r=n(3018),i=n(9765),s=n(5917),o=n(7574),a=n(4402),c=n(6682),u=n(7771),h=n(5319),l=n(309),d=n(7971),f=n(8858);class p extends i.xQ{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){const t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new g(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){const t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;let s;if(this.closed)throw new d.N;if(this.isStopped||this.hasError?s=h.w.EMPTY:(this.observers.push(e),s=new f.W(this,e)),r&&e.add(e=new l.ht(e,r)),t)for(let o=0;o<i&&!e.closed;o++)e.next(n[o]);else for(let o=0;o<i&&!e.closed;o++)e.next(n[o].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),s}_getNow(){return(this.scheduler||u.c).now()}_trimBufferThenGetEvents(){const e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length;let s=0;for(;s<i&&!(e-r[s].time<n);)s++;return i>t&&(s=Math.max(s,i-t)),s>0&&r.splice(0,s),r}}class g{constructor(e,t){this.time=e,this.value=t}}function m(e,t,n){let r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n},e=>e.lift(function({bufferSize:e=Number.POSITIVE_INFINITY,windowTime:t=Number.POSITIVE_INFINITY,refCount:n,scheduler:r}){let i,s,o=0,a=!1,c=!1;return function(u){let h;o++,!i||a?(a=!1,i=new p(e,t,r),h=i.subscribe(this),s=u.subscribe({next(e){i.next(e)},error(e){a=!0,i.error(e)},complete(){c=!0,s=void 0,i.complete()}}),c&&(s=void 0)):h=i.subscribe(this),this.add(()=>{o--,h.unsubscribe(),h=void 0,s&&!c&&n&&0===o&&(s.unsubscribe(),s=void 0,i=void 0)})}}(r))}var y=n(3190);function v(e,t){return t?(0,y.w)(()=>e,t):(0,y.w)(()=>e)}var w=n(8002),I=n(8049),T=n(3101),_=n(5435),b=n(6643),E=n(8747),S=n(8583),k=n(2965);n(7841);const N=new r.OlP("angularfire2.auth.use-emulator"),A=new r.OlP("angularfire2.auth.settings"),C=new r.OlP("angularfire2.auth.tenant-id"),R=new r.OlP("angularfire2.auth.langugage-code"),D=new r.OlP("angularfire2.auth.use-device-language"),P=new r.OlP("angularfire.auth.persistence"),x=(e,t,n,r,i,s,o,a)=>(0,E.cc)(`${e.name}.auth`,"AngularFireAuth",e.name,()=>{const c=t.runOutsideAngular(()=>e.auth());if(n&&c.useEmulator(...n),r&&(c.tenantId=r),c.languageCode=i,s&&c.useDeviceLanguage(),o)for(const[e,t]of Object.entries(o))c.settings[e]=t;return a&&c.setPersistence(a),c},[n,r,i,s,o,a]);let O=(()=>{class e{constructor(e,t,r,u,h,d,f,p,g,k,N,A){const C=new i.xQ,R=(0,s.of)(void 0).pipe((0,l.QV)(h.outsideAngular),(0,y.w)(()=>u.runOutsideAngular(()=>Promise.resolve().then(n.bind(n,4671)))),(0,w.U)(()=>(0,E.on)(e,u,t)),(0,w.U)(e=>x(e,u,d,p,g,k,f,N)),m({bufferSize:1,refCount:!1}));if((0,S.PM)(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,s.of)(null);else{R.pipe((0,I.P)()).subscribe();const e=R.pipe((0,y.w)(e=>e.getRedirectResult().then(e=>e,()=>null)),b.iC,m({bufferSize:1,refCount:!1})),t=R.pipe((0,y.w)(e=>new o.y(t=>({unsubscribe:u.runOutsideAngular(()=>e.onAuthStateChanged(e=>t.next(e),e=>t.error(e),()=>t.complete()))})))),n=R.pipe((0,y.w)(e=>new o.y(t=>({unsubscribe:u.runOutsideAngular(()=>e.onIdTokenChanged(e=>t.next(e),e=>t.error(e),()=>t.complete()))}))));this.authState=e.pipe(v(t),(0,T.R)(h.outsideAngular),(0,l.QV)(h.insideAngular)),this.user=e.pipe(v(n),(0,T.R)(h.outsideAngular),(0,l.QV)(h.insideAngular)),this.idToken=this.user.pipe((0,y.w)(e=>e?(0,a.D)(e.getIdToken()):(0,s.of)(null))),this.idTokenResult=this.user.pipe((0,y.w)(e=>e?(0,a.D)(e.getIdTokenResult()):(0,s.of)(null))),this.credential=(0,c.T)(e,C,this.authState.pipe((0,_.h)(e=>!e))).pipe((0,w.U)(e=>(null==e?void 0:e.user)?e:null),(0,T.R)(h.outsideAngular),(0,l.QV)(h.insideAngular))}return(0,E.pX)(this,R,u,{spy:{apply:(e,t,n)=>{(e.startsWith("signIn")||e.startsWith("createUser"))&&n.then(e=>C.next(e))}}})}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(E.Dh),r.LFG(E.xv,8),r.LFG(r.Lbi),r.LFG(r.R0b),r.LFG(b.HU),r.LFG(N,8),r.LFG(A,8),r.LFG(C,8),r.LFG(R,8),r.LFG(D,8),r.LFG(P,8),r.LFG(k.nm,8))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"any"}),e})()},4671:(e,t,n)=>{"use strict";n.r(t);var r=n(4486),i=n(3854),s=n(5452),o=n(4762),a=n(5601),c=n(6034);const u=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},h=new i.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),l=new a.Yd("@firebase/auth");function d(e,...t){l.logLevel<=a.in.ERROR&&l.error(`Auth (${s.SDK_VERSION}): ${e}`,...t)}function f(e,...t){throw y(e,...t)}function p(e,...t){return y(e,...t)}function g(e,t,n){const r=Object.assign(Object.assign({},{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),{[t]:n});return new i.LL("auth","Firebase",r).create(t,{appName:e.name})}function m(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&f(e,"argument-error"),g(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function y(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return h.create(e,...t)}function v(e,t,...n){if(!e)throw y(t,...n)}function w(e){const t="INTERNAL ASSERTION FAILED: "+e;throw d(t),new Error(t)}function I(e,t){e||w(t)}const T=new Map;function _(e){I(e instanceof Function,"Expected a class definition");let t=T.get(e);return t?(I(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,T.set(e,t),t)}function b(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function E(){return"http:"===S()||"https:"===S()}function S(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class k{constructor(e,t){this.shortDelay=e,this.longDelay=t,I(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(E()||(0,i.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function N(e,t){I(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class A{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void w("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void w("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void w("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const C={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},R=new k(3e4,6e4);function D(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function P(e,t,n,r,s={}){return x(e,s,()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const a=(0,i.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),c=new(A.headers());return c.set("Content-Type","application/json"),c.set("X-Client-Version",e._getSdkClientVersion()),e.languageCode&&c.set("X-Firebase-Locale",e.languageCode),A.fetch()(L(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))})}async function x(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},C),t);try{const t=new M(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw F(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw F(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw F(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw g(e,a,o);f(e,a)}}catch(s){if(s instanceof i.ZR)throw s;f(e,"network-request-failed")}}async function O(e,t,n,r,i={}){const s=await P(e,t,n,r,i);return"mfaPendingCredential"in s&&f(e,"multi-factor-auth-required",{serverResponse:s}),s}function L(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?N(e.config,i):`${e.config.apiScheme}://${i}`}class M{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(p(this.auth,"timeout")),R.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function F(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=p(e,t,r);return i.customData._tokenResponse=n,i}function U(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function V(e){return 1e3*Number(e)}function q(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return d("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.tV)(n);return e?JSON.parse(e):(d("Failed to decode base64 JWT payload"),null)}catch(s){return d("Caught error parsing JWT payload as JSON",s),null}}async function B(e,t,n=!1){if(n)return t;try{return await t}catch(r){throw r instanceof i.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}class j{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class z{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=U(this.lastLoginAt),this.creationTime=U(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function K(e){var t;const n=e.auth,r=await e.getIdToken(),i=await B(e,async function(e,t){return P(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));v(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map(e=>{var{providerId:t}=e,n=(0,o._T)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],c=(u=a,[...e.providerData.filter(e=>!u.some(t=>t.providerId===e.providerId)),...u]);var u;const h=!!e.isAnonymous&&!(e.email&&s.passwordHash||(null==c?void 0:c.length)),l={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new z(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(e,l)}class ${constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=q(e);return v(t,"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return v(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await x(e,{},()=>{const n=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,o=L(e,r,"/v1/token",`key=${s}`);return A.fetch()(o,{method:"POST",headers:{"X-Client-Version":e._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new $;return n&&(v("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(v("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(v("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $,this.toJSON())}_performRefresh(){return w("not implemented")}}function G(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class W{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=(0,o._T)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new j(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.metadata=new z(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await B(this,this.stsTokenManager.getToken(this.auth,e));return v(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,i.m9)(e),r=await n.getIdToken(t),s=q(r);v(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:U(V(s.auth_time)),issuedAtTime:U(V(s.iat)),expirationTime:U(V(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.m9)(e);await K(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new W(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await K(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await B(this,async function(e,t){return P(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:w,emailVerified:I,isAnonymous:T,providerData:_,stsTokenManager:b}=t;v(w&&b,e,"internal-error");const E=$.fromJSON(this.name,b);v("string"==typeof w,e,"internal-error"),G(h,e.name),G(l,e.name),v("boolean"==typeof I,e,"internal-error"),v("boolean"==typeof T,e,"internal-error"),G(d,e.name),G(f,e.name),G(p,e.name),G(g,e.name),G(m,e.name),G(y,e.name);const S=new W({uid:w,auth:e,email:l,emailVerified:I,displayName:h,isAnonymous:T,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return _&&Array.isArray(_)&&(S.providerData=_.map(e=>Object.assign({},e))),g&&(S._redirectEventId=g),S}static async _fromIdTokenResponse(e,t,n=!1){const r=new $;r.updateFromServerResponse(t);const i=new W({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await K(i),i}}const H=(()=>{class e{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}return e.type="NONE",e})();function Q(e,t,n){return`firebase:${e}:${t}:${n}`}class J{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Q(this.userKey,r.apiKey,i),this.fullPersistenceKey=Q("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?W._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new J(_(H),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||_(H);const s=Q(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{const t=await u._get(s);if(t){const n=W._fromJSON(e,t);u!==i&&(o=n),i=u;break}}catch(c){}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(c){}})),new J(i,e,n)):new J(i,e,n)}}function Y(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(te(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(X(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(re(t))return"Blackberry";if(ie(t))return"Webos";if(Z(t))return"Safari";if((t.includes("chrome/")||ee(t))&&!t.includes("edge/"))return"Chrome";if(ne(t))return"Android";{const t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==t?void 0:t.length))return t[1]}return"Other"}function X(e=(0,i.z$)()){return/firefox\//i.test(e)}function Z(e=(0,i.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ee(e=(0,i.z$)()){return/crios\//i.test(e)}function te(e=(0,i.z$)()){return/iemobile/i.test(e)}function ne(e=(0,i.z$)()){return/android/i.test(e)}function re(e=(0,i.z$)()){return/blackberry/i.test(e)}function ie(e=(0,i.z$)()){return/webos/i.test(e)}function se(e=(0,i.z$)()){return/iphone|ipad|ipod/i.test(e)}function oe(e=(0,i.z$)()){return se(e)||ne(e)||ie(e)||re(e)||/windows phone/i.test(e)||te(e)}function ae(e,t=[]){let n;switch(e){case"Browser":n=Y((0,i.z$)());break;case"Worker":n=`${Y((0,i.z$)())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${s.SDK_VERSION}/${r}`}class ce{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new he(this),this.idTokenSubscription=new he(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=h,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=_(t)),this._initializationPromise=this.queue(async()=>{var n;this._deleted||(this.persistenceManager=await J.create(this,e),this._deleted||((null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)&&await this._popupRedirectResolver._initialize(this),await this.initializeCurrentUser(t),this._deleted||(this._isInitialized=!0)))}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e)):void 0}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==n?void 0:n._redirectEventId,s=await this.tryRedirectSignIn(e);r&&r!==i||!(null==s?void 0:s.user)||(n=s.user)}return n?n._redirectEventId?(v(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)):this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await K(e)}catch(t){if("auth/network-request-failed"!==t.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,i.m9)(e):null;return t&&v(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&v(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(_(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&_(e)||this._popupRedirectResolver;v(t,this,"argument-error"),this.redirectPersistenceManager=await J.create(this,[_(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return v(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ae(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}}function ue(e){return(0,i.m9)(e)}class he{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function le(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function de(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class fe{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return w("not implemented")}_getIdTokenResponse(e){return w("not implemented")}_linkToIdToken(e,t){return w("not implemented")}_getReauthenticationResolver(e){return w("not implemented")}}async function pe(e,t){return P(e,"POST","/v1/accounts:resetPassword",D(e,t))}async function ge(e,t){return P(e,"POST","/v1/accounts:update",t)}async function me(e,t){return P(e,"POST","/v1/accounts:sendOobCode",D(e,t))}class ye extends fe{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ye(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ye(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return O(e,"POST","/v1/accounts:signInWithPassword",D(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return O(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}(e,{email:this._email,oobCode:this._password});default:f(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ge(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return O(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:f(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ve(e,t){return O(e,"POST","/v1/accounts:signInWithIdp",D(e,t))}class we extends fe{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new we(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):f("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=(0,o._T)(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new we(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return ve(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ve(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ve(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}const Ie={USER_NOT_FOUND:"user-not-found"};class Te extends fe{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Te({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Te({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return O(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await O(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,t));if(n.temporaryProof)throw F(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return O(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ie)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Te({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class _e{constructor(e){var t,n,r,s,o,a;const c=(0,i.zd)((0,i.pd)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,h=null!==(n=c.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);v(u&&h&&l,"argument-error"),this.apiKey=u,this.operation=l,this.code=h,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.zd)((0,i.pd)(e)).link,n=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,r=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(r?(0,i.zd)((0,i.pd)(r)).link:null)||r||n||t||e}(e);try{return new _e(t)}catch(n){return null}}}let be=(()=>{class e{constructor(){this.providerId=e.PROVIDER_ID}static credential(e,t){return ye._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=_e.parseLink(t);return v(n,"argument-error"),ye._fromEmailAndCode(e,n.code,n.tenantId)}}return e.PROVIDER_ID="password",e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e.EMAIL_LINK_SIGN_IN_METHOD="emailLink",e})();class Ee{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Se extends Ee{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ke extends Se{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return v("providerId"in t&&"signInMethod"in t,"argument-error"),we._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return v(e.idToken||e.accessToken,"argument-error"),we._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return ke.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return ke.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new ke(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(a){return null}}}let Ne=(()=>{class e extends Se{constructor(){super("facebook.com")}static credential(t){return we._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return e.credential(t.oauthAccessToken)}catch(n){return null}}}return e.FACEBOOK_SIGN_IN_METHOD="facebook.com",e.PROVIDER_ID="facebook.com",e})(),Ae=(()=>{class e extends Se{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return we._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return e.credential(n,r)}catch(i){return null}}}return e.GOOGLE_SIGN_IN_METHOD="google.com",e.PROVIDER_ID="google.com",e})(),Ce=(()=>{class e extends Se{constructor(){super("github.com")}static credential(t){return we._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return e.credential(t.oauthAccessToken)}catch(n){return null}}}return e.GITHUB_SIGN_IN_METHOD="github.com",e.PROVIDER_ID="github.com",e})();class Re extends fe{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return ve(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ve(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ve(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new Re(n,i):null}static _create(e,t){return new Re(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}let De=(()=>{class e extends Se{constructor(){super("twitter.com")}static credential(t,n){return we._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return e.credential(n,r)}catch(i){return null}}}return e.TWITTER_SIGN_IN_METHOD="twitter.com",e.PROVIDER_ID="twitter.com",e})();async function Pe(e,t){return O(e,"POST","/v1/accounts:signUp",D(e,t))}class xe{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await W._fromIdTokenResponse(e,n,r),s=Oe(n);return new xe({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Oe(n);return new xe({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Oe(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Le extends i.ZR{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,this.name="FirebaseError",Object.setPrototypeOf(this,Le.prototype),this.appName=e.name,this.code=t.code,this.tenantId=null!==(i=e.tenantId)&&void 0!==i?i:void 0,this.serverResponse=t.customData.serverResponse}static _fromErrorAndOperation(e,t,n,r){return new Le(e,t,n,r)}}function Me(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Le._fromErrorAndOperation(e,n,t,r);throw n})}function Fe(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Ue(e,t,n=!1){const r=await B(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return xe._forOperation(e,"link",r)}async function Ve(e,t,n){await K(t);const r=!1===e?"provider-already-linked":"no-such-provider";v(Fe(t.providerData).has(n)===e,t.auth,r)}async function qe(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await B(e,Me(r,i,t,e),n);v(s.idToken,r,"internal-error");const o=q(s.idToken);v(o,r,"internal-error");const{sub:a}=o;return v(e.uid===a,r,"user-mismatch"),xe._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&f(r,"user-mismatch"),s}}async function Be(e,t,n=!1){const r="signIn",i=await Me(e,r,t),s=await xe._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function je(e,t){return Be(ue(e),t)}async function ze(e,t){const n=(0,i.m9)(e);return await Ve(!1,n,t.providerId),Ue(n,t)}async function Ke(e,t){return qe((0,i.m9)(e),t)}class $e{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Ge._fromServerResponse(e,t):f(e,"internal-error")}}class Ge extends $e{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Ge(t)}}function We(e,t,n){var r;v((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),v(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(v(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(v(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function He(e,t){const n=(0,i.m9)(e),r=await pe(n,{oobCode:t}),s=r.requestType;switch(v(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":v(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":v(r.mfaInfo,n,"internal-error");default:v(r.email,n,"internal-error")}let o=null;return r.mfaInfo&&(o=$e._fromServerResponse(ue(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:o},operation:s}}async function Qe(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await B(e,ge(r,i));await e._updateTokensIfNecessary(s,!0)}class Je{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Ye extends Je{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Xe extends Je{constructor(e,t){super(e,"facebook.com",t)}}class Ze extends Ye{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class et extends Je{constructor(e,t){super(e,"google.com",t)}}class tt extends Ye{constructor(e,t,n){super(e,"twitter.com",t,n)}}function nt(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=q(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new Je(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Xe(s,i);case"github.com":return new Ze(s,i);case"google.com":return new et(s,i);case"twitter.com":return new tt(s,i,e.screenName||null);case"custom":case"anonymous":return new Je(s,null);default:return new Je(s,r,i)}}(n)}class rt{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new rt("enroll",e)}static _fromMfaPendingCredential(e){return new rt("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return rt._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return rt._fromIdtoken(e.multiFactorSession.idToken)}return null}}class it{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=ue(e),r=(t.serverResponse.mfaInfo||[]).map(e=>$e._fromServerResponse(n,e));v(t.serverResponse.mfaPendingCredential,n,"internal-error");const i=rt._fromMfaPendingCredential(t.serverResponse.mfaPendingCredential);return new it(i,r,async e=>{const r=await e._process(n,i);delete t.serverResponse.mfaInfo,delete t.serverResponse.mfaPendingCredential;const s=Object.assign(Object.assign({},t.serverResponse),{idToken:r.idToken,refreshToken:r.refreshToken});switch(t.operationType){case"signIn":const e=await xe._fromIdTokenResponse(n,t.operationType,s);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return v(t.user,n,"internal-error"),xe._forOperation(t.user,t.operationType,s);default:f(n,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class st{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>$e._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new st(e)}async getSession(){return rt._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e,r=await this.getSession(),i=await B(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken(),r=await B(this.user,(i=this.user.auth,s={idToken:n,mfaEnrollmentId:t},P(i,"POST","/v2/accounts/mfaEnrollment:withdraw",D(i,s))));var i,s;this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(o){if("auth/user-token-expired"!==o.code)throw o}}}const ot=new WeakMap,at="__sak";class ct{constructor(e,t){this.storage=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(at,"1"),this.storage.removeItem(at),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}}const ut=(()=>{class e extends ct{constructor(){super(window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,i.z$)();return Z(e)||se(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=oe(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.w1)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}return e.type="LOCAL",e})(),ht=(()=>{class e extends ct{constructor(){super(window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}return e.type="SESSION",e})();let lt=(()=>{class e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(e=>e.isListeningto(t));if(n)return n;const r=new e(t);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map(async e=>e(t.origin,i)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return e.receivers=[],e})();function dt(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}class ft{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise((o,a)=>{const c=dt("",20);r.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function pt(){return window}function gt(){return void 0!==pt().WorkerGlobalScope&&"function"==typeof pt().importScripts}const mt="firebaseLocalStorageDb",yt="firebaseLocalStorage",vt="fbase_key";class wt{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function It(e,t){return e.transaction([yt],t?"readwrite":"readonly").objectStore(yt)}function Tt(){const e=indexedDB.open(mt,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(yt,{keyPath:vt})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(yt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(mt);return new wt(e).toPromise()}(),t(await Tt()))})})}async function _t(e,t,n){const r=It(e,!0).put({[vt]:t,value:n});return new wt(r).toPromise()}function bt(e,t){const n=It(e,!0).delete(t);return new wt(n).toPromise()}const Et=(()=>{class e{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Tt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return gt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=lt._getInstance(gt()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new ft(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Tt();return await _t(e,at,"1"),await bt(e,at),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>_t(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=It(e,!1).get(t),r=await new wt(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>bt(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=It(e,!1).getAll();return new wt(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return e.type="LOCAL",e})();function St(e){return new Promise((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=p("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)})}function kt(e){return`__${e}${Math.floor(1e6*Math.random())}`}const Nt=1e12;class At{constructor(e){this.auth=e,this.counter=Nt,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Ct(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Nt;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||Nt))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;return null===(t=this._widgets.get(e||Nt))||void 0===t||t.execute(),""}}class Ct{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;v(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<50;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Rt=kt("rcb"),Dt=new k(3e4,6e4);class Pt{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!pt().grecaptcha}load(e,t=""){return v(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(pt().grecaptcha):new Promise((n,r)=>{const s=pt().setTimeout(()=>{r(p(e,"network-request-failed"))},Dt.get());pt()[Rt]=()=>{pt().clearTimeout(s),delete pt()[Rt];const i=pt().grecaptcha;if(!i)return void r(p(e,"internal-error"));const o=i.render;i.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(i)},St(`https://www.google.com/recaptcha/api.js??${(0,i.xO)({onload:Rt,render:"explicit",hl:t})}`).catch(()=>{clearTimeout(s),r(p(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!pt().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class xt{async load(e){return new At(e)}clearedOneInstance(){}}const Ot="recaptcha",Lt={theme:"light",type:"image"};class Mt{constructor(e,t=Object.assign({},Lt),n){this.parameters=t,this.type=Ot,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ue(n),this.isInvisible="invisible"===this.parameters.size,v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;v(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new xt:new Pt,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise(n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){v(!this.parameters.sitekey,this.auth,"argument-error"),v(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof e)e(t);else if("string"==typeof e){const n=pt()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){v(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){v(E()&&!gt(),this.auth,"internal-error"),await function(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await P(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);v(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return v(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ft{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Te._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Ut(e,t,n){var r;const i=await n.verify();try{let s;if(v("string"==typeof i,e,"argument-error"),v(n.type===Ot,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s)return v("enroll"===t.type,e,"internal-error"),(await function(e,t){return P(e,"POST","/v2/accounts/mfaEnrollment:start",D(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo;{v("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;return v(n,e,"missing-multi-factor-info"),(await function(e,t){return P(e,"POST","/v2/accounts/mfaSignIn:start",D(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return P(e,"POST","/v1/accounts:sendVerificationCode",D(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}let Vt=(()=>{class e{constructor(t){this.providerId=e.PROVIDER_ID,this.auth=ue(t)}verifyPhoneNumber(e,t){return Ut(this.auth,e,(0,i.m9)(t))}static credential(e,t){return Te._fromVerification(e,t)}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Te._fromTokenResponse(t,n):null}}return e.PROVIDER_ID="phone",e.PHONE_SIGN_IN_METHOD="phone",e})();function qt(e,t){return t?_(t):(v(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}class Bt extends fe{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ve(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ve(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ve(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function jt(e){return Be(e.auth,new Bt(e),e.bypassAuthState)}function zt(e){const{auth:t,user:n}=e;return v(n,t,"internal-error"),qe(n,new Bt(e),e.bypassAuthState)}async function Kt(e){const{auth:t,user:n}=e;return v(n,t,"internal-error"),Ue(n,new Bt(e),e.bypassAuthState)}class $t{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return jt;case"linkViaPopup":case"linkViaRedirect":return Kt;case"reauthViaPopup":case"reauthViaRedirect":return zt;default:f(this.auth,"internal-error")}}resolve(e){I(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){I(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Gt=new k(2e3,1e4);let Wt=(()=>{class e extends $t{constructor(t,n,r,i,s){super(t,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,e.currentPopupAction&&e.currentPopupAction.cancel(),e.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return v(e,this.auth,"internal-error"),e}async onExecution(){I(1===this.filter.length,"Popup operations only handle one event");const e=dt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(p(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(p(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;this.pollId=(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(p(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(e,Gt.get())};e()}}return e.currentPopupAction=null,e})();const Ht=new Map;class Qt extends $t{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Ht.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Xt(t),r="true"===await Yt(e)._get(n);return await Yt(e)._remove(n),r}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Ht.set(this.auth._key(),e)}return e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Jt(e,t){return Yt(e)._set(Xt(t),"true")}function Yt(e){return _(e._redirectPersistence)}function Xt(e){return Q("pendingRedirect",e.config.apiKey,e.name)}async function Zt(e,t,n=!1){const r=ue(e),i=qt(r,t),s=new Qt(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function en(e){const t=dt(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class tn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return rn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!rn(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(p(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(nn(e))}saveEventToCache(e){this.cachedEventUids.add(nn(e)),this.lastProcessedEventTime=Date.now()}}function nn(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function rn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function sn(e,t={}){return P(e,"GET","/v1/projects",t)}const on=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,an=/^https?/;function cn(e){const t=b(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!an.test(n))return!1;if(on.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const un=new k(3e4,6e4);function hn(){const e=pt().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let ln=null;function dn(e){return ln=ln||function(e){return new Promise((t,n)=>{var r,i,s;function o(){hn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{hn(),n(p(e,"network-request-failed"))},timeout:un.get()})}if(null===(i=null===(r=pt().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=pt().gapi)||void 0===s?void 0:s.load)){const t=kt("iframefcb");return pt()[t]=()=>{gapi.load?o():n(p(e,"network-request-failed"))},St(`https://apis.google.com/js/api.js?onload=${t}`)}o()}}).catch(e=>{throw ln=null,e})}(e),ln}const fn=new k(5e3,15e3),pn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},gn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function mn(e){const t=e.config;v(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?N(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:s.SDK_VERSION},o=gn.get(e.config.apiHost);o&&(r.eid=o);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${(0,i.xO)(r).slice(1)}`}const yn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class vn{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function wn(e,t,n,r,o,a){v(e.config.authDomain,e,"auth-domain-config-required"),v(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:s.SDK_VERSION,eventId:o};if(t instanceof Ee){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,i.xb)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof Se){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const i of Object.keys(u))void 0===u[i]&&delete u[i];return`${function({config:e}){return e.emulator?N(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,i.xO)(u).slice(1)}`}const In="webStorageSupport";class Tn extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return w("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Tn(e)}_finalizeEnroll(e,t,n){return function(e,t){return P(e,"POST","/v2/accounts/mfaEnrollment:finalize",D(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return P(e,"POST","/v2/accounts/mfaSignIn:finalize",D(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let _n=(()=>{class e{constructor(){}static assertion(e){return Tn._fromCredential(e)}}return e.FACTOR_ID="phone",e})();var bn,En="@firebase/auth",Sn="0.18.3";class kn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Nn(){return window}bn="Browser",(0,s._registerComponent)(new c.wA("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),{apiKey:r,authDomain:i}=n.options;return(e=>{v(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),v(!(null==i?void 0:i.includes(":")),"argument-error",{appName:e.name});const n={apiKey:r,authDomain:i,clientPlatform:bn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ae(bn)},s=new ce(e,n);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(_);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(s,t),s})(n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,s._registerComponent)(new c.wA("auth-internal",e=>{return t=ue(e.getProvider("auth").getImmediate()),new kn(t);var t},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.registerVersion)(En,Sn,void 0),(0,s.registerVersion)(En,Sn,"esm2017");class An extends tn{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}async function Cn(e){const t=await Dn()._get(Pn(e));return t&&await Dn()._remove(Pn(e)),t}function Rn(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function Dn(){return _(ut)}function Pn(e){return Q("authEvent",e.config.apiKey,e.name)}function xn(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return(0,i.zd)(n.join("?"))}function On(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:p("no-auth-event")}}function Ln(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Mn(e=(0,i.z$)()){return!("file:"!==Ln()&&"ionic:"!==Ln()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Fn(){try{const e=self.localStorage,t=dt();if(e)return e.setItem(t,"1"),e.removeItem(t),!function(e=(0,i.z$)()){return(0,i.w1)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=(0,i.z$)()){return/Edge\/\d+/.test(e)}(e)}()||(0,i.hl)()}catch(e){return Un()&&(0,i.hl)()}return!1}function Un(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Vn(){return("http:"===Ln()||"https:"===Ln()||(0,i.ru)()||Mn())&&!((0,i.b$)()||(0,i.UG)())&&Fn()&&!Un()}function qn(){return Mn()&&"undefined"!=typeof document}const Bn={LOCAL:"local",NONE:"none",SESSION:"session"},jn=v,zn="persistence";async function Kn(e){await e._initializationPromise;const t=$n(),n=Q(zn,e.config.apiKey,e.name);(null==t?void 0:t.sessionStorage)&&t.sessionStorage.setItem(n,e._getPersistence())}function $n(){return"undefined"!=typeof window?window:null}const Gn=v;class Wn{constructor(){this.browserResolver=_(class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ht,this._completeRedirectFn=Zt}async _openPopup(e,t,n,r){var s;return I(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},yn),{width:r.toString(),height:s.toString(),top:o,left:a}),h=(0,i.z$)().toLowerCase();n&&(c=ee(h)?"_blank":n),X(h)&&(t=t||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,i.z$)()){var t;return se(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(h)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new vn(null);const d=window.open(t||"",c,l);v(d,e,"popup-blocked");try{d.focus()}catch(f){}return new vn(d)}(e,wn(e,t,n,b(),r),dt())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=wn(e,t,n,b(),r),pt().location.href=i,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(I(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n}async initAndGetManager(e){const t=await async function(e){const t=await dn(e),n=pt().gapi;return v(n,e,"internal-error"),t.open({where:document.body,url:mn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:pn,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=p(e,"network-request-failed"),s=pt().setTimeout(()=>{r(i)},fn.get());function o(){pt().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}(e),n=new tn(e);return t.register("authEvent",t=>(v(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(In,{type:In},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),f(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await sn(e);for(const r of t)try{if(cn(r))return}catch(n){}f(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oe()||Z()||se()}}),this.cordovaResolver=_(class{constructor(){this._redirectPersistence=ht,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Zt}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new An(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){f(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,h;const l=Nn();v("function"==typeof(null===(t=null==l?void 0:l.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),v(void 0!==(null===(n=null==l?void 0:l.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),v("function"==typeof(null===(s=null===(i=null===(r=null==l?void 0:l.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null===(c=null===(a=null===(o=null==l?void 0:l.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null===(h=null===(u=null==l?void 0:l.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===h?void 0:h.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),Ht.clear(),await this._originValidation(e);const o=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Rn(),postBody:null,tenantId:e.tenantId,error:p(e,"no-auth-event")}}(e,n,r);await function(e,t){return Dn()._set(Pn(e),t)}(e,o);const a=await async function(e,t,n){var r;const{BuildInfo:i}=Nn();I(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(I(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId),o={};return se()?o.ibi=i.packageName:ne()?o.apn=i.packageName:f(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,wn(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}(e,o,t);return async function(e,t,n){const{cordova:r}=Nn();let i=()=>{};try{await new Promise((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout(()=>{o(p(e,"redirect-cancelled-by-user"))},2e3))}function h(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),ne()&&document.addEventListener("visibilitychange",h,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",h,!1),a&&window.clearTimeout(a)}})}finally{i()}}(e,s,await function(e){const{cordova:t}=Nn();return new Promise(n=>{t.plugins.browsertab.isAvailable(r=>{let s=null;r?t.plugins.browsertab.openUrl(e):s=t.InAppBrowser.open(e,function(e=(0,i.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(s)})})}(a))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=Nn(),n={};se()?n.iosBundleId=t.packageName:ne()?n.androidPackageName=t.packageName:f(e,"operation-not-supported-in-this-environment"),await sn(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=Nn(),s=setTimeout(async()=>{await Cn(e),t.onEvent(On())},500),o=async n=>{clearTimeout(s);const r=await Cn(e);let i=null;r&&(null==n?void 0:n.url)&&(i=function(e,t){var n,r;const i=function(e){const t=xn(e),n=t.link?decodeURIComponent(t.link):void 0,r=xn(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return xn(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=xn(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(t){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?p(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}(r,n.url)),t.onEvent(i||On())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;Nn().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(t){console.error(t)}}}}),this.underlyingResolver=null,this._redirectPersistence=ht,this._completeRedirectFn=Zt}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return qn()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Gn(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!qn()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Hn(e){return e.unwrap()}function Qn(e){const{_tokenResponse:t}=e instanceof i.ZR?e.customData:e;if(!t)return null;if(!(e instanceof i.ZR)&&"temporaryProof"in t&&"phoneNumber"in t)return Vt.credentialFromResult(e);const n=t.providerId;if(!n||"password"===n)return null;let r;switch(n){case"google.com":r=Ae;break;case"facebook.com":r=Ne;break;case"github.com":r=Ce;break;case"twitter.com":r=De;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?Re._create(n,o):we._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new ke(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof i.ZR?r.credentialFromError(e):r.credentialFromResult(e)}function Jn(e,t){return t.catch(t=>{throw t instanceof i.ZR&&function(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code)t.resolver=new Xn(e,function(e,t){var n;const r=(0,i.m9)(e),s=t;return v(t.operationType,r,"argument-error"),v(null===(n=s.serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),it._fromError(r,s)}(e,t));else if(r){const e=Qn(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}(e,t),t}).then(e=>{const t=e.user;return{operationType:e.operationType,credential:(n=e,Qn(n)),additionalUserInfo:nt(e),user:Zn.getOrCreate(t)};var n})}async function Yn(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>Jn(e,n.confirm(t))}}class Xn{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Jn(Hn(this.auth),this.resolver.resolveSignIn(e))}}class Zn{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=(0,i.m9)(e);return ot.has(t)||ot.set(t,st._fromUser(t)),ot.get(t)}(e)}static getOrCreate(e){return Zn.USER_MAP.has(e)||Zn.USER_MAP.set(e,new Zn(e)),Zn.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Jn(this.auth,ze(this._delegate,e))}async linkWithPhoneNumber(e,t){return Yn(this.auth,async function(e,t,n){const r=(0,i.m9)(e);await Ve(!1,r,"phone");const s=await Ut(r.auth,t,(0,i.m9)(n));return new Ft(s,e=>ze(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Jn(this.auth,async function(e,t,n){const r=(0,i.m9)(e);m(r.auth,t,Ee);const s=qt(r.auth,n);return new Wt(r.auth,"linkViaPopup",t,s,r).executeNotNull()}(this._delegate,e,Wn))}async linkWithRedirect(e){return await Kn(ue(this.auth)),function(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);m(r.auth,t,Ee);const s=qt(r.auth,n);await Ve(!1,r,t.providerId),await Jt(s,r.auth);const o=await en(r);return s._openRedirect(r.auth,t,"linkViaRedirect",o)}(e,t,n)}(this._delegate,e,Wn)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Jn(this.auth,Ke(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Yn(this.auth,async function(e,t,n){const r=(0,i.m9)(e),s=await Ut(r.auth,t,(0,i.m9)(n));return new Ft(s,e=>Ke(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Jn(this.auth,async function(e,t,n){const r=(0,i.m9)(e);m(r.auth,t,Ee);const s=qt(r.auth,n);return new Wt(r.auth,"reauthViaPopup",t,s,r).executeNotNull()}(this._delegate,e,Wn))}async reauthenticateWithRedirect(e){return await Kn(ue(this.auth)),function(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);m(r.auth,t,Ee);const s=qt(r.auth,n);await Jt(s,r.auth);const o=await en(r);return s._openRedirect(r.auth,t,"reauthViaRedirect",o)}(e,t,n)}(this._delegate,e,Wn)}sendEmailVerification(e){return async function(e,t){const n=(0,i.m9)(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&We(n.auth,r,t);const{email:s}=await async function(e,t){return me(e,t)}(n.auth,r);s!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=(0,i.m9)(e);await Ve(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return P(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=Fe(r||[]);return n.providerData=n.providerData.filter(e=>s.has(e.providerId)),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return function(e,t){return Qe((0,i.m9)(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return Qe((0,i.m9)(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await Ue((0,i.m9)(e),t)}(this._delegate,e)}updateProfile(e){return async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=(0,i.m9)(e),s={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},o=await B(r,async function(e,t){return P(e,"POST","/v1/accounts:update",t)}(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){const r=(0,i.m9)(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&We(r.auth,s,n);const{email:o}=await async function(e,t){return me(e,t)}(r.auth,s);o!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Zn.USER_MAP=new WeakMap;const er=v;let tr=(()=>{class e{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;er(n,"invalid-api-key",{appName:e.name});let r=[H];if("undefined"!=typeof window){r=function(e,t){const n=$n();if(!(null==n?void 0:n.sessionStorage))return[];const r=Q(zn,e,t);switch(n.sessionStorage.getItem(r)){case Bn.NONE:return[H];case Bn.LOCAL:return[Et,ht];case Bn.SESSION:return[ht];default:return[]}}(n,e.name);for(const e of[Et,ut,ht])r.includes(e)||r.push(e)}er(n,"invalid-api-key",{appName:e.name});const i="undefined"!=typeof window?Wn:void 0;this._delegate=t.initialize({options:{persistence:r,popupRedirectResolver:i}}),this._delegate._updateErrorMap(u),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Zn.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){const r=ue(e);v(r._canInitEmulator,r,"emulator-config-failed"),v(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=le(t),{host:o,port:a}=function(e){const t=le(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:de(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:de(t)}}}(t);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return async function(e,t){await async function(e,t){return P(e,"POST","/v1/accounts:update",D(e,t))}((0,i.m9)(e),{oobCode:t})}(this._delegate,e)}checkActionCode(e){return He(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await pe((0,i.m9)(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Jn(this._delegate,async function(e,t,n){const r=ue(e),i=await Pe(r,{returnSecureToken:!0,email:t,password:n}),s=await xe._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){const n={identifier:t,continueUri:E()?b():"http://localhost"},{signinMethods:r}=await async function(e,t){return P(e,"POST","/v1/accounts:createAuthUri",D(e,t))}((0,i.m9)(e),n);return r||[]}(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=_e.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(0,e)}async getRedirectResult(){er(Vn(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await ue(e)._initializationPromise,Zt(e,t,!1)}(this._delegate,Wn);return e?Jn(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){ue(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=nr(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=nr(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){const r=(0,i.m9)(e),s={requestType:"EMAIL_SIGNIN",email:t};v(n.handleCodeInApp,r,"argument-error"),n&&We(r,s,n),await async function(e,t){return me(e,t)}(r,s)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){const r=(0,i.m9)(e),s={requestType:"PASSWORD_RESET",email:t};n&&We(r,s,n),await async function(e,t){return me(e,t)}(r,s)}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){jn(Object.values(Bn).includes(t),e,"invalid-persistence-type"),(0,i.b$)()?jn(t!==Bn.SESSION,e,"unsupported-persistence-type"):(0,i.UG)()?jn(t===Bn.NONE,e,"unsupported-persistence-type"):Un()?jn(t===Bn.NONE||t===Bn.LOCAL&&(0,i.hl)(),e,"unsupported-persistence-type"):jn(t===Bn.NONE||Fn(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Bn.SESSION:t=ht;break;case Bn.LOCAL:t=await _(Et)._isAvailable()?Et:ut;break;case Bn.NONE:t=H;break;default:return f("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Jn(this._delegate,async function(e){var t;const n=ue(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new xe({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await Pe(n,{returnSecureToken:!0}),i=await xe._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return Jn(this._delegate,je(this._delegate,e))}signInWithCustomToken(e){return Jn(this._delegate,async function(e,t){const n=ue(e),r=await async function(e,t){return O(e,"POST","/v1/accounts:signInWithCustomToken",D(e,t))}(n,{token:t,returnSecureToken:!0}),i=await xe._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}(this._delegate,e))}signInWithEmailAndPassword(e,t){return Jn(this._delegate,function(e,t,n){return je((0,i.m9)(e),be.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return Jn(this._delegate,async function(e,t,n){const r=(0,i.m9)(e),s=be.credentialWithLink(t,n||b());return v(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),je(r,s)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Yn(this._delegate,async function(e,t,n){const r=ue(e),s=await Ut(r,t,(0,i.m9)(n));return new Ft(s,e=>je(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return er(Vn(),this._delegate,"operation-not-supported-in-this-environment"),Jn(this._delegate,async function(e,t,n){const r=ue(e);m(e,t,Ee);const i=qt(r,n);return new Wt(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,Wn))}async signInWithRedirect(e){return er(Vn(),this._delegate,"operation-not-supported-in-this-environment"),await Kn(this._delegate),function(e,t,n){return async function(e,t,n){const r=ue(e);m(e,t,Ee);const i=qt(r,n);return await Jt(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}(this._delegate,e,Wn)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await He((0,i.m9)(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return e.Persistence=Bn,e})();function nr(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Zn.getOrCreate(e)),error:t,complete:n}}class rr{constructor(){this.providerId="phone",this._delegate=new Vt(Hn(r.Z.auth()))}static credential(e,t){return Vt.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}rr.PHONE_SIGN_IN_METHOD=Vt.PHONE_SIGN_IN_METHOD,rr.PROVIDER_ID=Vt.PROVIDER_ID;const ir=v;var sr;(sr=r.Z).INTERNAL.registerComponent(new c.wA("auth-compat",e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new tr(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:be,FacebookAuthProvider:Ne,GithubAuthProvider:Ce,GoogleAuthProvider:Ae,OAuthProvider:ke,PhoneAuthProvider:rr,PhoneMultiFactorGenerator:_n,RecaptchaVerifier:class{constructor(e,t,n=r.Z.app()){var i;ir(null===(i=n.options)||void 0===i?void 0:i.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Mt(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:De,Auth:tr,AuthCredential:fe,Error:i.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),sr.registerVersion("@firebase/auth-compat","0.1.6")},7556:(e,t,n)=>{"use strict";n.d(t,{e:()=>a});var r=n(4762),i=n(3018),s=n(8006),o=n(613);let a=(()=>{class e{constructor(e,t){this.afAuth=e,this.userService=t}login(e,t){return new Promise(n=>{const r=this.afAuth.signInWithEmailAndPassword(e,t);r&&this.userService.getByEmail(e).subscribe(e=>{localStorage.setItem("user",JSON.stringify(e)),n(r)})})}register(e,t){return(0,r.mG)(this,void 0,void 0,function*(){try{return yield this.afAuth.createUserWithEmailAndPassword(e,t)}catch(n){}})}logout(){return(0,r.mG)(this,void 0,void 0,function*(){try{yield this.afAuth.signOut(),localStorage.setItem("user","")}catch(e){}})}}return e.\u0275fac=function(t){return new(t||e)(i.LFG(s.zQ),i.LFG(o.K))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},613:(e,t,n)=>{"use strict";n.d(t,{K:()=>fp});var r=n(4762),i=n(8002),s=n(3018),o=n(3637),a=n(7574),c=n(4402),u=n(5917),h=n(6643),l=n(9761),d=n(7393);function f(){return e=>e.lift(new p)}class p{call(e,t){return t.subscribe(new g(e))}}class g extends d.L{constructor(e){super(e),this.hasPrev=!1}_next(e){let t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)}}var m,y=n(2145),v=n(7519),w=n(5435),I=n(8747),T=n(8583),_=(n(4671),n(4486)),b=n(5452),E=n(6034),S=n(5601),k=n(3854),N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A={},C=C||{},R=N||self;function D(){}function P(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function x(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var O="closure_uid_"+(1e9*Math.random()>>>0),L=0;function M(e,t,n){return e.call.apply(e.bind,arguments)}function F(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function U(e,t,n){return(U=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:F).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function q(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function B(){this.s=this.s,this.o=this.o}var j={};B.prototype.s=!1,B.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,O)&&e[O]||(e[O]=++L)}(this);delete j[e]}},B.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const z=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},K=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function $(e){return Array.prototype.concat.apply([],arguments)}function G(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function W(e){return/^[\s\xa0]*$/.test(e)}var H,Q=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function J(e,t){return-1!=e.indexOf(t)}function Y(e,t){return e<t?-1:e>t?1:0}e:{var X=R.navigator;if(X){var Z=X.userAgent;if(Z){H=Z;break e}}H=""}function ee(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function te(e){const t={};for(const n in e)t[n]=e[n];return t}var ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function re(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<ne.length;t++)n=ne[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function ie(e){return ie[" "](e),e}ie[" "]=D;var se,oe,ae=J(H,"Opera"),ce=J(H,"Trident")||J(H,"MSIE"),ue=J(H,"Edge"),he=ue||ce,le=J(H,"Gecko")&&!(J(H.toLowerCase(),"webkit")&&!J(H,"Edge"))&&!(J(H,"Trident")||J(H,"MSIE"))&&!J(H,"Edge"),de=J(H.toLowerCase(),"webkit")&&!J(H,"Edge");function fe(){var e=R.document;return e?e.documentMode:void 0}e:{var pe="",ge=(oe=H,le?/rv:([^\);]+)(\)|;)/.exec(oe):ue?/Edge\/([\d\.]+)/.exec(oe):ce?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(oe):de?/WebKit\/(\S+)/.exec(oe):ae?/(?:Version)[ \/]?(\S+)/.exec(oe):void 0);if(ge&&(pe=ge?ge[1]:""),ce){var me=fe();if(null!=me&&me>parseFloat(pe)){se=String(me);break e}}se=pe}var ye={};var ve=R.document&&ce&&(fe()||parseInt(se,10))||void 0,we=function(){if(!R.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{R.addEventListener("test",D,t),R.removeEventListener("test",D,t)}catch(n){}return e}();function Ie(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function Te(e,t){if(Ie.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(le){e:{try{ie(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:_e[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Te.Z.h.call(this)}}Ie.prototype.h=function(){this.defaultPrevented=!0},q(Te,Ie);var _e={2:"touch",3:"pen",4:"mouse"};Te.prototype.h=function(){Te.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var be="closure_listenable_"+(1e6*Math.random()|0),Ee=0;function Se(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++Ee,this.ca=this.fa=!1}function ke(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Ne(e){this.src=e,this.g={},this.h=0}function Ae(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=z(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(ke(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Ce(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}Ne.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Ce(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Se(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Re="closure_lm_"+(1e6*Math.random()|0),De={};function Pe(e,t,n,r,i){if(r&&r.once)return Oe(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Pe(e,t[s],n,r,i);return null}return n=Be(n),e&&e[be]?e.N(t,n,x(r)?!!r.capture:!!r,i):xe(e,t,n,!1,r,i)}function xe(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=x(i)?!!i.capture:!!i,a=Ve(e);if(a||(e[Re]=a=new Ne(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){var e=Ue;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)we||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Fe(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Oe(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Oe(e,t[s],n,r,i);return null}return n=Be(n),e&&e[be]?e.O(t,n,x(r)?!!r.capture:!!r,i):xe(e,t,n,!0,r,i)}function Le(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Le(e,t[s],n,r,i);else r=x(r)?!!r.capture:!!r,n=Be(n),e&&e[be]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Ce(s=e.g[t],n,r,i))&&(ke(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Ve(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Ce(t,n,r,i)),(n=-1<e?t[e]:null)&&Me(n))}function Me(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[be])Ae(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Fe(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ve(t))?(Ae(n,e),0==n.h&&(n.src=null,t[Re]=null)):ke(e)}}}function Fe(e){return e in De?De[e]:De[e]="on"+e}function Ue(e,t){if(e.ca)e=!0;else{t=new Te(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&Me(e),e=n.call(r,t)}return e}function Ve(e){return(e=e[Re])instanceof Ne?e:null}var qe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Be(e){return"function"==typeof e?e:(e[qe]||(e[qe]=function(t){return e.handleEvent(t)}),e[qe])}function je(){B.call(this),this.i=new Ne(this),this.P=this,this.I=null}function ze(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new Ie(t,e);else if(t instanceof Ie)t.target=t.target||e;else{var i=t;re(t=new Ie(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Ke(o,r,!0,t)&&i}if(i=Ke(o=t.g=e,r,!0,t)&&i,i=Ke(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Ke(o=t.g=n[s],r,!1,t)&&i}function Ke(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&Ae(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}q(je,B),je.prototype[be]=!0,je.prototype.removeEventListener=function(e,t,n,r){Le(this,e,t,n,r)},je.prototype.M=function(){if(je.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ke(n[r]);delete t.g[e],t.h--}}this.I=null},je.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},je.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var $e=R.JSON.stringify;function Ge(){var e=Ze;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var We,He=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Qe,e=>e.reset());class Qe{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Je(e){R.setTimeout(()=>{throw e},0)}function Ye(e,t){We||function(){var e=R.Promise.resolve(void 0);We=function(){e.then(et)}}(),Xe||(We(),Xe=!0),Ze.add(e,t)}var Xe=!1,Ze=new class{constructor(){this.h=this.g=null}add(e,t){const n=He.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function et(){for(var e;e=Ge();){try{e.h.call(e.g)}catch(n){Je(n)}var t=He;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Xe=!1}function tt(e,t){je.call(this),this.h=e||1,this.g=t||R,this.j=U(this.kb,this),this.l=Date.now()}function nt(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function rt(e,t,n){if("function"==typeof e)n&&(e=U(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=U(e.handleEvent,e)}return 2147483647<Number(t)?-1:R.setTimeout(e,t||0)}function it(e){e.g=rt(()=>{e.g=null,e.i&&(e.i=!1,it(e))},e.j);const t=e.h;e.h=null,e.m.apply(null,t)}q(tt,je),(m=tt.prototype).da=!1,m.S=null,m.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ze(this,"tick"),this.da&&(nt(this),this.start()))}},m.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},m.M=function(){tt.Z.M.call(this),nt(this),delete this.g};class st extends B{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:it(this)}M(){super.M(),this.g&&(R.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ot(e){B.call(this),this.h=e,this.g={}}q(ot,B);var at=[];function ct(e,t,n,r){Array.isArray(n)||(n&&(at[0]=n.toString()),n=at);for(var i=0;i<n.length;i++){var s=Pe(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function ut(e){ee(e.g,function(e,t){this.g.hasOwnProperty(t)&&Me(e)},e),e.g={}}function ht(){this.g=!0}function lt(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return $e(n)}catch(a){return t}}(e,n)+(r?" "+r:"")})}ot.prototype.M=function(){ot.Z.M.call(this),ut(this)},ot.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ht.prototype.Aa=function(){this.g=!1},ht.prototype.info=function(){};var dt={},ft=null;function pt(){return ft=ft||new je}function gt(e){Ie.call(this,dt.Ma,e)}function mt(e){const t=pt();ze(t,new gt(t,e))}function yt(e,t){Ie.call(this,dt.STAT_EVENT,e),this.stat=t}function vt(e){const t=pt();ze(t,new yt(t,e))}function wt(e,t){Ie.call(this,dt.Na,e),this.size=t}function It(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return R.setTimeout(function(){e()},t)}dt.Ma="serverreachability",q(gt,Ie),dt.STAT_EVENT="statevent",q(yt,Ie),dt.Na="timingevent",q(wt,Ie);var Tt={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},_t={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function bt(){}function Et(){}bt.prototype.h=null;var St,kt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Nt(){Ie.call(this,"d")}function At(){Ie.call(this,"c")}function Ct(){}function Rt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new ot(this),this.P=Pt,this.W=new tt(e=he?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Dt}function Dt(){this.i=null,this.g="",this.h=!1}q(Nt,Ie),q(At,Ie),q(Ct,bt),Ct.prototype.g=function(){return new XMLHttpRequest},Ct.prototype.i=function(){return{}},St=new Ct;var Pt=45e3,xt={},Ot={};function Lt(e,t,n){e.K=1,e.v=sn(Xt(t)),e.s=n,e.U=!0,Mt(e,null)}function Mt(e,t){e.F=Date.now(),qt(e),e.A=Xt(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),vn(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Dt,e.g=vr(e.l,n?t:null,!e.s),0<e.O&&(e.L=new st(U(e.Ia,e,e.g),e.O)),ct(e.V,e.g,"readystatechange",e.gb),t=e.H?te(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),mt(1),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.X,e.s)}function Ft(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function Ut(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Vt(e,n),r==Ot){4==t&&(e.o=4,vt(14),i=!1),lt(e.j,e.m,null,"[Incomplete Response]");break}if(r==xt){e.o=4,vt(15),lt(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}lt(e.j,e.m,r,null),$t(e,r)}Ft(e)&&r!=Ot&&r!=xt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,vt(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),hr(t),t.L=!0,vt(11))):(lt(e.j,e.m,n,"[Invalid Chunked Response]"),Kt(e),zt(e))}function Vt(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ot:(n=Number(t.substring(n,r)),isNaN(n)?xt:(r+=1)+n>t.length?Ot:(t=t.substr(r,n),e.C=r+n,t))}function qt(e){e.Y=Date.now()+e.P,Bt(e,e.P)}function Bt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=It(U(e.eb,e),t)}function jt(e){e.B&&(R.clearTimeout(e.B),e.B=null)}function zt(e){0==e.l.G||e.I||fr(e.l,e)}function Kt(e){jt(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,nt(e.W),ut(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function $t(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||En(n.i,e)))if(n.I=e.N,!e.J&&En(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;dr(n),tr(n)}ur(n),vt(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=It(U(n.ab,n),6e3));if(1>=bn(n.i)&&n.ka){try{n.ka()}catch(u){}n.ka=void 0}}else gr(n,11)}else if((e.J||n.g==e)&&dr(n),!W(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const t=u[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=u[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(n.K=r=1.5*h,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(J(e,"spdy")||J(e,"quic")||J(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(Sn(s,s.h),s.h=null))}if(r.D){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,rn(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=yr(r,r.H?r.la:null,r.W),o.J){kn(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(jt(a),qt(a)),r.g=o}else cr(r);0<n.l.length&&ir(n)}else"stop"!=u[0]&&"close"!=u[0]||gr(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?gr(n,7):er(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}mt(4)}catch(u){}}function Gt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(P(e)||"string"==typeof e)K(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(P(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(P(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function Wt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Wt)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Ht(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Qt(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)Qt(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function Qt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(m=Rt.prototype).setTimeout=function(e){this.P=e},m.gb=function(e){e=e.target;const t=this.L;t&&3==Qn(e)?t.l():this.Ia(e)},m.Ia=function(e){try{if(e==this.g)e:{const h=Qn(this.g);var t=this.g.Da();const l=this.g.ba();if(!(3>h)&&(3!=h||he||this.g&&(this.h.h||this.g.ga()||Jn(this.g)))){this.I||4!=h||7==t||mt(8==t||0>=l?3:2),jt(this);var n=this.g.ba();this.N=n;t:if(Ft(this)){var r=Jn(this.g);e="";var i=r.length,s=4==Qn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Kt(this),zt(this);var o="";break t}this.h.i=new R.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,vt(12),Kt(this),zt(this);break e}lt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,$t(this,n)}this.U?(Ut(this,h,o),he&&this.i&&3==h&&(ct(this.V,this.W,"tick",this.fb),this.W.start())):(lt(this.j,this.m,o,null),$t(this,o)),4==h&&Kt(this),this.i&&!this.I&&(4==h?fr(this.l,this):(this.i=!1,qt(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,vt(12)):(this.o=0,vt(13)),Kt(this),zt(this)}}}catch(h){}},m.fb=function(){if(this.g){var e=Qn(this.g),t=this.g.ga();this.C<t.length&&(jt(this),Ut(this,e,t),this.i&&4!=e&&qt(this))}},m.cancel=function(){this.I=!0,Kt(this)},m.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(mt(3),vt(17)),Kt(this),this.o=2,zt(this)):Bt(this,this.Y-e)},(m=Wt.prototype).R=function(){Ht(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},m.T=function(){return Ht(this),this.g.concat()},m.get=function(e,t){return Qt(this.h,e)?this.h[e]:t},m.set=function(e,t){Qt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},m.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var Jt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Yt(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Yt){this.g=void 0!==t?t:e.g,Zt(this,e.j),this.s=e.s,en(this,e.i),tn(this,e.m),this.l=e.l,t=e.h;var n=new pn;n.i=t.i,t.g&&(n.g=new Wt(t.g),n.h=t.h),nn(this,n),this.o=e.o}else e&&(n=String(e).match(Jt))?(this.g=!!t,Zt(this,n[1]||"",!0),this.s=on(n[2]||""),en(this,n[3]||"",!0),tn(this,n[4]),this.l=on(n[5]||"",!0),nn(this,n[6]||"",!0),this.o=on(n[7]||"")):(this.g=!!t,this.h=new pn(null,this.g))}function Xt(e){return new Yt(e)}function Zt(e,t,n){e.j=n?on(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function en(e,t,n){e.i=n?on(t,!0):t}function tn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function nn(e,t,n){t instanceof pn?(e.h=t,function(e,t){t&&!e.j&&(gn(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(mn(this,t),vn(this,n,e))},e)),e.j=t}(e.h,e.g)):(n||(t=an(t,dn)),e.h=new pn(t,e.g))}function rn(e,t,n){e.h.set(t,n)}function sn(e){return rn(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function on(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function an(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,cn),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function cn(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Yt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(an(t,un,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(an(t,un,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(an(n,"/"==n.charAt(0)?ln:hn,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",an(n,fn)),e.join("")};var un=/[#\/\?@]/g,hn=/[#\?:]/g,ln=/[#\?]/g,dn=/[#\?@]/g,fn=/#/g;function pn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function gn(e){e.g||(e.g=new Wt,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function mn(e,t){gn(e),t=wn(e,t),Qt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Qt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Ht(e)))}function yn(e,t){return gn(e),t=wn(e,t),Qt(e.g.h,t)}function vn(e,t,n){mn(e,t),0<n.length&&(e.i=null,e.g.set(wn(e,t),G(n)),e.h+=n.length)}function wn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function In(e){this.l=e||Tn,e=R.PerformanceNavigationTiming?0<(e=R.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(R.g&&R.g.Ea&&R.g.Ea()&&R.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(m=pn.prototype).add=function(e,t){gn(this),this.i=null,e=wn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},m.forEach=function(e,t){gn(this),this.g.forEach(function(n,r){K(n,function(n){e.call(t,n,r,this)},this)},this)},m.T=function(){gn(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},m.R=function(e){gn(this);var t=[];if("string"==typeof e)yn(this,e)&&(t=$(t,this.g.get(wn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=$(t,e[n])}return t},m.set=function(e,t){return gn(this),this.i=null,yn(this,e=wn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},m.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},m.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};var Tn=10;function _n(e){return!!e.h||!!e.g&&e.g.size>=e.j}function bn(e){return e.h?1:e.g?e.g.size:0}function En(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Sn(e,t){e.g?e.g.add(t):e.h=t}function kn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Nn(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return G(e.i)}function An(){}function Cn(){this.g=new An}function Rn(e,t,n){const r=n||"";try{Gt(e,function(e,n){let i=e;x(e)&&(i=$e(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Dn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(s){}}function Pn(e){this.l=e.$b||null,this.j=e.ib||!1}function xn(e,t){je.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=On,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}In.prototype.cancel=function(){if(this.i=Nn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},An.prototype.stringify=function(e){return R.JSON.stringify(e,void 0)},An.prototype.parse=function(e){return R.JSON.parse(e,void 0)},q(Pn,bt),Pn.prototype.g=function(){return new xn(this.l,this.j)},Pn.prototype.i=function(e){return function(){return e}}({}),q(xn,je);var On=0;function Ln(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Mn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Fn(e)}function Fn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(m=xn.prototype).open=function(e,t){if(this.readyState!=On)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Fn(this)},m.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||R).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},m.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mn(this)),this.readyState=On},m.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Fn(this)),this.g&&(this.readyState=3,Fn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==R.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ln(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},m.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Mn(this):Fn(this),3==this.readyState&&Ln(this)}},m.Ua=function(e){this.g&&(this.response=this.responseText=e,Mn(this))},m.Ta=function(e){this.g&&(this.response=e,Mn(this))},m.ha=function(){this.g&&Mn(this)},m.setRequestHeader=function(e,t){this.v.append(e,t)},m.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},m.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(xn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Un=R.JSON.parse;function Vn(e){je.call(this),this.headers=new Wt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=qn,this.K=this.L=!1}q(Vn,je);var qn="",Bn=/^https?$/i,jn=["POST","PUT"];function zn(e){return"content-type"==e.toLowerCase()}function Kn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,$n(e),Wn(e)}function $n(e){e.D||(e.D=!0,ze(e,"complete"),ze(e,"error"))}function Gn(e){if(e.h&&void 0!==C&&(!e.C[1]||4!=Qn(e)||2!=e.ba()))if(e.v&&4==Qn(e))rt(e.Fa,0,e);else if(ze(e,"readystatechange"),4==Qn(e)){e.h=!1;try{const c=e.ba();e:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===c){var i=String(e.H).match(Jt)[1]||null;if(!i&&R.self&&R.self.location){var s=R.self.location.protocol;i=s.substr(0,s.length-1)}r=!Bn.test(i?i.toLowerCase():"")}n=r}if(n)ze(e,"complete"),ze(e,"success");else{e.m=6;try{var o=2<Qn(e)?e.g.statusText:""}catch(a){o=""}e.j=o+" ["+e.ba()+"]",$n(e)}}finally{Wn(e)}}}function Wn(e,t){if(e.g){Hn(e);const r=e.g,i=e.C[0]?D:null;e.g=null,e.C=null,t||ze(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function Hn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(R.clearTimeout(e.A),e.A=null)}function Qn(e){return e.g?e.g.readyState:0}function Jn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case qn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Yn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return ee(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):rn(e,t,n))}function Xn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Zn(e){this.za=0,this.l=[],this.h=new ht,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Xn("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Xn("baseRetryDelayMs",5e3,e),this.$a=Xn("retryDelaySeedMs",1e4,e),this.Ya=Xn("forwardChannelMaxRetries",2,e),this.ra=Xn("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new In(e&&e.concurrentRequestLimit),this.Ca=new Cn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function er(e){if(nr(e),3==e.G){var t=e.V++,n=Xt(e.F);rn(n,"SID",e.J),rn(n,"RID",t),rn(n,"TYPE","terminate"),or(e,n),(t=new Rt(e,e.h,t,void 0)).K=2,t.v=sn(Xt(n)),n=!1,R.navigator&&R.navigator.sendBeacon&&(n=R.navigator.sendBeacon(t.v.toString(),"")),!n&&R.Image&&((new Image).src=t.v,n=!0),n||(t.g=vr(t.l,null),t.g.ea(t.v)),t.F=Date.now(),qt(t)}mr(e)}function tr(e){e.g&&(hr(e),e.g.cancel(),e.g=null)}function nr(e){tr(e),e.u&&(R.clearTimeout(e.u),e.u=null),dr(e),e.i.cancel(),e.m&&("number"==typeof e.m&&R.clearTimeout(e.m),e.m=null)}function rr(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&ir(e)}function ir(e){_n(e.i)||e.m||(e.m=!0,Ye(e.Ha,e),e.C=0)}function sr(e,t){var n;n=t?t.m:e.V++;const r=Xt(e.F);rn(r,"SID",e.J),rn(r,"RID",n),rn(r,"AID",e.U),or(e,r),e.o&&e.s&&Yn(r,e.o,e.s),n=new Rt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=ar(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Sn(e.i,n),Lt(n,r,t)}function or(e,t){e.j&&Gt({},function(e,n){rn(t,n,e)})}function ar(e,t,n){n=Math.min(e.l.length,n);var r=e.j?U(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{Rn(a,e,"req"+n+"_")}catch(Jr){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function cr(e){e.g||e.u||(e.Y=1,Ye(e.Ga,e),e.A=0)}function ur(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=It(U(e.Ga,e),pr(e,e.A)),e.A++,0))}function hr(e){null!=e.B&&(R.clearTimeout(e.B),e.B=null)}function lr(e){e.g=new Rt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Xt(e.oa);rn(t,"RID","rpc"),rn(t,"SID",e.J),rn(t,"CI",e.N?"0":"1"),rn(t,"AID",e.U),or(e,t),rn(t,"TYPE","xmlhttp"),e.o&&e.s&&Yn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=sn(Xt(t)),n.s=null,n.U=!0,Mt(n,e)}function dr(e){null!=e.v&&(R.clearTimeout(e.v),e.v=null)}function fr(e,t){var n=null;if(e.g==t){dr(e),hr(e),e.g=null;var r=2}else{if(!En(e.i,t))return;n=t.D,kn(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;ze(r=pt(),new wt(r,n,t,i)),ir(e)}else cr(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(bn(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=It(U(e.Ha,e,t),pr(e,e.C)),e.C++,0)))}(e,t)||2==r&&ur(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:gr(e,5);break;case 4:gr(e,10);break;case 3:gr(e,6);break;default:gr(e,2)}}function pr(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function gr(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=U(e.jb,e);n||(n=new Yt("//www.google.com/images/cleardot.gif"),R.location&&"http"==R.location.protocol||Zt(n,"https"),sn(n)),function(e,t){const n=new ht;if(R.Image){const r=new Image;r.onload=V(Dn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=V(Dn,n,r,"TestLoadImage: error",!1,t),r.onabort=V(Dn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=V(Dn,n,r,"TestLoadImage: timeout",!1,t),R.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else vt(2);e.G=0,e.j&&e.j.va(t),mr(e),nr(e)}function mr(e){e.G=0,e.I=-1,e.j&&(0==Nn(e.i).length&&0==e.l.length||(e.i.i.length=0,G(e.l),e.l.length=0),e.j.ua())}function yr(e,t,n){let r=function(e){return e instanceof Yt?Xt(e):new Yt(e,void 0)}(n);if(""!=r.i)t&&en(r,t+"."+r.i),tn(r,r.m);else{const e=R.location;r=function(e,t,n,r){var i=new Yt(null,void 0);return e&&Zt(i,e),t&&en(i,t),n&&tn(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&ee(e.aa,function(e,t){rn(r,t,e)}),n=e.sa,(t=e.D)&&n&&rn(r,t,n),rn(r,"VER",e.ma),or(e,r),r}function vr(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Vn(n&&e.Ba&&!e.qa?new Pn({ib:!0}):e.qa)).L=e.H,t}function wr(){}function Ir(){if(ce&&!(10<=Number(ve)))throw Error("Environmental error: no available transport.")}function Tr(e,t){je.call(this),this.g=new Zn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!W(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!W(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Er(this)}function _r(e){Nt.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function br(){At.call(this),this.status=1}function Er(e){this.g=e}(m=Vn.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():St.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:St),this.g.onreadystatechange=U(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void Kn(this,s)}e=n||"";const i=new Wt(this.headers);r&&Gt(r,function(e,t){i.set(t,e)}),r=function(e){e:{var t=zn;const n=e.length,r="string"==typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=R.FormData&&e instanceof R.FormData,!(0<=z(jn,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Hn(this),0<this.B&&((this.K=function(e){return ce&&function(){return e=ye,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=Q(String(se)).split("."),n=Q("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=Y(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==i[2].length,0==s[2].length)||Y(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}();var e}()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=U(this.pa,this)):this.A=rt(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){Kn(this,s)}},m.pa=function(){void 0!==C&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ze(this,"timeout"),this.abort(8))},m.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ze(this,"complete"),ze(this,"abort"),Wn(this))},m.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Wn(this,!0)),Vn.Z.M.call(this)},m.Fa=function(){this.s||(this.F||this.v||this.l?Gn(this):this.cb())},m.cb=function(){Gn(this)},m.ba=function(){try{return 2<Qn(this)?this.g.status:-1}catch(oe){return-1}},m.ga=function(){try{return this.g?this.g.responseText:""}catch(oe){return""}},m.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Un(t)}},m.Da=function(){return this.m},m.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(m=Zn.prototype).ma=8,m.G=1,m.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},m.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new Rt(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=te(s),re(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ar(this,i,t),rn(n=Xt(this.F),"RID",e),rn(n,"CVER",22),this.D&&rn(n,"X-HTTP-Session-Id",this.D),or(this,n),this.o&&s&&Yn(n,this.o,s),Sn(this.i,i),this.Ra&&rn(n,"TYPE","init"),this.ja?(rn(n,"$req",t),rn(n,"SID","null"),i.$=!0,Lt(i,n,null)):Lt(i,n,t),this.G=2}}else 3==this.G&&(e?sr(this,e):0==this.l.length||_n(this.i)||sr(this))},m.Ga=function(){if(this.u=null,lr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=It(U(this.bb,this),e)}},m.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,vt(10),tr(this),lr(this))},m.ab=function(){null!=this.v&&(this.v=null,tr(this),ur(this),vt(19))},m.jb=function(e){e?(this.h.info("Successfully pinged google.com"),vt(2)):(this.h.info("Failed to ping google.com"),vt(1))},(m=wr.prototype).xa=function(){},m.wa=function(){},m.va=function(){},m.ua=function(){},m.Oa=function(){},Ir.prototype.g=function(e,t){return new Tr(e,t)},q(Tr,je),Tr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Ye(U(e.hb,e,t))),vt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=yr(e,null,e.W),ir(e)},Tr.prototype.close=function(){er(this.g)},Tr.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,rr(this.g,t)}else this.v?((t={}).__data__=$e(e),rr(this.g,t)):rr(this.g,e)},Tr.prototype.M=function(){this.g.j=null,delete this.j,er(this.g),delete this.g,Tr.Z.M.call(this)},q(_r,Nt),q(br,At),q(Er,wr),Er.prototype.xa=function(){ze(this.g,"a")},Er.prototype.wa=function(e){ze(this.g,new _r(e))},Er.prototype.va=function(e){ze(this.g,new br(e))},Er.prototype.ua=function(){ze(this.g,"b")},Ir.prototype.createWebChannel=Ir.prototype.g,Tr.prototype.send=Tr.prototype.u,Tr.prototype.open=Tr.prototype.m,Tr.prototype.close=Tr.prototype.close,Tt.NO_ERROR=0,Tt.TIMEOUT=8,Tt.HTTP_ERROR=6,_t.COMPLETE="complete",Et.EventType=kt,kt.OPEN="a",kt.CLOSE="b",kt.ERROR="c",kt.MESSAGE="d",je.prototype.listen=je.prototype.N,Vn.prototype.listenOnce=Vn.prototype.O,Vn.prototype.getLastError=Vn.prototype.La,Vn.prototype.getLastErrorCode=Vn.prototype.Da,Vn.prototype.getStatus=Vn.prototype.ba,Vn.prototype.getResponseJson=Vn.prototype.Qa,Vn.prototype.getResponseText=Vn.prototype.ga,Vn.prototype.send=Vn.prototype.ea;var Sr=A.createWebChannelTransport=function(){return new Ir},kr=A.getStatEventTarget=function(){return pt()},Nr=A.ErrorCode=Tt,Ar=A.EventType=_t,Cr=A.Event=dt,Rr=A.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Dr=A.FetchXmlHttpFactory=Pn,Pr=A.WebChannel=Et,xr=A.XhrIo=Vn;const Or="@firebase/firestore";class Lr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Lr.UNAUTHENTICATED=new Lr(null),Lr.GOOGLE_CREDENTIALS=new Lr("google-credentials-uid"),Lr.FIRST_PARTY=new Lr("first-party-uid"),Lr.MOCK_USER=new Lr("mock-user");let Mr="9.1.3";const Fr=new S.Yd("@firebase/firestore");function Ur(){return Fr.logLevel}function Vr(e,...t){if(Fr.logLevel<=S.in.DEBUG){const n=t.map(jr);Fr.debug(`Firestore (${Mr}): ${e}`,...n)}}function qr(e,...t){if(Fr.logLevel<=S.in.ERROR){const n=t.map(jr);Fr.error(`Firestore (${Mr}): ${e}`,...n)}}function Br(e,...t){if(Fr.logLevel<=S.in.WARN){const n=t.map(jr);Fr.warn(`Firestore (${Mr}): ${e}`,...n)}}function jr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function zr(e="Unexpected state"){const t=`FIRESTORE (${Mr}) INTERNAL ASSERTION FAILED: `+e;throw qr(t),new Error(t)}function Kr(e,t){e||zr()}function $r(e,t){return e}const Gr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Wr extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Hr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Qr{constructor(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class Jr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Lr.UNAUTHENTICATED))}shutdown(){}}class Yr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Xr{constructor(e){this.t=e,this.currentUser=Lr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Hr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Hr,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{Vr("FirebaseCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Vr("FirebaseCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Hr)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Vr("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Kr("string"==typeof t.accessToken),new Qr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Kr(null===e||"string"==typeof e),new Lr(e)}}class Zr{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=Lr.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.l},t=this.h.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}class ei{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Zr(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Lr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ti{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.g(e),this.p=e=>t.writeSequenceNumber(e))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.p&&this.p(e),e}}function ni(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}ti.T=-1;class ri{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=ni(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function ii(e,t){return e<t?-1:e>t?1:0}function si(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function oi(e){return e+"\0"}class ai{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Wr(Gr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Wr(Gr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Wr(Gr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Wr(Gr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ai.fromMillis(Date.now())}static fromDate(e){return ai.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ai(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ii(this.nanoseconds,e.nanoseconds):ii(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ci{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ci(e)}static min(){return new ci(new ai(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function ui(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function hi(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function li(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class di{constructor(e,t,n){void 0===t?t=0:t>e.length&&zr(),void 0===n?n=e.length-t:n>e.length-t&&zr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===di.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof di?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class fi extends di{construct(e,t,n){return new fi(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Wr(Gr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new fi(t)}static emptyPath(){return new fi([])}}const pi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gi extends di{construct(e,t,n){return new gi(e,t,n)}static isValidIdentifier(e){return pi.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gi.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new gi(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Wr(Gr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Wr(Gr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Wr(Gr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Wr(Gr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new gi(t)}static emptyPath(){return new gi([])}}class mi{constructor(e){this.fields=e,e.sort(gi.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return si(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class yi{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new yi(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new yi(t)}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ii(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}yi.EMPTY_BYTE_STRING=new yi("");const vi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wi(e){if(Kr(!!e),"string"==typeof e){let t=0;const n=vi.exec(e);if(Kr(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Ii(e.seconds),nanos:Ii(e.nanos)}}function Ii(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ti(e){return"string"==typeof e?yi.fromBase64String(e):yi.fromUint8Array(e)}function _i(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function bi(e){const t=e.mapValue.fields.__previous_value__;return _i(t)?bi(t):t}function Ei(e){const t=wi(e.mapValue.fields.__local_write_time__.timestampValue);return new ai(t.seconds,t.nanos)}function Si(e){return null==e}function ki(e){return 0===e&&1/e==-1/0}function Ni(e){return"number"==typeof e&&Number.isInteger(e)&&!ki(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class Ai{constructor(e){this.path=e}static fromPath(e){return new Ai(fi.fromString(e))}static fromName(e){return new Ai(fi.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===fi.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return fi.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ai(new fi(e.slice()))}}function Ci(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?_i(e)?4:10:zr()}function Ri(e,t){const n=Ci(e);if(n!==Ci(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ei(e).isEqual(Ei(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=wi(e.timestampValue),r=wi(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ti(e.bytesValue).isEqual(Ti(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ii(e.geoPointValue.latitude)===Ii(t.geoPointValue.latitude)&&Ii(e.geoPointValue.longitude)===Ii(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ii(e.integerValue)===Ii(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Ii(e.doubleValue),r=Ii(t.doubleValue);return n===r?ki(n)===ki(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return si(e.arrayValue.values||[],t.arrayValue.values||[],Ri);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ui(n)!==ui(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ri(n[i],r[i])))return!1;return!0}(e,t);default:return zr()}}function Di(e,t){return void 0!==(e.values||[]).find(e=>Ri(e,t))}function Pi(e,t){const n=Ci(e),r=Ci(t);if(n!==r)return ii(n,r);switch(n){case 0:return 0;case 1:return ii(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Ii(e.integerValue||e.doubleValue),r=Ii(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return xi(e.timestampValue,t.timestampValue);case 4:return xi(Ei(e),Ei(t));case 5:return ii(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ti(e),r=Ti(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=ii(n[i],r[i]);if(0!==e)return e}return ii(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=ii(Ii(e.latitude),Ii(t.latitude));return 0!==n?n:ii(Ii(e.longitude),Ii(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=Pi(n[i],r[i]);if(e)return e}return ii(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=ii(r[o],s[o]);if(0!==e)return e;const t=Pi(n[r[o]],i[s[o]]);if(0!==t)return t}return ii(r.length,s.length)}(e.mapValue,t.mapValue);default:throw zr()}}function xi(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ii(e,t);const n=wi(e),r=wi(t),i=ii(n.seconds,r.seconds);return 0!==i?i:ii(n.nanos,r.nanos)}function Oi(e){return Li(e)}function Li(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=wi(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ti(e.bytesValue).toBase64():"referenceValue"in e?Ai.fromName(e.referenceValue).toString():"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Li(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Li(e.fields[i])}`;return n+"}"}(e.mapValue):zr();var t}function Mi(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Fi(e){return!!e&&"integerValue"in e}function Ui(e){return!!e&&"arrayValue"in e}function Vi(e){return!!e&&"nullValue"in e}function qi(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Bi(e){return!!e&&"mapValue"in e}function ji(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return hi(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ji(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ji(e.arrayValue.values[n]);return t}return Object.assign({},e)}class zi{constructor(e){this.value=e}static empty(){return new zi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Bi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ji(t)}setAll(e){let t=gi.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=ji(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Bi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ri(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Bi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){hi(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new zi(ji(this.value))}}function Ki(e){const t=[];return hi(e.fields,(e,n)=>{const r=new gi([e]);if(Bi(n)){const e=Ki(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new mi(t)}class $i{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new $i(e,0,ci.min(),zi.empty(),0)}static newFoundDocument(e,t,n){return new $i(e,1,t,n,0)}static newNoDocument(e,t){return new $i(e,2,t,zi.empty(),0)}static newUnknownDocument(e,t){return new $i(e,3,t,zi.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=zi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=zi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof $i&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new $i(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Gi{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.A=null}}function Wi(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Gi(e,t,n,r,i,s,o)}function Hi(e){const t=$r(e);if(null===t.A){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+Oi(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Si(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=as(t.startAt)),t.endAt&&(e+="|ub:",e+=as(t.endAt)),t.A=e}return t.A}function Qi(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!us(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if((n=e.filters[i]).op!==(r=t.filters[i]).op||!n.field.isEqual(r.field)||!Ri(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ls(e.startAt,t.startAt)&&ls(e.endAt,t.endAt)}function Ji(e){return Ai.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Yi extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.R(e,t,n):new Xi(e,t,n):"array-contains"===t?new ns(e,n):"in"===t?new rs(e,n):"not-in"===t?new is(e,n):"array-contains-any"===t?new ss(e,n):new Yi(e,t,n)}static R(e,t,n){return"in"===t?new Zi(e,n):new es(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.P(Pi(t,this.value)):null!==t&&Ci(this.value)===Ci(t)&&this.P(Pi(t,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return zr()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Xi extends Yi{constructor(e,t,n){super(e,t,n),this.key=Ai.fromName(n.referenceValue)}matches(e){const t=Ai.comparator(e.key,this.key);return this.P(t)}}class Zi extends Yi{constructor(e,t){super(e,"in",t),this.keys=ts(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class es extends Yi{constructor(e,t){super(e,"not-in",t),this.keys=ts(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ts(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Ai.fromName(e.referenceValue))}class ns extends Yi{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ui(t)&&Di(t.arrayValue,this.value)}}class rs extends Yi{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Di(this.value.arrayValue,t)}}class is extends Yi{constructor(e,t){super(e,"not-in",t)}matches(e){if(Di(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Di(this.value.arrayValue,t)}}class ss extends Yi{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ui(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Di(this.value.arrayValue,e))}}class os{constructor(e,t){this.position=e,this.before=t}}function as(e){return`${e.before?"b":"a"}:${e.position.map(e=>Oi(e)).join(",")}`}class cs{constructor(e,t="asc"){this.field=e,this.dir=t}}function us(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function hs(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Ai.comparator(Ai.fromName(o.referenceValue),n.key):Pi(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function ls(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ri(e.position[n],t.position[n]))return!1;return!0}class ds{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.V=null,this.S=null}}function fs(e,t,n,r,i,s,o,a){return new ds(e,t,n,r,i,s,o,a)}function ps(e){return new ds(e)}function gs(e){return!Si(e.limit)&&"F"===e.limitType}function ms(e){return!Si(e.limit)&&"L"===e.limitType}function ys(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function vs(e){for(const t of e.filters)if(t.v())return t.field;return null}function ws(e){return null!==e.collectionGroup}function Is(e){const t=$r(e);if(null===t.V){t.V=[];const e=vs(t),n=ys(t);if(null!==e&&null===n)e.isKeyField()||t.V.push(new cs(e)),t.V.push(new cs(gi.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.V.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.V.push(new cs(gi.keyField(),e))}}}return t.V}function Ts(e){const t=$r(e);if(!t.S)if("F"===t.limitType)t.S=Wi(t.path,t.collectionGroup,Is(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of Is(t))e.push(new cs(i.field,"desc"===i.dir?"asc":"desc"));const n=t.endAt?new os(t.endAt.position,!t.endAt.before):null,r=t.startAt?new os(t.startAt.position,!t.startAt.before):null;t.S=Wi(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.S}function _s(e,t,n){return new ds(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function bs(e,t){return Qi(Ts(e),Ts(t))&&e.limitType===t.limitType}function Es(e){return`${Hi(Ts(e))}|lt:${e.limitType}`}function Ss(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${Oi(t.value)}`;var t}).join(", ")}]`),Si(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+as(e.startAt)),e.endAt&&(t+=", endAt: "+as(e.endAt)),`Target(${t})`}(Ts(e))}; limitType=${e.limitType})`}function ks(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ai.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!hs(e.startAt,Is(e),t)||e.endAt&&hs(e.endAt,Is(e),t))}(e,t)}function Ns(e){return(t,n)=>{let r=!1;for(const i of Is(e)){const e=As(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function As(e,t,n){const r=e.field.isKeyField()?Ai.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Pi(r,i):zr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return zr()}}function Cs(e,t){if(e.D){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ki(t)?"-0":t}}function Rs(e){return{integerValue:""+e}}function Ds(e,t){return Ni(t)?Rs(t):Cs(e,t)}class Ps{constructor(){this._=void 0}}function xs(e,t,n){return e instanceof Ms?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Fs?Us(e,t):e instanceof Vs?qs(e,t):function(e,t){const n=Ls(e,t),r=js(n)+js(e.C);return Fi(n)&&Fi(e.C)?Rs(r):Cs(e.N,r)}(e,t)}function Os(e,t,n){return e instanceof Fs?Us(e,t):e instanceof Vs?qs(e,t):n}function Ls(e,t){return e instanceof Bs?Fi(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Ms extends Ps{}class Fs extends Ps{constructor(e){super(),this.elements=e}}function Us(e,t){const n=zs(t);for(const r of e.elements)n.some(e=>Ri(e,r))||n.push(r);return{arrayValue:{values:n}}}class Vs extends Ps{constructor(e){super(),this.elements=e}}function qs(e,t){let n=zs(t);for(const r of e.elements)n=n.filter(e=>!Ri(e,r));return{arrayValue:{values:n}}}class Bs extends Ps{constructor(e,t){super(),this.N=e,this.C=t}}function js(e){return Ii(e.integerValue||e.doubleValue)}function zs(e){return Ui(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ks{constructor(e,t){this.field=e,this.transform=t}}class $s{constructor(e,t){this.version=e,this.transformResults=t}}class Gs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Gs}static exists(e){return new Gs(void 0,e)}static updateTime(e){return new Gs(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ws(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Hs{}function Qs(e,t,n){e instanceof eo?function(e,t,n){const r=e.value.clone(),i=ro(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof to?function(e,t,n){if(!Ws(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=ro(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(no(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Js(e,t,n){e instanceof eo?function(e,t,n){if(!Ws(e.precondition,t))return;const r=e.value.clone(),i=io(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(Zs(t),r).setHasLocalMutations()}(e,t,n):e instanceof to?function(e,t,n){if(!Ws(e.precondition,t))return;const r=io(e.fieldTransforms,n,t),i=t.data;i.setAll(no(e)),i.setAll(r),t.convertToFoundDocument(Zs(t),i).setHasLocalMutations()}(e,t,n):function(e,t){Ws(e.precondition,t)&&t.convertToNoDocument(ci.min())}(e,t)}function Ys(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Ls(r.transform,e||null);null!=i&&(null==n&&(n=zi.empty()),n.set(r.field,i))}return n||null}function Xs(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&si(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Fs&&t instanceof Fs||e instanceof Vs&&t instanceof Vs?si(e.elements,t.elements,Ri):e instanceof Bs&&t instanceof Bs?Ri(e.C,t.C):e instanceof Ms&&t instanceof Ms}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function Zs(e){return e.isFoundDocument()?e.version:ci.min()}class eo extends Hs{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class to extends Hs{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function no(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function ro(e,t,n){const r=new Map;Kr(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Os(o,a,n[i]))}return r}function io(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,xs(e,s,t))}return r}class so extends Hs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class oo extends Hs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class ao{constructor(e){this.count=e}}var co,uo;function ho(e){switch(e){default:return zr();case Gr.CANCELLED:case Gr.UNKNOWN:case Gr.DEADLINE_EXCEEDED:case Gr.RESOURCE_EXHAUSTED:case Gr.INTERNAL:case Gr.UNAVAILABLE:case Gr.UNAUTHENTICATED:return!1;case Gr.INVALID_ARGUMENT:case Gr.NOT_FOUND:case Gr.ALREADY_EXISTS:case Gr.PERMISSION_DENIED:case Gr.FAILED_PRECONDITION:case Gr.ABORTED:case Gr.OUT_OF_RANGE:case Gr.UNIMPLEMENTED:case Gr.DATA_LOSS:return!0}}function lo(e){if(void 0===e)return qr("GRPC error has no .code"),Gr.UNKNOWN;switch(e){case co.OK:return Gr.OK;case co.CANCELLED:return Gr.CANCELLED;case co.UNKNOWN:return Gr.UNKNOWN;case co.DEADLINE_EXCEEDED:return Gr.DEADLINE_EXCEEDED;case co.RESOURCE_EXHAUSTED:return Gr.RESOURCE_EXHAUSTED;case co.INTERNAL:return Gr.INTERNAL;case co.UNAVAILABLE:return Gr.UNAVAILABLE;case co.UNAUTHENTICATED:return Gr.UNAUTHENTICATED;case co.INVALID_ARGUMENT:return Gr.INVALID_ARGUMENT;case co.NOT_FOUND:return Gr.NOT_FOUND;case co.ALREADY_EXISTS:return Gr.ALREADY_EXISTS;case co.PERMISSION_DENIED:return Gr.PERMISSION_DENIED;case co.FAILED_PRECONDITION:return Gr.FAILED_PRECONDITION;case co.ABORTED:return Gr.ABORTED;case co.OUT_OF_RANGE:return Gr.OUT_OF_RANGE;case co.UNIMPLEMENTED:return Gr.UNIMPLEMENTED;case co.DATA_LOSS:return Gr.DATA_LOSS;default:return zr()}}(uo=co||(co={}))[uo.OK=0]="OK",uo[uo.CANCELLED=1]="CANCELLED",uo[uo.UNKNOWN=2]="UNKNOWN",uo[uo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",uo[uo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",uo[uo.NOT_FOUND=5]="NOT_FOUND",uo[uo.ALREADY_EXISTS=6]="ALREADY_EXISTS",uo[uo.PERMISSION_DENIED=7]="PERMISSION_DENIED",uo[uo.UNAUTHENTICATED=16]="UNAUTHENTICATED",uo[uo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",uo[uo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",uo[uo.ABORTED=10]="ABORTED",uo[uo.OUT_OF_RANGE=11]="OUT_OF_RANGE",uo[uo.UNIMPLEMENTED=12]="UNIMPLEMENTED",uo[uo.INTERNAL=13]="INTERNAL",uo[uo.UNAVAILABLE=14]="UNAVAILABLE",uo[uo.DATA_LOSS=15]="DATA_LOSS";class fo{constructor(e,t){this.comparator=e,this.root=t||go.EMPTY}insert(e,t){return new fo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,go.BLACK,null,null))}remove(e){return new fo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,go.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new po(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new po(this.root,e,this.comparator,!1)}getReverseIterator(){return new po(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new po(this.root,e,this.comparator,!0)}}class po{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class go{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:go.RED,this.left=null!=r?r:go.EMPTY,this.right=null!=i?i:go.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new go(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return go.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return go.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,go.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,go.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw zr();if(this.right.isRed())throw zr();const e=this.left.check();if(e!==this.right.check())throw zr();return e+(this.isRed()?0:1)}}go.EMPTY=null,go.RED=!0,go.BLACK=!1,go.EMPTY=new class{constructor(){this.size=0}get key(){throw zr()}get value(){throw zr()}get color(){throw zr()}get left(){throw zr()}get right(){throw zr()}copy(e,t,n,r,i){return this}insert(e,t,n){return new go(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class mo{constructor(e){this.comparator=e,this.data=new fo(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new yo(this.data.getIterator())}getIteratorFrom(e){return new yo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof mo))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new mo(this.comparator);return t.data=e,t}}class yo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const vo=new fo(Ai.comparator);function wo(){return vo}const Io=new fo(Ai.comparator);function To(){return Io}const _o=new fo(Ai.comparator);function bo(){return _o}const Eo=new mo(Ai.comparator);function So(...e){let t=Eo;for(const n of e)t=t.add(n);return t}const ko=new mo(ii);function No(){return ko}class Ao{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,Co.createSynthesizedTargetChangeForCurrentChange(e,t)),new Ao(ci.min(),n,No(),wo(),So())}}class Co{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Co(yi.EMPTY_BYTE_STRING,t,So(),So(),So())}}class Ro{constructor(e,t,n,r){this.k=e,this.removedTargetIds=t,this.key=n,this.$=r}}class Do{constructor(e,t){this.targetId=e,this.O=t}}class Po{constructor(e,t,n=yi.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class xo{constructor(){this.F=0,this.M=Mo(),this.L=yi.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(e){e.approximateByteSize()>0&&(this.U=!0,this.L=e)}W(){let e=So(),t=So(),n=So();return this.M.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:zr()}}),new Co(this.L,this.B,e,t,n)}G(){this.U=!1,this.M=Mo()}H(e,t){this.U=!0,this.M=this.M.insert(e,t)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}}class Oo{constructor(e){this.tt=e,this.et=new Map,this.nt=wo(),this.st=Lo(),this.it=new mo(ii)}rt(e){for(const t of e.k)e.$&&e.$.isFoundDocument()?this.ot(t,e.$):this.at(t,e.key,e.$);for(const t of e.removedTargetIds)this.at(t,e.key,e.$)}ct(e){this.forEachTarget(e,t=>{const n=this.ut(t);switch(e.state){case 0:this.ht(t)&&n.j(e.resumeToken);break;case 1:n.X(),n.q||n.G(),n.j(e.resumeToken);break;case 2:n.X(),n.q||this.removeTarget(t);break;case 3:this.ht(t)&&(n.Z(),n.j(e.resumeToken));break;case 4:this.ht(t)&&(this.lt(t),n.j(e.resumeToken));break;default:zr()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.et.forEach((e,n)=>{this.ht(n)&&t(n)})}ft(e){const t=e.targetId,n=e.O.count,r=this.dt(t);if(r){const e=r.target;if(Ji(e))if(0===n){const n=new Ai(e.path);this.at(t,n,$i.newNoDocument(n,ci.min()))}else Kr(1===n);else this.wt(t)!==n&&(this.lt(t),this.it=this.it.add(t))}}_t(e){const t=new Map;this.et.forEach((n,r)=>{const i=this.dt(r);if(i){if(n.current&&Ji(i.target)){const t=new Ai(i.target.path);null!==this.nt.get(t)||this.gt(r,t)||this.at(r,t,$i.newNoDocument(t,e))}n.K&&(t.set(r,n.W()),n.G())}});let n=So();this.st.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.dt(e);return!t||2===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))});const r=new Ao(e,t,this.it,this.nt,n);return this.nt=wo(),this.st=Lo(),this.it=new mo(ii),r}ot(e,t){if(!this.ht(e))return;const n=this.gt(e,t.key)?2:0;this.ut(e).H(t.key,n),this.nt=this.nt.insert(t.key,t),this.st=this.st.insert(t.key,this.yt(t.key).add(e))}at(e,t,n){if(!this.ht(e))return;const r=this.ut(e);this.gt(e,t)?r.H(t,1):r.J(t),this.st=this.st.insert(t,this.yt(t).delete(e)),n&&(this.nt=this.nt.insert(t,n))}removeTarget(e){this.et.delete(e)}wt(e){const t=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let t=this.et.get(e);return t||(t=new xo,this.et.set(e,t)),t}yt(e){let t=this.st.get(e);return t||(t=new mo(ii),this.st=this.st.insert(e,t)),t}ht(e){const t=null!==this.dt(e);return t||Vr("WatchChangeAggregator","Detected inactive target",e),t}dt(e){const t=this.et.get(e);return t&&t.q?null:this.tt.Tt(e)}lt(e){this.et.set(e,new xo),this.tt.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}gt(e,t){return this.tt.getRemoteKeysForTarget(e).has(t)}}function Lo(){return new fo(Ai.comparator)}function Mo(){return new fo(Ai.comparator)}const Fo={asc:"ASCENDING",desc:"DESCENDING"},Uo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Vo{constructor(e,t){this.databaseId=e,this.D=t}}function qo(e,t){return e.D?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Bo(e,t){return e.D?t.toBase64():t.toUint8Array()}function jo(e,t){return qo(e,t.toTimestamp())}function zo(e){return Kr(!!e),ci.fromTimestamp(function(e){const t=wi(e);return new ai(t.seconds,t.nanos)}(e))}function Ko(e,t){return function(e){return new fi(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function $o(e){const t=fi.fromString(e);return Kr(ga(t)),t}function Go(e,t){return Ko(e.databaseId,t.path)}function Wo(e,t){const n=$o(t);if(n.get(1)!==e.databaseId.projectId)throw new Wr(Gr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Wr(Gr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Ai(Yo(n))}function Ho(e,t){return Ko(e.databaseId,t)}function Qo(e){const t=$o(e);return 4===t.length?fi.emptyPath():Yo(t)}function Jo(e){return new fi(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Yo(e){return Kr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Xo(e,t,n){return{name:Go(e,t),fields:n.value.mapValue.fields}}function Zo(e,t,n){const r=Wo(e,t.name),i=zo(t.updateTime),s=new zi({mapValue:{fields:t.fields}}),o=$i.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ea(e,t){let n;if(t instanceof eo)n={update:Xo(e,t.key,t.value)};else if(t instanceof so)n={delete:Go(e,t.key)};else if(t instanceof to)n={update:Xo(e,t.key,t.data),updateMask:pa(t.fieldMask)};else{if(!(t instanceof oo))return zr();n={verify:Go(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Ms)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Fs)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Vs)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Bs)return{fieldPath:t.field.canonicalString(),increment:n.C};throw zr()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:jo(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:zr()}(e,t.precondition)),n}function ta(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Gs.updateTime(zo(e.updateTime)):void 0!==e.exists?Gs.exists(e.exists):Gs.none()}(t.currentDocument):Gs.none(),r=t.updateTransforms?t.updateTransforms.map(t=>function(e,t){let n=null;"setToServerValue"in t?(Kr("REQUEST_TIME"===t.setToServerValue),n=new Ms):"appendMissingElements"in t?n=new Fs(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new Vs(t.removeAllFromArray.values||[]):"increment"in t?n=new Bs(e,t.increment):zr();const r=gi.fromServerFormat(t.fieldPath);return new Ks(r,n)}(e,t)):[];if(t.update){const i=Wo(e,t.update.name),s=new zi({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){return new mi((e.fieldPaths||[]).map(e=>gi.fromServerFormat(e)))}(t.updateMask);return new to(i,s,e,n,r)}return new eo(i,s,n,r)}if(t.delete){const r=Wo(e,t.delete);return new so(r,n)}if(t.verify){const r=Wo(e,t.verify);return new oo(r,n)}return zr()}function na(e,t){return{documents:[Ho(e,t.path)]}}function ra(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Ho(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Ho(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map(e=>function(e){if("=="===e.op){if(qi(e.value))return{unaryFilter:{field:ha(e.field),op:"IS_NAN"}};if(Vi(e.value))return{unaryFilter:{field:ha(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(qi(e.value))return{unaryFilter:{field:ha(e.field),op:"IS_NOT_NAN"}};if(Vi(e.value))return{unaryFilter:{field:ha(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ha(e.field),op:ua(e.op),value:e.value}}}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:ha(e.field),direction:ca(e.dir)}}(e))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.D||Si(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=oa(t.startAt)),t.endAt&&(n.structuredQuery.endAt=oa(t.endAt)),n}function ia(e){let t=Qo(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Kr(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=sa(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new cs(la(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Si(t)?null:t}(n.limit));let c=null;n.startAt&&(c=aa(n.startAt));let u=null;return n.endAt&&(u=aa(n.endAt)),fs(t,i,o,s,a,"F",c,u)}function sa(e){return e?void 0!==e.unaryFilter?[fa(e)]:void 0!==e.fieldFilter?[da(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>sa(e)).reduce((e,t)=>e.concat(t)):zr():[]}function oa(e){return{before:e.before,values:e.position}}function aa(e){return new os(e.values||[],!!e.before)}function ca(e){return Fo[e]}function ua(e){return Uo[e]}function ha(e){return{fieldPath:e.canonicalString()}}function la(e){return gi.fromServerFormat(e.fieldPath)}function da(e){return Yi.create(la(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return zr()}}(e.fieldFilter.op),e.fieldFilter.value)}function fa(e){switch(e.unaryFilter.op){case"IS_NAN":const t=la(e.unaryFilter.field);return Yi.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=la(e.unaryFilter.field);return Yi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=la(e.unaryFilter.field);return Yi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=la(e.unaryFilter.field);return Yi.create(i,"!=",{nullValue:"NULL_VALUE"});default:return zr()}}function pa(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function ga(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function ma(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=va(t)),t=ya(e.get(n),t);return va(t)}function ya(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function va(e){return e+"\x01\x01"}function wa(e){const t=e.length;if(Kr(t>=2),2===t)return Kr("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),fi.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("\x01",s);switch((t<0||t>n)&&zr(),e.charAt(t+1)){case"\x01":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:zr()}s=t+2}return new fi(r)}class Ia{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class Ta{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}Ta.store="owner",Ta.key="owner";class _a{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}_a.store="mutationQueues",_a.keyPath="userId";class ba{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}ba.store="mutations",ba.keyPath="batchId",ba.userMutationsIndex="userMutationsIndex",ba.userMutationsKeyPath=["userId","batchId"];class Ea{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,ma(t)]}static key(e,t,n){return[e,ma(t),n]}}Ea.store="documentMutations",Ea.PLACEHOLDER=new Ea;class Sa{constructor(e,t){this.path=e,this.readTime=t}}class ka{constructor(e,t){this.path=e,this.version=t}}class Na{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}Na.store="remoteDocuments",Na.readTimeIndex="readTimeIndex",Na.readTimeIndexPath="readTime",Na.collectionReadTimeIndex="collectionReadTimeIndex",Na.collectionReadTimeIndexPath=["parentPath","readTime"];class Aa{constructor(e){this.byteSize=e}}Aa.store="remoteDocumentGlobal",Aa.key="remoteDocumentGlobalKey";class Ca{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}Ca.store="targets",Ca.keyPath="targetId",Ca.queryTargetsIndexName="queryTargetsIndex",Ca.queryTargetsKeyPath=["canonicalId","targetId"];class Ra{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}Ra.store="targetDocuments",Ra.keyPath=["targetId","path"],Ra.documentTargetsIndex="documentTargetsIndex",Ra.documentTargetsKeyPath=["path","targetId"];class Da{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}Da.key="targetGlobalKey",Da.store="targetGlobal";class Pa{constructor(e,t){this.collectionId=e,this.parent=t}}Pa.store="collectionParents",Pa.keyPath=["collectionId","parent"];class xa{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}xa.store="clientMetadata",xa.keyPath="clientId";class Oa{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}Oa.store="bundles",Oa.keyPath="bundleId";class La{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}La.store="namedQueries",La.keyPath="name";const Ma=[_a.store,ba.store,Ea.store,Na.store,Ca.store,Ta.store,Da.store,Ra.store,xa.store,Aa.store,Pa.store,Oa.store,La.store],Fa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ua{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class Va{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&zr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Va((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Va?t:Va.resolve(t)}catch(e){return Va.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Va.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Va.reject(t)}static resolve(e){return new Va((t,n)=>{t(e)})}static reject(e){return new Va((t,n)=>{n(e)})}static waitFor(e){return new Va((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=Va.resolve(!1);for(const n of e)t=t.next(e=>e?Va.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}}class qa{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.Et=new Hr,this.transaction.oncomplete=()=>{this.Et.resolve()},this.transaction.onabort=()=>{t.error?this.Et.reject(new za(e,t.error)):this.Et.resolve()},this.transaction.onerror=t=>{const n=Ha(t.target.error);this.Et.reject(new za(e,n))}}static open(e,t,n,r){try{return new qa(t,e.transaction(r,n))}catch(e){throw new za(t,e)}}get It(){return this.Et.promise}abort(e){e&&this.Et.reject(e),this.aborted||(Vr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new $a(t)}}class Ba{constructor(e,t,n){this.name=e,this.version=t,this.At=n,12.2===Ba.Rt((0,k.z$)())&&qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Vr("SimpleDb","Removing database:",e),Ga(window.indexedDB.deleteDatabase(e)).toPromise()}static bt(){if(!(0,k.hl)())return!1;if(Ba.Pt())return!0;const e=(0,k.z$)(),t=Ba.Rt(e),n=0<t&&t<10,r=Ba.vt(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static Pt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Vt)}static St(e,t){return e.store(t)}static Rt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Dt(e){return this.db||(Vr("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new za(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;n("VersionError"===r.name?new Wr(Gr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===r.name?new Wr(Gr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r):new za(e,r))},r.onupgradeneeded=e=>{Vr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion),this.At.Ct(e.target.result,r.transaction,e.oldVersion,this.version).next(()=>{Vr("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Nt&&(this.db.onversionchange=e=>this.Nt(e)),this.db}xt(e){this.Nt=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.Dt(e);const t=qa.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).catch(e=>(t.abort(e),Va.reject(e))).toPromise();return s.catch(()=>{}),await t.It,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(Vr("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ja{constructor(e){this.kt=e,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(e){this.kt=e}done(){this.$t=!0}Mt(e){this.Ot=e}delete(){return Ga(this.kt.delete())}}class za extends Wr{constructor(e,t){super(Gr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ka(e){return"IndexedDbTransactionError"===e.name}class $a{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Vr("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Vr("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Ga(n)}add(e){return Vr("SimpleDb","ADD",this.store.name,e,e),Ga(this.store.add(e))}get(e){return Ga(this.store.get(e)).next(t=>(void 0===t&&(t=null),Vr("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return Vr("SimpleDb","DELETE",this.store.name,e),Ga(this.store.delete(e))}count(){return Vr("SimpleDb","COUNT",this.store.name),Ga(this.store.count())}Lt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Bt(n,(e,t)=>{r.push(t)}).next(()=>r)}Ut(e,t){Vr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.qt=!1;const r=this.cursor(n);return this.Bt(r,(e,t,n)=>n.delete())}Kt(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.Bt(r,t)}jt(e){const t=this.cursor({});return new Va((n,r)=>{t.onerror=e=>{const t=Ha(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}Bt(e,t){const n=[];return new Va((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new ja(i),o=t(i.primaryKey,i.value,s);if(o instanceof Va){const e=o.catch(e=>(s.done(),Va.reject(e)));n.push(e)}s.isDone?r():null===s.Ft?i.continue():i.continue(s.Ft)}}).next(()=>Va.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.qt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ga(e){return new Va((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{const t=Ha(e.target.error);n(t)}})}let Wa=!1;function Ha(e){const t=Ba.Rt((0,k.z$)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Wr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Wa||(Wa=!0,setTimeout(()=>{throw e},0)),e}}return e}class Qa extends Ua{constructor(e,t){super(),this.Qt=e,this.currentSequenceNumber=t}}function Ja(e,t){const n=$r(e);return Ba.St(n.Qt,t)}class Ya{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Qs(t,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Js(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Js(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(ci.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),So())}isEqual(e){return this.batchId===e.batchId&&si(this.mutations,e.mutations,(e,t)=>Xs(e,t))&&si(this.baseMutations,e.baseMutations,(e,t)=>Xs(e,t))}}class Xa{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Kr(e.mutations.length===n.length);let r=bo();const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new Xa(e,t,n,r)}}class Za{constructor(e,t,n,r,i=ci.min(),s=ci.min(),o=yi.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new Za(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Za(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Za(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class ec{constructor(e){this.Wt=e}}function tc(e,t){if(t.document)return Zo(e.Wt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=Ai.fromSegments(t.noDocument.path),n=oc(t.noDocument.readTime),r=$i.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=Ai.fromSegments(t.unknownDocument.path),n=oc(t.unknownDocument.version);return $i.newUnknownDocument(e,n)}return zr()}function nc(e,t,n){const r=rc(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){const n=function(e,t){return{name:Go(e,t.key),fields:t.data.value.mapValue.fields,updateTime:qo(e,t.version.toTimestamp())}}(e.Wt,t);return new Na(null,null,n,t.hasCommittedMutations,r,i)}if(t.isNoDocument()){const e=t.key.path.toArray(),n=sc(t.version),s=t.hasCommittedMutations;return new Na(null,new Sa(e,n),null,s,r,i)}if(t.isUnknownDocument()){const e=t.key.path.toArray(),n=sc(t.version);return new Na(new ka(e,n),null,null,!0,r,i)}return zr()}function rc(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function ic(e){const t=new ai(e[0],e[1]);return ci.fromTimestamp(t)}function sc(e){const t=e.toTimestamp();return new Ia(t.seconds,t.nanoseconds)}function oc(e){const t=new ai(e.seconds,e.nanoseconds);return ci.fromTimestamp(t)}function ac(e,t){const n=(t.baseMutations||[]).map(t=>ta(e.Wt,t));for(let s=0;s<t.mutations.length-1;++s){const e=t.mutations[s];s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform&&(e.updateTransforms=t.mutations[s+1].transform.fieldTransforms,t.mutations.splice(s+1,1),++s)}const r=t.mutations.map(t=>ta(e.Wt,t)),i=ai.fromMillis(t.localWriteTimeMs);return new Ya(t.batchId,i,n,r)}function cc(e){const t=oc(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?oc(e.lastLimboFreeSnapshotVersion):ci.min();let r;var i;return void 0!==e.query.documents?(Kr(1===(i=e.query).documents.length),r=Ts(ps(Qo(i.documents[0])))):r=function(e){return Ts(ia(e))}(e.query),new Za(r,e.targetId,0,e.lastListenSequenceNumber,t,n,yi.fromBase64String(e.resumeToken))}function uc(e,t){const n=sc(t.snapshotVersion),r=sc(t.lastLimboFreeSnapshotVersion);let i;i=Ji(t.target)?na(e.Wt,t.target):ra(e.Wt,t.target);const s=t.resumeToken.toBase64();return new Ca(t.targetId,Hi(t.target),n,s,t.sequenceNumber,r,i)}function hc(e){const t=ia({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?_s(t,t.limit,"L"):t}class lc{getBundleMetadata(e,t){return dc(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:oc(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return dc(e).put({bundleId:(n=t).id,createTime:sc(zo(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return fc(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:hc(t.bundledQuery),readTime:oc(t.readTime)};var t})}saveNamedQuery(e,t){return fc(e).put(function(e){return{name:e.name,readTime:sc(zo(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function dc(e){return Ja(e,Oa.store)}function fc(e){return Ja(e,La.store)}class pc{constructor(){this.Gt=new gc}addToCollectionParentIndex(e,t){return this.Gt.add(t),Va.resolve()}getCollectionParents(e,t){return Va.resolve(this.Gt.getEntries(t))}}class gc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new mo(fi.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new mo(fi.comparator)).toArray()}}class mc{constructor(){this.zt=new gc}addToCollectionParentIndex(e,t){if(!this.zt.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.zt.add(t)});const i={collectionId:n,parent:ma(r)};return yc(e).put(i)}return Va.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[oi(t),""],!1,!0);return yc(e).Lt(r).next(e=>{for(const r of e){if(r.collectionId!==t)break;n.push(wa(r.parent))}return n})}}function yc(e){return Ja(e,Pa.store)}const vc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class wc{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new wc(e,wc.DEFAULT_COLLECTION_PERCENTILE,wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Ic(e,t,n){const r=e.store(ba.store),i=e.store(Ea.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Kt({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{Kr(1===a)}));const u=[];for(const h of n.mutations){const e=Ea.key(t,h.key.path,n.batchId);s.push(i.delete(e)),u.push(h.key)}return Va.waitFor(s).next(()=>u)}function Tc(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw zr();t=e.noDocument}return JSON.stringify(t).length}wc.DEFAULT_COLLECTION_PERCENTILE=10,wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wc.DEFAULT=new wc(41943040,wc.DEFAULT_COLLECTION_PERCENTILE,wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wc.DISABLED=new wc(-1,0,0);class _c{constructor(e,t,n,r){this.userId=e,this.N=t,this.Ht=n,this.referenceDelegate=r,this.Jt={}}static Yt(e,t,n,r){Kr(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new _c(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ec(e).Kt({index:ba.userMutationsIndex,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){const i=Sc(e),s=Ec(e);return s.add({}).next(o=>{Kr("number"==typeof o);const a=new Ya(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map(t=>ea(e.Wt,t)),i=n.mutations.map(t=>ea(e.Wt,t));return new ba(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(this.N,this.userId,a),u=[];let h=new mo((e,t)=>ii(e.canonicalString(),t.canonicalString()));for(const e of r){const t=Ea.key(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Ea.PLACEHOLDER))}return h.forEach(t=>{u.push(this.Ht.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Jt[o]=a.keys()}),Va.waitFor(u).next(()=>a)})}lookupMutationBatch(e,t){return Ec(e).get(t).next(e=>e?(Kr(e.userId===this.userId),ac(this.N,e)):null)}Xt(e,t){return this.Jt[t]?Va.resolve(this.Jt[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){const n=e.keys();return this.Jt[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Ec(e).Kt({index:ba.userMutationsIndex,range:r},(e,t,r)=>{t.userId===this.userId&&(Kr(t.batchId>=n),i=ac(this.N,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ec(e).Kt({index:ba.userMutationsIndex,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ec(e).Lt(ba.userMutationsIndex,t).next(e=>e.map(e=>ac(this.N,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ea.prefixForPath(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Sc(e).Kt({range:r},(n,r,s)=>{const[o,a,c]=n,u=wa(a);if(o===this.userId&&t.path.isEqual(u))return Ec(e).get(c).next(e=>{if(!e)throw zr();Kr(e.userId===this.userId),i.push(ac(this.N,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new mo(ii);const r=[];return t.forEach(t=>{const i=Ea.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Sc(e).Kt({range:s},(e,r,i)=>{const[s,o,a]=e,c=wa(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()});r.push(o)}),Va.waitFor(r).next(()=>this.Zt(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Ea.prefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new mo(ii);return Sc(e).Kt({range:s},(e,t,i)=>{const[s,a,c]=e,u=wa(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()}).next(()=>this.Zt(e,o))}Zt(e,t){const n=[],r=[];return t.forEach(t=>{r.push(Ec(e).get(t).next(e=>{if(null===e)throw zr();Kr(e.userId===this.userId),n.push(ac(this.N,e))}))}),Va.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return Ic(e.Qt,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.te(t.batchId)}),Va.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}te(e){delete this.Jt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return Va.resolve();const n=IDBKeyRange.lowerBound(Ea.prefixForUser(this.userId)),r=[];return Sc(e).Kt({range:n},(e,t,n)=>{if(e[0]===this.userId){const t=wa(e[1]);r.push(t)}else n.done()}).next(()=>{Kr(0===r.length)})})}containsKey(e,t){return bc(e,this.userId,t)}ee(e){return kc(e).get(this.userId).next(e=>e||new _a(this.userId,-1,""))}}function bc(e,t,n){const r=Ea.prefixForPath(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Sc(e).Kt({range:s,qt:!0},(e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()}).next(()=>o)}function Ec(e){return Ja(e,ba.store)}function Sc(e){return Ja(e,Ea.store)}function kc(e){return Ja(e,_a.store)}class Nc{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new Nc(0)}static ie(){return new Nc(-1)}}class Ac{constructor(e,t){this.referenceDelegate=e,this.N=t}allocateTargetId(e){return this.re(e).next(t=>{const n=new Nc(t.highestTargetId);return t.highestTargetId=n.next(),this.oe(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.re(e).next(e=>ci.fromTimestamp(new ai(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.re(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.re(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.oe(e,r)))}addTargetData(e,t){return this.ae(e,t).next(()=>this.re(e).next(n=>(n.targetCount+=1,this.ce(t,n),this.oe(e,n))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Cc(e).delete(t.targetId)).next(()=>this.re(e)).next(t=>(Kr(t.targetCount>0),t.targetCount-=1,this.oe(e,t)))}removeTargets(e,t,n){let r=0;const i=[];return Cc(e).Kt((s,o)=>{const a=cc(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))}).next(()=>Va.waitFor(i)).next(()=>r)}forEachTarget(e,t){return Cc(e).Kt((e,n)=>{const r=cc(n);t(r)})}re(e){return Rc(e).get(Da.key).next(e=>(Kr(null!==e),e))}oe(e,t){return Rc(e).put(Da.key,t)}ae(e,t){return Cc(e).put(uc(this.N,t))}ce(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.re(e).next(e=>e.targetCount)}getTargetData(e,t){const n=Hi(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Cc(e).Kt({range:r,index:Ca.queryTargetsIndexName},(e,n,r)=>{const s=cc(n);Qi(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){const r=[],i=Dc(e);return t.forEach(t=>{const s=ma(t.path);r.push(i.put(new Ra(n,s))),r.push(this.referenceDelegate.addReference(e,n,t))}),Va.waitFor(r)}removeMatchingKeys(e,t,n){const r=Dc(e);return Va.forEach(t,t=>{const i=ma(t.path);return Va.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){const n=Dc(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Dc(e);let i=So();return r.Kt({range:n,qt:!0},(e,t,n)=>{const r=wa(e[1]),s=new Ai(r);i=i.add(s)}).next(()=>i)}containsKey(e,t){const n=ma(t.path),r=IDBKeyRange.bound([n],[oi(n)],!1,!0);let i=0;return Dc(e).Kt({index:Ra.documentTargetsIndex,qt:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}Tt(e,t){return Cc(e).get(t).next(e=>e?cc(e):null)}}function Cc(e){return Ja(e,Ca.store)}function Rc(e){return Ja(e,Da.store)}function Dc(e){return Ja(e,Ra.store)}async function Pc(e){if(e.code!==Gr.FAILED_PRECONDITION||e.message!==Fa)throw e;Vr("LocalStore","Unexpectedly lost primary lease")}function xc([e,t],[n,r]){const i=ii(e,n);return 0===i?ii(t,r):i}class Oc{constructor(e){this.ue=e,this.buffer=new mo(xc),this.he=0}le(){return++this.he}fe(e){const t=[e,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();xc(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Lc{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.de=!1,this.we=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(e)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(e){const t=this.de?3e5:6e4;Vr("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.we=null,this.de=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){Ka(e)?Vr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Pc(e)}await this._e(e)})}}class Mc{constructor(e,t){this.me=e,this.params=t}calculateTargetCount(e,t){return this.me.ge(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Va.resolve(ti.T);const n=new Oc(t);return this.me.forEachTarget(e,e=>n.fe(e.sequenceNumber)).next(()=>this.me.ye(e,e=>n.fe(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.me.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.me.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector","Garbage collection skipped; disabled"),Va.resolve(vc)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vc):this.pe(e,t))}getCacheSize(e){return this.me.getCacheSize(e)}pe(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(Vr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(c=Date.now(),Ur()<=S.in.DEBUG&&Vr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Va.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class Fc{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Mc(e,t)}(this,t)}ge(e){const t=this.Te(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Te(e){let t=0;return this.ye(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ye(e,t){return this.Ee(e,(e,n)=>t(n))}addReference(e,t,n){return Uc(e,n)}removeReference(e,t,n){return Uc(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Uc(e,t)}Ie(e,t){return function(e,t){let n=!1;return kc(e).jt(r=>bc(e,r,t).next(e=>(e&&(n=!0),Va.resolve(!e)))).next(()=>n)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Ee(e,(s,o)=>{if(o<=t){const t=this.Ie(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s),Dc(e).delete([0,ma(s.path)])))});r.push(t)}}).next(()=>Va.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Uc(e,t)}Ee(e,t){const n=Dc(e);let r,i=ti.T;return n.Kt({index:Ra.documentTargetsIndex},([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==ti.T&&t(new Ai(wa(r)),i),i=o,r=s):i=ti.T}).next(()=>{i!==ti.T&&t(new Ai(wa(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Uc(e,t){return Dc(e).put(function(e,t){return new Ra(0,ma(e.path),t)}(t,e.currentSequenceNumber))}class Vc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(e){hi(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return li(this.inner)}}class qc{constructor(){this.changes=new Vc(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:ci.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:$i.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Va.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Bc{constructor(e,t){this.N=e,this.Ht=t}addEntry(e,t,n){return Kc(e).put($c(t),n)}removeEntry(e,t){const n=Kc(e),r=$c(t);return n.delete(r)}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Ae(e,n)))}getEntry(e,t){return Kc(e).get($c(t)).next(e=>this.Re(t,e))}be(e,t){return Kc(e).get($c(t)).next(e=>({document:this.Re(t,e),size:Tc(e)}))}getEntries(e,t){let n=wo();return this.Pe(e,t,(e,t)=>{const r=this.Re(e,t);n=n.insert(e,r)}).next(()=>n)}ve(e,t){let n=wo(),r=new fo(Ai.comparator);return this.Pe(e,t,(e,t)=>{const i=this.Re(e,t);n=n.insert(e,i),r=r.insert(e,Tc(t))}).next(()=>({documents:n,Ve:r}))}Pe(e,t,n){if(t.isEmpty())return Va.resolve();const r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let s=i.getNext();return Kc(e).Kt({range:r},(e,t,r)=>{const o=Ai.fromSegments(e);for(;s&&Ai.comparator(s,o)<0;)n(s,null),s=i.getNext();s&&s.isEqual(o)&&(n(s,t),s=i.hasNext()?i.getNext():null),s?r.Mt(s.path.toArray()):r.done()}).next(()=>{for(;s;)n(s,null),s=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,t,n){let r=wo();const i=t.path.length+1,s={};if(n.isEqual(ci.min())){const e=t.path.toArray();s.range=IDBKeyRange.lowerBound(e)}else{const e=t.path.toArray(),r=rc(n);s.range=IDBKeyRange.lowerBound([e,r],!0),s.index=Na.collectionReadTimeIndex}return Kc(e).Kt(s,(e,n,s)=>{if(e.length!==i)return;const o=tc(this.N,n);t.path.isPrefixOf(o.key.path)?ks(t,o)&&(r=r.insert(o.key,o)):s.done()}).next(()=>r)}newChangeBuffer(e){return new jc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return zc(e).get(Aa.key).next(e=>(Kr(!!e),e))}Ae(e,t){return zc(e).put(Aa.key,t)}Re(e,t){if(t){const e=tc(this.N,t);if(!e.isNoDocument()||!e.version.isEqual(ci.min()))return e}return $i.newInvalidDocument(e)}}class jc extends qc{constructor(e,t){super(),this.Se=e,this.trackRemovals=t,this.De=new Vc(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){const t=[];let n=0,r=new mo((e,t)=>ii(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{const o=this.De.get(i);if(s.document.isValidDocument()){const a=nc(this.Se.N,s.document,this.getReadTime(i));r=r.add(i.path.popLast());const c=Tc(a);n+=c-o,t.push(this.Se.addEntry(e,i,a))}else if(n-=o,this.trackRemovals){const n=nc(this.Se.N,$i.newNoDocument(i,ci.min()),this.getReadTime(i));t.push(this.Se.addEntry(e,i,n))}else t.push(this.Se.removeEntry(e,i))}),r.forEach(n=>{t.push(this.Se.Ht.addToCollectionParentIndex(e,n))}),t.push(this.Se.updateMetadata(e,n)),Va.waitFor(t)}getFromCache(e,t){return this.Se.be(e,t).next(e=>(this.De.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Se.ve(e,t).next(({documents:e,Ve:t})=>(t.forEach((e,t)=>{this.De.set(e,t)}),e))}}function zc(e){return Ja(e,Aa.store)}function Kc(e){return Ja(e,Na.store)}function $c(e){return e.path.toArray()}class Gc{constructor(e){this.N=e}Ct(e,t,n,r){Kr(n<r&&n>=0&&r<=11);const i=new qa("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(Ta.store)}(e),function(e){e.createObjectStore(_a.store,{keyPath:_a.keyPath}),e.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0}),e.createObjectStore(Ea.store)}(e),Wc(e),function(e){e.createObjectStore(Na.store)}(e));let s=Va.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Ra.store),e.deleteObjectStore(Ca.store),e.deleteObjectStore(Da.store)}(e),Wc(e)),s=s.next(()=>function(e){const t=e.store(Da.store),n=new Da(0,0,ci.min().toTimestamp(),0);return t.put(Da.key,n)}(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>function(e,t){return t.store(ba.store).Lt().next(n=>{e.deleteObjectStore(ba.store),e.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0});const r=t.store(ba.store),i=n.map(e=>r.put(e));return Va.waitFor(i)})}(e,i))),s=s.next(()=>{!function(e){e.createObjectStore(xa.store,{keyPath:xa.keyPath})}(e)})),n<5&&r>=5&&(s=s.next(()=>this.Ce(i))),n<6&&r>=6&&(s=s.next(()=>(function(e){e.createObjectStore(Aa.store)}(e),this.Ne(i)))),n<7&&r>=7&&(s=s.next(()=>this.xe(i))),n<8&&r>=8&&(s=s.next(()=>this.ke(e,i))),n<9&&r>=9&&(s=s.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){const t=e.objectStore(Na.store);t.createIndex(Na.readTimeIndex,Na.readTimeIndexPath,{unique:!1}),t.createIndex(Na.collectionReadTimeIndex,Na.collectionReadTimeIndexPath,{unique:!1})}(t)})),n<10&&r>=10&&(s=s.next(()=>this.$e(i))),n<11&&r>=11&&(s=s.next(()=>{!function(e){e.createObjectStore(Oa.store,{keyPath:Oa.keyPath})}(e),function(e){e.createObjectStore(La.store,{keyPath:La.keyPath})}(e)})),s}Ne(e){let t=0;return e.store(Na.store).Kt((e,n)=>{t+=Tc(n)}).next(()=>{const n=new Aa(t);return e.store(Aa.store).put(Aa.key,n)})}Ce(e){const t=e.store(_a.store),n=e.store(ba.store);return t.Lt().next(t=>Va.forEach(t,t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.Lt(ba.userMutationsIndex,r).next(n=>Va.forEach(n,n=>{Kr(n.userId===t.userId);const r=ac(this.N,n);return Ic(e,t.userId,r).next(()=>{})}))}))}xe(e){const t=e.store(Ra.store),n=e.store(Na.store);return e.store(Da.store).get(Da.key).next(e=>{const r=[];return n.Kt((n,i)=>{const s=new fi(n),o=function(e){return[0,ma(e)]}(s);r.push(t.get(o).next(n=>n?Va.resolve():(n=>t.put(new Ra(0,ma(n),e.highestListenSequenceNumber)))(s)))}).next(()=>Va.waitFor(r))})}ke(e,t){e.createObjectStore(Pa.store,{keyPath:Pa.keyPath});const n=t.store(Pa.store),r=new gc,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:ma(r)})}};return t.store(Na.store).Kt({qt:!0},(e,t)=>{const n=new fi(e);return i(n.popLast())}).next(()=>t.store(Ea.store).Kt({qt:!0},([e,t,n],r)=>{const s=wa(t);return i(s.popLast())}))}$e(e){const t=e.store(Ca.store);return t.Kt((e,n)=>{const r=cc(n),i=uc(this.N,r);return t.put(i)})}}function Wc(e){e.createObjectStore(Ra.store,{keyPath:Ra.keyPath}).createIndex(Ra.documentTargetsIndex,Ra.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Ca.store,{keyPath:Ca.keyPath}).createIndex(Ca.queryTargetsIndexName,Ca.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Da.store)}const Hc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Qc{constructor(e,t,n,r,i,s,o,a,c,u){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Oe=i,this.window=s,this.document=o,this.Fe=c,this.Me=u,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=e=>Promise.resolve(),!Qc.bt())throw new Wr(Gr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Fc(this,r),this.We=t+"main",this.N=new ec(a),this.Ge=new Ba(this.We,11,new Gc(this.N)),this.ze=new Ac(this.referenceDelegate,this.N),this.Ht=new mc,this.He=function(e,t){return new Bc(e,t)}(this.N,this.Ht),this.Je=new lc,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===u&&qr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Wr(Gr.FAILED_PRECONDITION,Hc);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ze.getHighestSequenceNumber(e))}).then(e=>{this.Le=new ti(e,this.Fe)}).then(()=>{this.Be=!0}).catch(e=>(this.Ge&&this.Ge.close(),Promise.reject(e)))}nn(e){return this.Qe=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ge.xt(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget(async()=>{this.started&&await this.Xe()}))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Yc(e).put(new xa(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(e).next(e=>{e||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(e)).next(t=>this.isPrimary&&!t?this.on(e).next(()=>!1):!!t&&this.an(e).next(()=>!0))).catch(e=>{if(Ka(e))return Vr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Vr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.Qe(e)),this.isPrimary=e})}sn(e){return Jc(e).get(Ta.key).next(e=>Va.resolve(this.cn(e)))}un(e){return Yc(e).delete(this.clientId)}async hn(){if(this.isPrimary&&!this.ln(this.je,18e5)){this.je=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const t=Ja(e,xa.store);return t.Lt().next(e=>{const n=this.fn(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return Va.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ye)for(const t of e)this.Ye.removeItem(this.dn(t.clientId))}}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}cn(e){return!!e&&e.ownerId===this.clientId}rn(e){return this.Me?Va.resolve(!0):Jc(e).get(Ta.key).next(t=>{if(null!==t&&this.ln(t.leaseTimestampMs,5e3)&&!this.wn(t.ownerId)){if(this.cn(t)&&this.networkEnabled)return!0;if(!this.cn(t)){if(!t.allowTabSynchronization)throw new Wr(Gr.FAILED_PRECONDITION,Hc);return!1}}return!(!this.networkEnabled||!this.inForeground)||Yc(e).Lt().next(e=>void 0===this.fn(e,5e3).find(e=>{if(this.clientId!==e.clientId){const t=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(!this.networkEnabled&&e.networkEnabled||t&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&Vr("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Be=!1,this._n(),this.Ke&&(this.Ke.cancel(),this.Ke=null),this.mn(),this.gn(),await this.Ge.runTransaction("shutdown","readwrite",[Ta.store,xa.store],e=>{const t=new Qa(e,ti.T);return this.on(t).next(()=>this.un(t))}),this.Ge.close(),this.yn()}fn(e,t){return e.filter(e=>this.ln(e.updateTimeMs,t)&&!this.wn(e.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",e=>Yc(e).Lt().next(e=>this.fn(e,18e5).map(e=>e.clientId)))}get started(){return this.Be}getMutationQueue(e){return _c.Yt(e,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(e,t,n){let r;return Vr("IndexedDbPersistence","Starting transaction:",e),this.Ge.runTransaction(e,"readonly"===t?"readonly":"readwrite",Ma,i=>(r=new Qa(i,this.Le?this.Le.next():ti.T),"readwrite-primary"===t?this.sn(r).next(e=>!!e||this.rn(r)).next(t=>{if(!t)throw qr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new Wr(Gr.FAILED_PRECONDITION,Fa);return n(r)}).next(e=>this.an(r).next(()=>e)):this.Tn(r).next(()=>n(r)))).then(e=>(r.raiseOnCommittedEvent(),e))}Tn(e){return Jc(e).get(Ta.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)&&!this.cn(e)&&!(this.Me||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Wr(Gr.FAILED_PRECONDITION,Hc)})}an(e){const t=new Ta(this.clientId,this.allowTabSynchronization,Date.now());return Jc(e).put(Ta.key,t)}static bt(){return Ba.bt()}on(e){const t=Jc(e);return t.get(Ta.key).next(e=>this.cn(e)?(Vr("IndexedDbPersistence","Releasing primary lease."),t.delete(Ta.key)):Va.resolve())}ln(e,t){const n=Date.now();return!(e<n-t||e>n&&(qr(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ue=()=>{this._n(),(0,k.G6)()&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(e){var t;try{const n=null!==(null===(t=this.Ye)||void 0===t?void 0:t.getItem(this.dn(e)));return Vr("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return qr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(q){qr("Failed to set zombie client id.",q)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(q){}}dn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Jc(e){return Ja(e,Ta.store)}function Yc(e){return Ja(e,xa.store)}function Xc(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Zc{constructor(e,t){this.progress=e,this.En=t}}class eu{constructor(e,t,n){this.He=e,this.In=t,this.Ht=n}An(e,t){return this.In.getAllMutationBatchesAffectingDocumentKey(e,t).next(n=>this.Rn(e,t,n))}Rn(e,t,n){return this.He.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}bn(e,t){e.forEach((e,n)=>{for(const r of t)r.applyToLocalView(n)})}Pn(e,t){return this.He.getEntries(e,t).next(t=>this.vn(e,t).next(()=>t))}vn(e,t){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.bn(t,e))}getDocumentsMatchingQuery(e,t,n){return function(e){return Ai.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Vn(e,t.path):ws(t)?this.Sn(e,t,n):this.Dn(e,t,n)}Vn(e,t){return this.An(e,new Ai(t)).next(e=>{let t=To();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Sn(e,t,n){const r=t.collectionGroup;let i=To();return this.Ht.getCollectionParents(e,r).next(s=>Va.forEach(s,s=>{const o=function(e,t){return new ds(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.Dn(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}Dn(e,t,n){let r,i;return this.He.getDocumentsMatchingQuery(e,t,n).next(n=>(r=n,this.In.getAllMutationBatchesAffectingQuery(e,t))).next(t=>(i=t,this.Cn(e,i,r).next(e=>{r=e;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=$i.newInvalidDocument(n),r=r.insert(n,i)),Js(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))).next(()=>(r.forEach((e,n)=>{ks(t,n)||(r=r.remove(e))}),r))}Cn(e,t,n){let r=So();for(const s of t)for(const e of s.mutations)e instanceof to&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.He.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class tu{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Nn=n,this.xn=r}static kn(e,t){let n=So(),r=So();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new tu(e,t.fromCache,n,r)}}class nu{$n(e){this.On=e}getDocumentsMatchingQuery(e,t,n,r){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(ci.min())?this.Fn(e,t):this.On.Pn(e,r).next(i=>{const s=this.Mn(t,i);return(gs(t)||ms(t))&&this.Ln(t.limitType,s,r,n)?this.Fn(e,t):(Ur()<=S.in.DEBUG&&Vr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ss(t)),this.On.getDocumentsMatchingQuery(e,t,n).next(e=>(s.forEach(t=>{e=e.insert(t.key,t)}),e)))})}Mn(e,t){let n=new mo(Ns(e));return t.forEach((t,r)=>{ks(e,r)&&(n=n.add(r))}),n}Ln(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Fn(e,t){return Ur()<=S.in.DEBUG&&Vr("QueryEngine","Using full collection scan to execute query:",Ss(t)),this.On.getDocumentsMatchingQuery(e,t,ci.min())}}class ru{constructor(e,t,n,r){this.persistence=e,this.Bn=t,this.N=r,this.Un=new fo(ii),this.qn=new Vc(e=>Hi(e),Qi),this.Kn=ci.min(),this.In=e.getMutationQueue(n),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new eu(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Un))}}function iu(e,t,n,r){return new ru(e,t,n,r)}async function su(e,t){const n=$r(e);let r=n.In,i=n.Qn;const s=await n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.In.getAllMutationBatches(e).next(o=>(s=o,r=n.persistence.getMutationQueue(t),i=new eu(n.jn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e))).next(t=>{const n=[],r=[];let o=So();for(const e of s){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return i.Pn(e,o).next(e=>({Wn:e,removedBatchIds:n,addedBatchIds:r}))})});return n.In=r,n.Qn=i,n.Bn.$n(n.Qn),s}function ou(e){const t=$r(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.ze.getLastRemoteSnapshotVersion(e))}function au(e,t,n,r,i){let s=So();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=wo();return n.forEach((n,o)=>{const a=e.get(n),c=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(ci.min())?(t.removeEntry(n,c),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,c),s=s.insert(n,o)):Vr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),s})}function cu(e,t){const n=$r(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.In.getNextMutationBatchAfterBatchId(e,t)))}function uu(e,t){const n=$r(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.ze.getTargetData(e,t).next(i=>i?(r=i,Va.resolve(r)):n.ze.allocateTargetId(e).next(i=>(r=new Za(t,i,0,e.currentSequenceNumber),n.ze.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.Un.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Un=n.Un.insert(e.targetId,e),n.qn.set(t,e.targetId)),e})}async function hu(e,t,n){const r=$r(e),i=r.Un.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Ka(e))throw e;Vr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Un=r.Un.remove(t),r.qn.delete(i.target)}function lu(e,t,n){const r=$r(e);let i=ci.min(),s=So();return r.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const r=$r(e),i=r.qn.get(n);return void 0!==i?Va.resolve(r.Un.get(i)):r.ze.getTargetData(t,n)}(r,e,Ts(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.ze.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Bn.getDocumentsMatchingQuery(e,t,n?i:ci.min(),n?s:So())).next(e=>({documents:e,Gn:s})))}function du(e,t){const n=$r(e),r=$r(n.ze),i=n.Un.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.Tt(e,t).next(e=>e?e.target:null))}function fu(e){const t=$r(e);return t.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=$r(e);let i=wo(),s=rc(n);const o=Kc(t),a=IDBKeyRange.lowerBound(s,!0);return o.Kt({index:Na.readTimeIndex,range:a},(e,t)=>{const n=tc(r.N,t);i=i.insert(n.key,n),s=t.readTime}).next(()=>({En:i,readTime:ic(s)}))}(t.jn,e,t.Kn)).then(({En:e,readTime:n})=>(t.Kn=n,e))}async function pu(e,t,n=So()){const r=await uu(e,Ts(hc(t.bundledQuery))),i=$r(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{const s=zo(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Je.saveNamedQuery(e,t);const o=r.withResumeToken(yi.EMPTY_BYTE_STRING,s);return i.Un=i.Un.insert(o.targetId,o),i.ze.updateTargetData(e,o).next(()=>i.ze.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.ze.addMatchingKeys(e,n,r.targetId)).next(()=>i.Je.saveNamedQuery(e,t))})}class gu{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,t){return Va.resolve(this.Yn.get(t))}saveBundleMetadata(e,t){var n;return this.Yn.set(t.id,{id:(n=t).id,version:n.version,createTime:zo(n.createTime)}),Va.resolve()}getNamedQuery(e,t){return Va.resolve(this.Xn.get(t))}saveNamedQuery(e,t){return this.Xn.set(t.name,function(e){return{name:e.name,query:hc(e.bundledQuery),readTime:zo(e.readTime)}}(t)),Va.resolve()}}class mu{constructor(){this.Zn=new mo(yu.ts),this.es=new mo(yu.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){const n=new yu(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.rs(new yu(e,t))}os(e,t){e.forEach(e=>this.removeReference(e,t))}cs(e){const t=new Ai(new fi([])),n=new yu(t,e),r=new yu(t,e+1),i=[];return this.es.forEachInRange([n,r],e=>{this.rs(e),i.push(e.key)}),i}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const t=new Ai(new fi([])),n=new yu(t,e),r=new yu(t,e+1);let i=So();return this.es.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new yu(e,0),n=this.Zn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class yu{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return Ai.comparator(e.key,t.key)||ii(e.ls,t.ls)}static ns(e,t){return ii(e.ls,t.ls)||Ai.comparator(e.key,t.key)}}class vu{constructor(e,t){this.Ht=e,this.referenceDelegate=t,this.In=[],this.fs=1,this.ds=new mo(yu.ts)}checkEmpty(e){return Va.resolve(0===this.In.length)}addMutationBatch(e,t,n,r){const i=this.fs;this.fs++;const s=new Ya(i,t,n,r);this.In.push(s);for(const o of r)this.ds=this.ds.add(new yu(o.key,i)),this.Ht.addToCollectionParentIndex(e,o.key.path.popLast());return Va.resolve(s)}lookupMutationBatch(e,t){return Va.resolve(this.ws(t))}getNextMutationBatchAfterBatchId(e,t){const n=this._s(t+1),r=n<0?0:n;return Va.resolve(this.In.length>r?this.In[r]:null)}getHighestUnacknowledgedBatchId(){return Va.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(e){return Va.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new yu(t,0),r=new yu(t,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([n,r],e=>{const t=this.ws(e.ls);i.push(t)}),Va.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new mo(ii);return t.forEach(e=>{const t=new yu(e,0),r=new yu(e,Number.POSITIVE_INFINITY);this.ds.forEachInRange([t,r],e=>{n=n.add(e.ls)})}),Va.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Ai.isDocumentKey(i)||(i=i.child(""));const s=new yu(new Ai(i),0);let o=new mo(ii);return this.ds.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.ls)),!0)},s),Va.resolve(this.gs(o))}gs(e){const t=[];return e.forEach(e=>{const n=this.ws(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){Kr(0===this.ys(t.batchId,"removed")),this.In.shift();let n=this.ds;return Va.forEach(t.mutations,r=>{const i=new yu(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.ds=n})}te(e){}containsKey(e,t){const n=new yu(t,0),r=this.ds.firstAfterOrEqual(n);return Va.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return Va.resolve()}ys(e,t){return this._s(e)}_s(e){return 0===this.In.length?0:e-this.In[0].batchId}ws(e){const t=this._s(e);return t<0||t>=this.In.length?null:this.In[t]}}class wu{constructor(e,t){this.Ht=e,this.ps=t,this.docs=new fo(Ai.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ps(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:o,readTime:n}),this.size+=o-s,this.Ht.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Va.resolve(n?n.document.clone():$i.newInvalidDocument(t))}getEntries(e,t){let n=wo();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.clone():$i.newInvalidDocument(e))}),Va.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=wo();const i=new Ai(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||ks(t,i)&&(r=r.insert(i.key,i.clone()))}return Va.resolve(r)}Ts(e,t){return Va.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Iu(this)}getSize(e){return Va.resolve(this.size)}}class Iu extends qc{constructor(e){super(),this.Se=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.document.isValidDocument()?t.push(this.Se.addEntry(e,r.document,this.getReadTime(n))):this.Se.removeEntry(n)}),Va.waitFor(t)}getFromCache(e,t){return this.Se.getEntry(e,t)}getAllFromCache(e,t){return this.Se.getEntries(e,t)}}class Tu{constructor(e){this.persistence=e,this.Es=new Vc(e=>Hi(e),Qi),this.lastRemoteSnapshotVersion=ci.min(),this.highestTargetId=0,this.Is=0,this.As=new mu,this.targetCount=0,this.Rs=Nc.se()}forEachTarget(e,t){return this.Es.forEach((e,n)=>t(n)),Va.resolve()}getLastRemoteSnapshotVersion(e){return Va.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Va.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),Va.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Is&&(this.Is=t),Va.resolve()}ae(e){this.Es.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Rs=new Nc(t),this.highestTargetId=t),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,Va.resolve()}updateTargetData(e,t){return this.ae(t),Va.resolve()}removeTargetData(e,t){return this.Es.delete(t.target),this.As.cs(t.targetId),this.targetCount-=1,Va.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Es.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Es.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),Va.waitFor(i).next(()=>r)}getTargetCount(e){return Va.resolve(this.targetCount)}getTargetData(e,t){const n=this.Es.get(t)||null;return Va.resolve(n)}addMatchingKeys(e,t,n){return this.As.ss(t,n),Va.resolve()}removeMatchingKeys(e,t,n){this.As.os(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),Va.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.As.cs(t),Va.resolve()}getMatchingKeysForTargetId(e,t){const n=this.As.hs(t);return Va.resolve(n)}containsKey(e,t){return Va.resolve(this.As.containsKey(t))}}class _u{constructor(e,t){this.bs={},this.Le=new ti(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new Tu(this),this.Ht=new pc,this.He=function(e,t){return new wu(e,t)}(this.Ht,e=>this.referenceDelegate.Ps(e)),this.N=new ec(t),this.Je=new gu(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let t=this.bs[e.toKey()];return t||(t=new vu(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=t),t}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,t,n){Vr("MemoryPersistence","Starting transaction:",e);const r=new bu(this.Le.next());return this.referenceDelegate.vs(),n(r).next(e=>this.referenceDelegate.Vs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ss(e,t){return Va.or(Object.values(this.bs).map(n=>()=>n.containsKey(e,t)))}}class bu extends Ua{constructor(e){super(),this.currentSequenceNumber=e}}class Eu{constructor(e){this.persistence=e,this.Ds=new mu,this.Cs=null}static Ns(e){return new Eu(e)}get xs(){if(this.Cs)return this.Cs;throw zr()}addReference(e,t,n){return this.Ds.addReference(n,t),this.xs.delete(n.toString()),Va.resolve()}removeReference(e,t,n){return this.Ds.removeReference(n,t),this.xs.add(n.toString()),Va.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),Va.resolve()}removeTarget(e,t){this.Ds.cs(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}vs(){this.Cs=new Set}Vs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Va.forEach(this.xs,n=>{const r=Ai.fromPath(n);return this.ks(e,r).next(e=>{e||t.removeEntry(r)})}).next(()=>(this.Cs=null,t.apply(e)))}updateLimboDocument(e,t){return this.ks(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}Ps(e){return 0}ks(e,t){return Va.or([()=>Va.resolve(this.Ds.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ss(e,t)])}}function Su(e,t){return`firestore_clients_${e}_${t}`}function ku(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Nu(e,t){return`firestore_targets_${e}_${t}`}class Au{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static $s(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Wr(r.error.code,r.error.message))),s?new Au(e,t,r.state,i):(qr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Cu{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Wr(n.error.code,n.error.message))),i?new Cu(e,n.state,r):(qr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ru{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=No();for(let s=0;r&&s<n.activeTargetIds.length;++s)r=Ni(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new Ru(e,i):(qr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Du{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Du(t.clientId,t.onlineState):(qr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Pu{constructor(){this.activeTargetIds=No()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class xu{constructor(e,t,n,r,i){this.window=e,this.Oe=t,this.persistenceKey=n,this.Ls=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new fo(ii),this.started=!1,this.Ks=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.js=Su(this.persistenceKey,this.Ls),this.Qs=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.qs=this.qs.insert(this.Ls,new Pu),this.Ws=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Hs=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Js=function(e){return`firestore_bundle_loaded_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Bs)}static bt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.pn();for(const n of e){if(n===this.Ls)continue;const e=this.getItem(Su(this.persistenceKey,n));if(e){const t=Ru.$s(n,e);t&&(this.qs=this.qs.insert(t.clientId,t))}}this.Ys();const t=this.storage.getItem(this.Hs);if(t){const e=this.Xs(t);e&&this.Zs(e)}for(const n of this.Ks)this.Us(n);this.Ks=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Qs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(e){let t=!1;return this.qs.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ei(e,"pending")}updateMutationState(e,t,n){this.ei(e,t,n),this.ni(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Nu(this.persistenceKey,e));if(n){const r=Cu.$s(e,n);r&&(t=r.state)}}return this.si.Fs(e),this.Ys(),t}removeLocalQueryTarget(e){this.si.Ms(e),this.Ys()}isLocalQueryTarget(e){return this.si.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Nu(this.persistenceKey,e))}updateQueryState(e,t,n){this.ii(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ni(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.ri(e)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Vr("SharedClientState","READ",e,t),t}setItem(e,t){Vr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Vr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Us(e){const t=e;if(t.storageArea===this.storage){if(Vr("SharedClientState","EVENT",t.key,t.newValue),t.key===this.js)return void qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable(async()=>{if(this.started){if(null!==t.key)if(this.Ws.test(t.key)){if(null==t.newValue){const e=this.ai(t.key);return this.ci(e,null)}{const e=this.ui(t.key,t.newValue);if(e)return this.ci(e.clientId,e)}}else if(this.Gs.test(t.key)){if(null!==t.newValue){const e=this.hi(t.key,t.newValue);if(e)return this.li(e)}}else if(this.zs.test(t.key)){if(null!==t.newValue){const e=this.fi(t.key,t.newValue);if(e)return this.di(e)}}else if(t.key===this.Hs){if(null!==t.newValue){const e=this.Xs(t.newValue);if(e)return this.Zs(e)}}else if(t.key===this.Qs){const e=function(e){let t=ti.T;if(null!=e)try{const n=JSON.parse(e);Kr("number"==typeof n),t=n}catch(e){qr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==ti.T&&this.sequenceNumberHandler(e)}else if(t.key===this.Js)return this.syncEngine.wi()}else this.Ks.push(t)})}}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(e,t,n){const r=new Au(this.currentUser,e,t,n),i=ku(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Os())}ni(e){const t=ku(this.persistenceKey,this.currentUser,e);this.removeItem(t)}ri(e){this.storage.setItem(this.Hs,JSON.stringify({clientId:this.Ls,onlineState:e}))}ii(e,t,n){const r=Nu(this.persistenceKey,e),i=new Cu(e,t,n);this.setItem(r,i.Os())}oi(){this.setItem(this.Js,"value-not-used")}ai(e){const t=this.Ws.exec(e);return t?t[1]:null}ui(e,t){const n=this.ai(e);return Ru.$s(n,t)}hi(e,t){const n=this.Gs.exec(e),r=Number(n[1]);return Au.$s(new Lr(void 0!==n[2]?n[2]:null),r,t)}fi(e,t){const n=this.zs.exec(e),r=Number(n[1]);return Cu.$s(r,t)}Xs(e){return Du.$s(e)}async li(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine._i(e.batchId,e.state,e.error);Vr("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}di(e){return this.syncEngine.mi(e.targetId,e.state,e.error)}ci(e,t){const n=t?this.qs.insert(e,t):this.qs.remove(e),r=this.ti(this.qs),i=this.ti(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.gi(s,o).then(()=>{this.qs=n})}Zs(e){this.qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ti(e){let t=No();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class Ou{constructor(){this.yi=new Pu,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,t,n){this.pi[e]=t}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new Pu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class Lu{Ti(e){}shutdown(){}}class Mu{constructor(){this.Ei=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ti(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}Ii(){Vr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Ri(){Vr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Fu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Uu{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}}class Vu extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(e,t,n,r){const i=this.Bi(e,t);Vr("RestConnection","Sending: ",i,n);const s={};return this.Ui(s,r),this.qi(e,i,s,n).then(e=>(Vr("RestConnection","Received: ",e),e),t=>{throw Br("RestConnection",`${e} failed with error: `,t,"url: ",i,"request:",n),t})}Ki(e,t,n,r){return this.Li(e,t,n,r)}Ui(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+Mr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(const n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])}Bi(e,t){return`${this.Fi}/v1/${t}:${Fu[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(e,t,n,r){return new Promise((i,s)=>{const o=new xr;o.listenOnce(Ar.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case Nr.NO_ERROR:const t=o.getResponseJson();Vr("Connection","XHR received:",JSON.stringify(t)),i(t);break;case Nr.TIMEOUT:Vr("Connection",'RPC "'+e+'" timed out'),s(new Wr(Gr.DEADLINE_EXCEEDED,"Request time out"));break;case Nr.HTTP_ERROR:const n=o.getStatus();if(Vr("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Gr).indexOf(t)>=0?t:Gr.UNKNOWN}(e.status);s(new Wr(t,e.message))}else s(new Wr(Gr.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Wr(Gr.UNAVAILABLE,"Connection failed."));break;default:zr()}}finally{Vr("Connection",'RPC "'+e+'" completed.')}});const a=JSON.stringify(r);o.send(t,"POST",a,n,15)})}ji(e,t){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=Sr(),i=kr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new Dr({})),this.Ui(s.initMessageHeaders,t),(0,k.uI)()||(0,k.b$)()||(0,k.d)()||(0,k.w1)()||(0,k.Mn)()||(0,k.ru)()||(s.httpHeadersOverwriteParam="$httpHeaders");const o=n.join("");Vr("Connection","Creating WebChannel: "+o,s);const a=r.createWebChannel(o,s);let c=!1,u=!1;const h=new Uu({vi:e=>{u?Vr("Connection","Not sending because WebChannel is closed:",e):(c||(Vr("Connection","Opening WebChannel transport."),a.open(),c=!0),Vr("Connection","WebChannel sending:",e),a.send(e))},Vi:()=>a.close()}),l=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return l(a,Pr.EventType.OPEN,()=>{u||Vr("Connection","WebChannel transport opened.")}),l(a,Pr.EventType.CLOSE,()=>{u||(u=!0,Vr("Connection","WebChannel transport closed"),h.$i())}),l(a,Pr.EventType.ERROR,e=>{u||(u=!0,Br("Connection","WebChannel transport errored:",e),h.$i(new Wr(Gr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Pr.EventType.MESSAGE,e=>{var t;if(!u){const n=e.data[0];Kr(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){Vr("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=co[e];if(void 0!==t)return lo(t)}(e),n=i.message;void 0===t&&(t=Gr.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),u=!0,h.$i(new Wr(t,n)),a.close()}else Vr("Connection","WebChannel received:",n),h.Oi(n)}}),l(i,Cr.STAT_EVENT,e=>{e.stat===Rr.PROXY?Vr("Connection","Detected buffering proxy"):e.stat===Rr.NOPROXY&&Vr("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.ki()},0),h}}function qu(){return"undefined"!=typeof window?window:null}function Bu(){return"undefined"!=typeof document?document:null}function ju(e){return new Vo(e,!0)}class zu{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Oe=e,this.timerId=t,this.Qi=n,this.Wi=r,this.Gi=i,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();const t=Math.floor(this.zi+this.Zi()),n=Math.max(0,Date.now()-this.Ji),r=Math.max(0,t-n);r>0&&Vr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.zi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,r,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class Ku{constructor(e,t,n,r,i,s){this.Oe=e,this.er=n,this.nr=r,this.credentialsProvider=i,this.listener=s,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new zu(e,t)}ar(){return 1===this.state||2===this.state||4===this.state}cr(){return 2===this.state}start(){3!==this.state?this.auth():this.ur()}async stop(){this.ar()&&await this.close(0)}hr(){this.state=0,this.rr.reset()}lr(){this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this.dr()))}wr(e){this._r(),this.stream.send(e)}async dr(){if(this.cr())return this.close(0)}_r(){this.ir&&(this.ir.cancel(),this.ir=null)}async close(e,t){this._r(),this.rr.cancel(),this.sr++,3!==e?this.rr.reset():t&&t.code===Gr.RESOURCE_EXHAUSTED?(qr(t.toString()),qr("Using maximum backoff delay to prevent overloading the backend."),this.rr.Yi()):t&&t.code===Gr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ci(t)}mr(){}auth(){this.state=1;const e=this.gr(this.sr),t=this.sr;this.credentialsProvider.getToken().then(e=>{this.sr===t&&this.yr(e)},t=>{e(()=>{const e=new Wr(Gr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.pr(e)})})}yr(e){const t=this.gr(this.sr);this.stream=this.Tr(e),this.stream.Si(()=>{t(()=>(this.state=2,this.listener.Si()))}),this.stream.Ci(e=>{t(()=>this.pr(e))}),this.stream.onMessage(e=>{t(()=>this.onMessage(e))})}ur(){this.state=4,this.rr.Xi(async()=>{this.state=0,this.start()})}pr(e){return Vr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(3,e)}gr(e){return t=>{this.Oe.enqueueAndForget(()=>this.sr===e?t():(Vr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $u extends Ku{constructor(e,t,n,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle",t,n,i),this.N=r}Tr(e){return this.nr.ji("Listen",e)}onMessage(e){this.rr.reset();const t=function(e,t){let n;if("targetChange"in t){const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:zr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.D?(Kr(void 0===t||"string"==typeof t),yi.fromBase64String(t||"")):(Kr(void 0===t||t instanceof Uint8Array),yi.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Gr.UNKNOWN:lo(e.code);return new Wr(t,e.message||"")}(o);n=new Po(r,i,s,a||null)}else if("documentChange"in t){const r=t.documentChange,i=Wo(e,r.document.name),s=zo(r.document.updateTime),o=new zi({mapValue:{fields:r.document.fields}}),a=$i.newFoundDocument(i,s,o);n=new Ro(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in t){const r=t.documentDelete,i=Wo(e,r.document),s=r.readTime?zo(r.readTime):ci.min(),o=$i.newNoDocument(i,s);n=new Ro([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){const r=t.documentRemove,i=Wo(e,r.document);n=new Ro([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return zr();{const e=t.filter,r=new ao(e.count||0);n=new Do(e.targetId,r)}}return n}(this.N,e),n=function(e){if(!("targetChange"in e))return ci.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ci.min():t.readTime?zo(t.readTime):ci.min()}(e);return this.listener.Er(t,n)}Ir(e){const t={};t.database=Jo(this.N),t.addTarget=function(e,t){let n;const r=t.target;return n=Ji(r)?{documents:na(e,r)}:{query:ra(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Bo(e,t.resumeToken):t.snapshotVersion.compareTo(ci.min())>0&&(n.readTime=qo(e,t.snapshotVersion.toTimestamp())),n}(this.N,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return zr()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);n&&(t.labels=n),this.wr(t)}Ar(e){const t={};t.database=Jo(this.N),t.removeTarget=e,this.wr(t)}}class Gu extends Ku{constructor(e,t,n,r,i){super(e,"write_stream_connection_backoff","write_stream_idle",t,n,i),this.N=r,this.Rr=!1}get br(){return this.Rr}start(){this.Rr=!1,this.lastStreamToken=void 0,super.start()}mr(){this.Rr&&this.Pr([])}Tr(e){return this.nr.ji("Write",e)}onMessage(e){if(Kr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Rr){this.rr.reset();const t=function(e,t){return e&&e.length>0?(Kr(void 0!==t),e.map(e=>function(e,t){let n=zo(e.updateTime?e.updateTime:t);return n.isEqual(ci.min())&&(n=zo(t)),new $s(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=zo(e.commitTime);return this.listener.vr(n,t)}return Kr(!e.writeResults||0===e.writeResults.length),this.Rr=!0,this.listener.Vr()}Sr(){const e={};e.database=Jo(this.N),this.wr(e)}Pr(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>ea(this.N,e))};this.wr(t)}}class Wu extends class{}{constructor(e,t,n){super(),this.credentials=e,this.nr=t,this.N=n,this.Dr=!1}Cr(){if(this.Dr)throw new Wr(Gr.FAILED_PRECONDITION,"The client has already been terminated.")}Li(e,t,n){return this.Cr(),this.credentials.getToken().then(r=>this.nr.Li(e,t,n,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Gr.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new Wr(Gr.UNKNOWN,e.toString())})}Ki(e,t,n){return this.Cr(),this.credentials.getToken().then(r=>this.nr.Ki(e,t,n,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Gr.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new Wr(Gr.UNKNOWN,e.toString())})}terminate(){this.Dr=!0}}class Hu{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}Or(){0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.kr=null,this.Mr("Backend didn't respond within 10 seconds."),this.Fr("Offline"),Promise.resolve())))}Lr(e){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,this.Nr>=1&&(this.Br(),this.Mr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Fr("Offline")))}set(e){this.Br(),this.Nr=0,"Online"===e&&(this.$r=!1),this.Fr(e)}Fr(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Mr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.$r?(qr(t),this.$r=!1):Vr("OnlineStateTracker",t)}Br(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}class Qu{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=i,this.Qr.Ti(e=>{n.enqueueAndForget(async()=>{ih(this)&&(Vr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=$r(e);t.Kr.add(4),await Yu(t),t.Wr.set("Unknown"),t.Kr.delete(4),await Ju(t)}(this))})}),this.Wr=new Hu(n,r)}}async function Ju(e){if(ih(e))for(const t of e.jr)await t(!0)}async function Yu(e){for(const t of e.jr)await t(!1)}function Xu(e,t){const n=$r(e);n.qr.has(t.targetId)||(n.qr.set(t.targetId,t),rh(n)?nh(n):Th(n).cr()&&eh(n,t))}function Zu(e,t){const n=$r(e),r=Th(n);n.qr.delete(t),r.cr()&&th(n,t),0===n.qr.size&&(r.cr()?r.lr():ih(n)&&n.Wr.set("Unknown"))}function eh(e,t){e.Gr.Y(t.targetId),Th(e).Ir(t)}function th(e,t){e.Gr.Y(t),Th(e).Ar(t)}function nh(e){e.Gr=new Oo({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Tt:t=>e.qr.get(t)||null}),Th(e).start(),e.Wr.Or()}function rh(e){return ih(e)&&!Th(e).ar()&&e.qr.size>0}function ih(e){return 0===$r(e).Kr.size}function sh(e){e.Gr=void 0}async function oh(e){e.qr.forEach((t,n)=>{eh(e,t)})}async function ah(e,t){sh(e),rh(e)?(e.Wr.Lr(t),nh(e)):e.Wr.set("Unknown")}async function ch(e,t,n){if(e.Wr.set("Online"),t instanceof Po&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.qr.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.qr.delete(r),e.Gr.removeTarget(r))}(e,t)}catch(n){Vr("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await uh(e,n)}else if(t instanceof Ro?e.Gr.rt(t):t instanceof Do?e.Gr.ft(t):e.Gr.ct(t),!n.isEqual(ci.min()))try{const t=await ou(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Gr._t(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.qr.get(r);i&&e.qr.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{const n=e.qr.get(t);if(!n)return;e.qr.set(t,n.withResumeToken(yi.EMPTY_BYTE_STRING,n.snapshotVersion)),th(e,t);const r=new Za(n.target,t,1,n.sequenceNumber);eh(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Vr("RemoteStore","Failed to raise snapshot:",t),await uh(e,t)}}async function uh(e,t,n){if(!Ka(t))throw t;e.Kr.add(1),await Yu(e),e.Wr.set("Offline"),n||(n=()=>ou(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Vr("RemoteStore","Retrying IndexedDB access"),await n(),e.Kr.delete(1),await Ju(e)})}function hh(e,t){return t().catch(n=>uh(e,n,t))}async function lh(e){const t=$r(e),n=_h(t);let r=t.Ur.length>0?t.Ur[t.Ur.length-1].batchId:-1;for(;dh(t);)try{const e=await cu(t.localStore,r);if(null===e){0===t.Ur.length&&n.lr();break}r=e.batchId,fh(t,e)}catch(e){await uh(t,e)}ph(t)&&gh(t)}function dh(e){return ih(e)&&e.Ur.length<10}function fh(e,t){e.Ur.push(t);const n=_h(e);n.cr()&&n.br&&n.Pr(t.mutations)}function ph(e){return ih(e)&&!_h(e).ar()&&e.Ur.length>0}function gh(e){_h(e).start()}async function mh(e){_h(e).Sr()}async function yh(e){const t=_h(e);for(const n of e.Ur)t.Pr(n.mutations)}async function vh(e,t,n){const r=e.Ur.shift(),i=Xa.from(r,t,n);await hh(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await lh(e)}async function wh(e,t){t&&_h(e).br&&await async function(e,t){if(ho(n=t.code)&&n!==Gr.ABORTED){const n=e.Ur.shift();_h(e).hr(),await hh(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await lh(e)}var n}(e,t),ph(e)&&gh(e)}async function Ih(e,t){const n=$r(e);t?(n.Kr.delete(2),await Ju(n)):t||(n.Kr.add(2),await Yu(n),n.Wr.set("Unknown"))}function Th(e){return e.zr||(e.zr=function(e,t,n){const r=$r(e);return r.Cr(),new $u(t,r.nr,r.credentials,r.N,n)}(e.datastore,e.asyncQueue,{Si:oh.bind(null,e),Ci:ah.bind(null,e),Er:ch.bind(null,e)}),e.jr.push(async t=>{t?(e.zr.hr(),rh(e)?nh(e):e.Wr.set("Unknown")):(await e.zr.stop(),sh(e))})),e.zr}function _h(e){return e.Hr||(e.Hr=function(e,t,n){const r=$r(e);return r.Cr(),new Gu(t,r.nr,r.credentials,r.N,n)}(e.datastore,e.asyncQueue,{Si:mh.bind(null,e),Ci:wh.bind(null,e),Vr:yh.bind(null,e),vr:vh.bind(null,e)}),e.jr.push(async t=>{t?(e.Hr.hr(),await lh(e)):(await e.Hr.stop(),e.Ur.length>0&&(Vr("RemoteStore",`Stopping write stream with ${e.Ur.length} pending writes`),e.Ur=[]))})),e.Hr}class bh{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Hr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new bh(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Wr(Gr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Eh(e,t){if(qr("AsyncQueue",`${t}: ${e}`),Ka(e))return new Wr(Gr.UNAVAILABLE,`${t}: ${e}`);throw e}class Sh{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ai.comparator(t.key,n.key):(e,t)=>Ai.comparator(e.key,t.key),this.keyedMap=To(),this.sortedSet=new fo(this.comparator)}static emptySet(e){return new Sh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Sh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class kh{constructor(){this.Jr=new fo(Ai.comparator)}track(e){const t=e.doc.key,n=this.Jr.get(t);n?0!==e.type&&3===n.type?this.Jr=this.Jr.insert(t,e):3===e.type&&1!==n.type?this.Jr=this.Jr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jr=this.Jr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jr=this.Jr.remove(t):1===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):zr():this.Jr=this.Jr.insert(t,e)}Yr(){const e=[];return this.Jr.inorderTraversal((t,n)=>{e.push(n)}),e}}class Nh{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Nh(e,t,Sh.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&bs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Ah{constructor(){this.Xr=void 0,this.listeners=[]}}class Ch{constructor(){this.queries=new Vc(e=>Es(e),bs),this.onlineState="Unknown",this.Zr=new Set}}async function Rh(e,t){const n=$r(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Ah),i)try{s.Xr=await n.onListen(r)}catch(e){const n=Eh(e,`Initialization of query '${Ss(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.eo(n.onlineState),s.Xr&&t.no(s.Xr)&&Oh(n)}async function Dh(e,t){const n=$r(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Ph(e,t){const n=$r(e);let r=!1;for(const i of t){const e=n.queries.get(i.query);if(e){for(const t of e.listeners)t.no(i)&&(r=!0);e.Xr=i}}r&&Oh(n)}function xh(e,t,n){const r=$r(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function Oh(e){e.Zr.forEach(e=>{e.next()})}class Lh{constructor(e,t,n){this.query=e,this.so=t,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}no(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Nh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.io?this.oo(e)&&(this.so.next(e),t=!0):this.ao(e,this.onlineState)&&(this.co(e),t=!0),this.ro=e,t}onError(e){this.so.error(e)}eo(e){this.onlineState=e;let t=!1;return this.ro&&!this.io&&this.ao(this.ro,e)&&(this.co(this.ro),t=!0),t}ao(e,t){return!e.fromCache||!(this.options.uo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}oo(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ro&&this.ro.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}co(e){e=Nh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.io=!0,this.so.next(e)}}class Mh{constructor(e,t){this.payload=e,this.byteLength=t}ho(){return"metadata"in this.payload}}class Fh{constructor(e){this.N=e}zn(e){return Wo(this.N,e)}Hn(e){return e.metadata.exists?Zo(this.N,e.document,!1):$i.newNoDocument(this.zn(e.metadata.name),this.Jn(e.metadata.readTime))}Jn(e){return zo(e)}}class Uh{constructor(e,t,n){this.lo=e,this.localStore=t,this.N=n,this.queries=[],this.documents=[],this.progress=Vh(e)}fo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}wo(e){const t=new Map,n=new Fh(this.N);for(const r of e)if(r.metadata.queries){const e=n.zn(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||So()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=$r(e);let s=So(),o=wo(),a=bo();for(const h of n){const e=t.zn(h.metadata.name);h.document&&(s=s.add(e)),o=o.insert(e,t.Hn(h)),a=a.insert(e,t.Jn(h.metadata.readTime))}const c=i.jn.newChangeBuffer({trackRemovals:!0}),u=await uu(i,function(e){return Ts(ps(fi.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>au(e,c,o,ci.min(),a).next(t=>(c.apply(e),t)).next(t=>i.ze.removeMatchingKeysForTargetId(e,u.targetId).next(()=>i.ze.addMatchingKeys(e,s,u.targetId)).next(()=>i.Qn.vn(e,t)).next(()=>t)))}(this.localStore,new Fh(this.N),this.documents,this.lo.id),t=this.wo(this.documents);for(const n of this.queries)await pu(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",new Zc(Object.assign({},this.progress),e)}}function Vh(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class qh{constructor(e){this.key=e}}class Bh{constructor(e){this.key=e}}class jh{constructor(e,t){this.query=e,this._o=t,this.mo=null,this.current=!1,this.yo=So(),this.mutatedKeys=So(),this.po=Ns(e),this.To=new Sh(this.po)}get Eo(){return this._o}Io(e,t){const n=t?t.Ao:new kh,r=t?t.To:this.To;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=gs(this.query)&&r.size===this.query.limit?r.last():null,c=ms(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const u=r.get(e),h=ks(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Ro(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.po(h,a)>0||c&&this.po(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),gs(this.query)||ms(this.query))for(;s.size>this.query.limit;){const e=gs(this.query)?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{To:s,Ao:n,Ln:o,mutatedKeys:i}}Ro(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.To;this.To=e.To,this.mutatedKeys=e.mutatedKeys;const i=e.Ao.Yr();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zr()}};return n(e)-n(t)}(e.type,t.type)||this.po(e.doc,t.doc)),this.bo(n);const s=t?this.Po():[],o=0===this.yo.size&&this.current?1:0,a=o!==this.mo;return this.mo=o,0!==i.length||a?{snapshot:new Nh(this.query,e.To,r,i,e.mutatedKeys,0===o,a,!1),vo:s}:{vo:s}}eo(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({To:this.To,Ao:new kh,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}Vo(e){return!this._o.has(e)&&!!this.To.has(e)&&!this.To.get(e).hasLocalMutations}bo(e){e&&(e.addedDocuments.forEach(e=>this._o=this._o.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._o=this._o.delete(e)),this.current=e.current)}Po(){if(!this.current)return[];const e=this.yo;this.yo=So(),this.To.forEach(e=>{this.Vo(e.key)&&(this.yo=this.yo.add(e.key))});const t=[];return e.forEach(e=>{this.yo.has(e)||t.push(new Bh(e))}),this.yo.forEach(n=>{e.has(n)||t.push(new qh(n))}),t}So(e){this._o=e.Gn,this.yo=So();const t=this.Io(e.documents);return this.applyChanges(t,!0)}Do(){return Nh.fromInitialDocuments(this.query,this.To,this.mutatedKeys,0===this.mo)}}class zh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Kh{constructor(e){this.key=e,this.Co=!1}}class $h{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.No={},this.xo=new Vc(e=>Es(e),bs),this.ko=new Map,this.$o=new Set,this.Oo=new fo(Ai.comparator),this.Fo=new Map,this.Mo=new mu,this.Lo={},this.Bo=new Map,this.Uo=Nc.ie(),this.onlineState="Unknown",this.qo=void 0}get isPrimaryClient(){return!0===this.qo}}async function Gh(e,t){const n=vl(e);let r,i;const s=n.xo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Do();else{const e=await uu(n.localStore,Ts(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Wh(n,t,r,"current"===s),n.isPrimaryClient&&Xu(n.remoteStore,e)}return i}async function Wh(e,t,n,r){e.Ko=(t,n,r)=>async function(e,t,n,r){let i=t.view.Io(n);i.Ln&&(i=await lu(e.localStore,t.query,!1).then(({documents:e})=>t.view.Io(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return il(e,t.targetId,o.vo),o.snapshot}(e,t,n,r);const i=await lu(e.localStore,t,!0),s=new jh(t,i.Gn),o=s.Io(i.documents),a=Co.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);il(e,n,c.vo);const u=new zh(t,n,s);return e.xo.set(t,u),e.ko.has(n)?e.ko.get(n).push(t):e.ko.set(n,[t]),c.snapshot}async function Hh(e,t){const n=$r(e),r=n.xo.get(t),i=n.ko.get(r.targetId);if(i.length>1)return n.ko.set(r.targetId,i.filter(e=>!bs(e,t))),void n.xo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await hu(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),Zu(n.remoteStore,r.targetId),nl(n,r.targetId)}).catch(Pc)):(nl(n,r.targetId),await hu(n.localStore,r.targetId,!0))}async function Qh(e,t){const n=$r(e);try{const e=await function(e,t){const n=$r(e),r=t.snapshotVersion;let i=n.Un;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.jn.newChangeBuffer({trackRemovals:!0});i=n.Un;const o=[];t.targetChanges.forEach((t,s)=>{const a=i.get(s);if(!a)return;o.push(n.ze.removeMatchingKeys(e,t.removedDocuments,s).next(()=>n.ze.addMatchingKeys(e,t.addedDocuments,s)));const c=t.resumeToken;if(c.approximateByteSize()>0){const u=a.withResumeToken(c,r).withSequenceNumber(e.currentSequenceNumber);i=i.insert(s,u),function(e,t,n){return Kr(t.resumeToken.approximateByteSize()>0),0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,t)&&o.push(n.ze.updateTargetData(e,u))}});let a=wo();if(t.documentUpdates.forEach((r,i)=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(au(e,s,t.documentUpdates,r,void 0).next(e=>{a=e})),!r.isEqual(ci.min())){const t=n.ze.getLastRemoteSnapshotVersion(e).next(t=>n.ze.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return Va.waitFor(o).next(()=>s.apply(e)).next(()=>n.Qn.vn(e,a)).next(()=>a)}).then(e=>(n.Un=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Fo.get(t);r&&(Kr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Co=!0:e.modifiedDocuments.size>0?Kr(r.Co):e.removedDocuments.size>0&&(Kr(r.Co),r.Co=!1))}),await al(n,e,t)}catch(e){await Pc(e)}}function Jh(e,t,n){const r=$r(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.xo.forEach((n,r)=>{const i=r.view.eo(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=$r(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.listeners)i.eo(t)&&(r=!0)}),r&&Oh(n)}(r.eventManager,t),e.length&&r.No.Er(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Yh(e,t,n){const r=$r(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Fo.get(t),s=i&&i.key;if(s){let e=new fo(Ai.comparator);e=e.insert(s,$i.newNoDocument(s,ci.min()));const n=So().add(s),i=new Ao(ci.min(),new Map,new mo(ii),e,n);await Qh(r,i),r.Oo=r.Oo.remove(s),r.Fo.delete(t),ol(r)}else await hu(r.localStore,t,!1).then(()=>nl(r,t,n)).catch(Pc)}async function Xh(e,t){const n=$r(e),r=t.batch.batchId;try{const e=await function(e,t){const n=$r(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.jn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Va.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);Kr(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))})}),o.next(()=>e.In.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.In.performConsistencyCheck(e)).next(()=>n.Qn.Pn(e,r))})}(n.localStore,t);tl(n,r,null),el(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await al(n,e)}catch(e){await Pc(e)}}async function Zh(e,t,n){const r=$r(e);try{const e=await function(e,t){const n=$r(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.In.lookupMutationBatch(e,t).next(t=>(Kr(null!==t),r=t.keys(),n.In.removeMutationBatch(e,t))).next(()=>n.In.performConsistencyCheck(e)).next(()=>n.Qn.Pn(e,r))})}(r.localStore,t);tl(r,t,n),el(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await al(r,e)}catch(n){await Pc(n)}}function el(e,t){(e.Bo.get(t)||[]).forEach(e=>{e.resolve()}),e.Bo.delete(t)}function tl(e,t,n){const r=$r(e);let i=r.Lo[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Lo[r.currentUser.toKey()]=i}}function nl(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.ko.get(t))e.xo.delete(r),n&&e.No.jo(r,n);e.ko.delete(t),e.isPrimaryClient&&e.Mo.cs(t).forEach(t=>{e.Mo.containsKey(t)||rl(e,t)})}function rl(e,t){e.$o.delete(t.path.canonicalString());const n=e.Oo.get(t);null!==n&&(Zu(e.remoteStore,n),e.Oo=e.Oo.remove(t),e.Fo.delete(n),ol(e))}function il(e,t,n){for(const r of n)r instanceof qh?(e.Mo.addReference(r.key,t),sl(e,r)):r instanceof Bh?(Vr("SyncEngine","Document no longer in limbo: "+r.key),e.Mo.removeReference(r.key,t),e.Mo.containsKey(r.key)||rl(e,r.key)):zr()}function sl(e,t){const n=t.key,r=n.path.canonicalString();e.Oo.get(n)||e.$o.has(r)||(Vr("SyncEngine","New document in limbo: "+n),e.$o.add(r),ol(e))}function ol(e){for(;e.$o.size>0&&e.Oo.size<e.maxConcurrentLimboResolutions;){const t=e.$o.values().next().value;e.$o.delete(t);const n=new Ai(fi.fromString(t)),r=e.Uo.next();e.Fo.set(r,new Kh(n)),e.Oo=e.Oo.insert(n,r),Xu(e.remoteStore,new Za(Ts(ps(n.path)),r,2,ti.T))}}async function al(e,t,n){const r=$r(e),i=[],s=[],o=[];r.xo.isEmpty()||(r.xo.forEach((e,a)=>{o.push(r.Ko(a,t,n).then(e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=tu.kn(a.targetId,e);s.push(t)}}))}),await Promise.all(o),r.No.Er(i),await async function(e,t){const n=$r(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Va.forEach(t,t=>Va.forEach(t.Nn,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Va.forEach(t.xn,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!Ka(e))throw e;Vr("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Un.get(e),r=t.withLastLimboFreeSnapshotVersion(t.snapshotVersion);n.Un=n.Un.insert(e,r)}}}(r.localStore,s))}async function cl(e,t){const n=$r(e);if(!n.currentUser.isEqual(t)){Vr("SyncEngine","User change. New user:",t.toKey());const e=await su(n.localStore,t);n.currentUser=t,function(e,t){e.Bo.forEach(e=>{e.forEach(e=>{e.reject(new Wr(Gr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Bo.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await al(n,e.Wn)}}function ul(e,t){const n=$r(e),r=n.Fo.get(t);if(r&&r.Co)return So().add(r.key);{let e=So();const r=n.ko.get(t);if(!r)return e;for(const t of r){const r=n.xo.get(t);e=e.unionWith(r.view.Eo)}return e}}async function hl(e,t){const n=$r(e),r=await lu(n.localStore,t.query,!0),i=t.view.So(r);return n.isPrimaryClient&&il(n,t.targetId,i.vo),i}async function ll(e){const t=$r(e);return fu(t.localStore).then(e=>al(t,e))}async function dl(e,t,n,r){const i=$r(e),s=await function(e,t){const n=$r(e),r=$r(n.In);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.Xt(e,t).next(t=>t?n.Qn.Pn(e,t):Va.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await lh(i.remoteStore):"acknowledged"===n||"rejected"===n?(tl(i,t,r||null),el(i,t),function(e,t){$r($r(e).In).te(t)}(i.localStore,t)):zr(),await al(i,s)):Vr("SyncEngine","Cannot apply mutation batch with id: "+t)}async function fl(e,t,n){const r=$r(e),i=[],s=[];for(const o of t){let e;const t=r.ko.get(o);if(t&&0!==t.length){e=await uu(r.localStore,Ts(t[0]));for(const e of t){const t=r.xo.get(e),n=await hl(r,t);n.snapshot&&s.push(n.snapshot)}}else{const t=await du(r.localStore,o);e=await uu(r.localStore,t),await Wh(r,pl(t),o,!1)}i.push(e)}return r.No.Er(s),i}function pl(e){return fs(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function gl(e){const t=$r(e);return $r($r(t.localStore).persistence).pn()}async function ml(e,t,n,r){const i=$r(e);if(i.qo)Vr("SyncEngine","Ignoring unexpected query state notification.");else if(i.ko.has(t))switch(n){case"current":case"not-current":{const e=await fu(i.localStore),r=Ao.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await al(i,e,r);break}case"rejected":await hu(i.localStore,t,!0),nl(i,t,r);break;default:zr()}}async function yl(e,t,n){const r=vl(e);if(r.qo){for(const e of t){if(r.ko.has(e)){Vr("SyncEngine","Adding an already active target "+e);continue}const t=await du(r.localStore,e),n=await uu(r.localStore,t);await Wh(r,pl(t),n.targetId,!1),Xu(r.remoteStore,n)}for(const e of n)r.ko.has(e)&&await hu(r.localStore,e,!1).then(()=>{Zu(r.remoteStore,e),nl(r,e)}).catch(Pc)}}function vl(e){const t=$r(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Qh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ul.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Yh.bind(null,t),t.No.Er=Ph.bind(null,t.eventManager),t.No.jo=xh.bind(null,t.eventManager),t}function wl(e){const t=$r(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Xh.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Zh.bind(null,t),t}class Il{constructor(){this.synchronizeTabs=!1}async initialize(e){this.N=ju(e.databaseInfo.databaseId),this.sharedClientState=this.Wo(e),this.persistence=this.Go(e),await this.persistence.start(),this.gcScheduler=this.zo(e),this.localStore=this.Ho(e)}zo(e){return null}Ho(e){return iu(this.persistence,new nu,e.initialUser,this.N)}Go(e){return new _u(Eu.Ns,this.N)}Wo(e){return new Ou}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Tl extends Il{constructor(e,t,n){super(),this.Jo=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=$r(e);return t.persistence.runTransaction("Synchronize last document change read time","readonly",e=>function(e){const t=Kc(e);let n=ci.min();return t.Kt({index:Na.readTimeIndex,reverse:!0},(e,t,r)=>{t.readTime&&(n=ic(t.readTime)),r.done()}).next(()=>n)}(e)).then(e=>{t.Kn=e})}(this.localStore),await this.Jo.initialize(this,e),await wl(this.Jo.syncEngine),await lh(this.Jo.remoteStore),await this.persistence.nn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Ho(e){return iu(this.persistence,new nu,e.initialUser,this.N)}zo(e){return new Lc(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}Go(e){const t=Xc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?wc.withCacheSize(this.cacheSizeBytes):wc.DEFAULT;return new Qc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,qu(),Bu(),this.N,this.sharedClientState,!!this.forceOwnership)}Wo(e){return new Ou}}class _l extends Tl{constructor(e,t){super(e,t,!1),this.Jo=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Jo.syncEngine;this.sharedClientState instanceof xu&&(this.sharedClientState.syncEngine={_i:dl.bind(null,t),mi:ml.bind(null,t),gi:yl.bind(null,t),pn:gl.bind(null,t),wi:ll.bind(null,t)},await this.sharedClientState.start()),await this.persistence.nn(async e=>{await async function(e,t){const n=$r(e);if(vl(n),wl(n),!0===t&&!0!==n.qo){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await fl(n,e.toArray());n.qo=!0,await Ih(n.remoteStore,!0);for(const r of t)Xu(n.remoteStore,r)}else if(!1===t&&!1!==n.qo){const e=[];let t=Promise.resolve();n.ko.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(nl(n,i),hu(n.localStore,i,!0))),Zu(n.remoteStore,i)}),await t,await fl(n,e),function(e){const t=$r(e);t.Fo.forEach((e,n)=>{Zu(t.remoteStore,n)}),t.Mo.us(),t.Fo=new Map,t.Oo=new fo(Ai.comparator)}(n),n.qo=!1,await Ih(n.remoteStore,!1)}}(this.Jo.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Wo(e){const t=qu();if(!xu.bt(t))throw new Wr(Gr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Xc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new xu(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class bl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Jh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=cl.bind(null,this.syncEngine),await Ih(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Ch}createDatastore(e){const t=ju(e.databaseInfo.databaseId),n=new Vu(e.databaseInfo);return function(e,t,n){return new Wu(e,t,n)}(e.credentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Jh(this.syncEngine,e,0),s=Mu.bt()?new Mu:new Lu,new Qu(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new $h(e,t,n,r,i,s);return o&&(a.qo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=$r(e);Vr("RemoteStore","RemoteStore shutting down."),t.Kr.add(5),await Yu(t),t.Qr.shutdown(),t.Wr.set("Unknown")}(this.remoteStore)}}function El(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Sl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Yo(this.observer.next,e)}error(e){this.observer.error?this.Yo(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Xo(){this.muted=!0}Yo(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class kl{constructor(e,t){this.Zo=e,this.N=t,this.metadata=new Hr,this.buffer=new Uint8Array,this.ta=new TextDecoder("utf-8"),this.ea().then(e=>{e&&e.ho()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Zo.cancel()}async getMetadata(){return this.metadata.promise}async Qo(){return await this.getMetadata(),this.ea()}async ea(){const e=await this.na();if(null===e)return null;const t=this.ta.decode(e),n=Number(t);isNaN(n)&&this.sa(`length string (${t}) is not valid number`);const r=await this.ia(n);return new Mh(JSON.parse(r),e.length+n)}ra(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async na(){for(;this.ra()<0&&!(await this.oa()););if(0===this.buffer.length)return null;const e=this.ra();e<0&&this.sa("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ia(e){for(;this.buffer.length<e;)await this.oa()&&this.sa("Reached the end of bundle when more is expected.");const t=this.ta.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}sa(e){throw this.Zo.cancel(),new Error(`Invalid bundle format: ${e}`)}async oa(){const e=await this.Zo.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Nl{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Wr(Gr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=$r(e),r=Jo(n.N)+"/documents",i={documents:t.map(e=>Go(n.N,e))},s=await n.Ki("BatchGetDocuments",r,i),o=new Map;s.forEach(e=>{const t=function(e,t){return"found"in t?function(e,t){Kr(!!t.found);const n=Wo(e,t.found.name),r=zo(t.found.updateTime),i=new zi({mapValue:{fields:t.found.fields}});return $i.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Kr(!!t.missing),Kr(!!t.readTime);const n=Wo(e,t.missing),r=zo(t.readTime);return $i.newNoDocument(n,r)}(e,t):zr()}(n.N,e);o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{const t=o.get(e.toString());Kr(!!t),a.push(t)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new so(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{const n=Ai.fromPath(t);this.mutations.push(new oo(n,this.precondition(n)))}),await async function(e,t){const n=$r(e),r=Jo(n.N)+"/documents",i={writes:t.map(e=>ea(n.N,e))};await n.Li("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw zr();t=ci.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Wr(Gr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Gs.updateTime(t):Gs.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ci.min()))throw new Wr(Gr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Gs.updateTime(t)}return Gs.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Al{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.aa=5,this.rr=new zu(this.asyncQueue,"transaction_retry")}run(){this.aa-=1,this.ca()}ca(){this.rr.Xi(async()=>{const e=new Nl(this.datastore),t=this.ua(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.ha(e)}))}).catch(e=>{this.ha(e)})})}ua(e){try{const t=this.updateFunction(e);return!Si(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ha(e){this.aa>0&&this.la(e)?(this.aa-=1,this.asyncQueue.enqueueAndForget(()=>(this.ca(),Promise.resolve()))):this.deferred.reject(e)}la(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!ho(t)}return!1}}class Cl{constructor(e,t,n){this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=Lr.UNAUTHENTICATED,this.clientId=ri.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(t,async e=>{Vr("FirestoreClient","Received user=",e.uid),await this.credentialListener(e),this.user=e})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Wr(Gr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Hr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),e.resolve()}catch(t){const n=Eh(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Rl(e,t){e.asyncQueue.verifyOperationInProgress(),Vr("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await su(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function Dl(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Pl(e);Vr("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>async function(e,t){const n=$r(e);n.asyncQueue.verifyOperationInProgress(),Vr("RemoteStore","RemoteStore received new credentials");const r=ih(n);n.Kr.add(3),await Yu(n),r&&n.Wr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Kr.delete(3),await Ju(n)}(t.remoteStore,e)),e.onlineComponents=t}async function Pl(e){return e.offlineComponents||(Vr("FirestoreClient","Using default OfflineComponentProvider"),await Rl(e,new Il)),e.offlineComponents}async function xl(e){return e.onlineComponents||(Vr("FirestoreClient","Using default OnlineComponentProvider"),await Dl(e,new bl)),e.onlineComponents}function Ol(e){return Pl(e).then(e=>e.persistence)}function Ll(e){return Pl(e).then(e=>e.localStore)}function Ml(e){return xl(e).then(e=>e.remoteStore)}function Fl(e){return xl(e).then(e=>e.syncEngine)}async function Ul(e){const t=await xl(e),n=t.eventManager;return n.onListen=Gh.bind(null,t.syncEngine),n.onUnlisten=Hh.bind(null,t.syncEngine),n}function Vl(e,t,n={}){const r=new Hr;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new Sl({next:s=>{t.enqueueAndForget(()=>Dh(e,o));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Wr(Gr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Wr(Gr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Lh(ps(n.path),s,{includeMetadataChanges:!0,uo:!0});return Rh(e,o)}(await Ul(e),e.asyncQueue,t,n,r)),r.promise}function ql(e,t,n={}){const r=new Hr;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new Sl({next:n=>{t.enqueueAndForget(()=>Dh(e,o)),n.fromCache&&"server"===r.source?i.reject(new Wr(Gr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Lh(n,s,{includeMetadataChanges:!0,uo:!0});return Rh(e,o)}(await Ul(e),e.asyncQueue,t,n,r)),r.promise}class Bl{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class jl{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof jl&&e.projectId===this.projectId&&e.database===this.database}}const zl=new Map;function Kl(e,t,n){if(!n)throw new Wr(Gr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function $l(e,t,n,r){if(!0===t&&!0===r)throw new Wr(Gr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Gl(e){if(!Ai.isDocumentKey(e))throw new Wr(Gr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Wl(e){if(Ai.isDocumentKey(e))throw new Wr(Gr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Hl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":zr()}function Ql(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Wr(Gr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Hl(e);throw new Wr(Gr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Jl(e,t){if(t<=0)throw new Wr(Gr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Yl{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Wr(Gr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Wr(Gr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,$l("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Xl{constructor(e,t){this._credentials=t,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yl({}),this._settingsFrozen=!1,e instanceof jl?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Wr(Gr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jl(e.options.projectId)}(e))}get app(){if(!this._app)throw new Wr(Gr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Wr(Gr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yl(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new Jr;switch(e.type){case"gapi":const t=e.client;return Kr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new ei(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Wr(Gr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=zl.get(e);t&&(Vr("ComponentProvider","Removing Datastore"),zl.delete(e),t.terminate())}(this),Promise.resolve()}}class Zl{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new td(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Zl(this.firestore,e,this._key)}}class ed{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ed(this.firestore,e,this._query)}}class td extends ed{constructor(e,t,n){super(e,t,ps(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Zl(this.firestore,null,new Ai(e))}withConverter(e){return new td(this.firestore,e,this._path)}}function nd(e,t,...n){if(e=(0,k.m9)(e),Kl("collection","path",t),e instanceof Xl){const r=fi.fromString(t,...n);return Wl(r),new td(e,null,r)}{if(!(e instanceof Zl||e instanceof td))throw new Wr(Gr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(fi.fromString(t,...n));return Wl(r),new td(e.firestore,null,r)}}function rd(e,t,...n){if(e=(0,k.m9)(e),1===arguments.length&&(t=ri.I()),Kl("doc","path",t),e instanceof Xl){const r=fi.fromString(t,...n);return Gl(r),new Zl(e,null,new Ai(r))}{if(!(e instanceof Zl||e instanceof td))throw new Wr(Gr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(fi.fromString(t,...n));return Gl(r),new Zl(e.firestore,e instanceof td?e.converter:null,new Ai(r))}}function id(e,t){return e=(0,k.m9)(e),t=(0,k.m9)(t),(e instanceof Zl||e instanceof td)&&(t instanceof Zl||t instanceof td)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function sd(e,t){return e=(0,k.m9)(e),t=(0,k.m9)(t),e instanceof ed&&t instanceof ed&&e.firestore===t.firestore&&bs(e._query,t._query)&&e.converter===t.converter}class od{constructor(){this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new zu(this,"async_queue_retry"),this.Ta=()=>{const e=Bu();e&&Vr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.rr.tr()};const e=Bu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ta)}get isShuttingDown(){return this.wa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ea(),this.Ia(e)}enterRestrictedMode(e){if(!this.wa){this.wa=!0,this.ya=e||!1;const t=Bu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ta)}}enqueue(e){if(this.Ea(),this.wa)return new Promise(()=>{});const t=new Hr;return this.Ia(()=>this.wa&&this.ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.da.push(e),this.Aa()))}async Aa(){if(0!==this.da.length){try{await this.da[0](),this.da.shift(),this.rr.reset()}catch(q){if(!Ka(q))throw q;Vr("AsyncQueue","Operation failed with retryable error: "+q)}this.da.length>0&&this.rr.Xi(()=>this.Aa())}}Ia(e){const t=this.fa.then(()=>(this.ga=!0,e().catch(e=>{throw this.ma=e,this.ga=!1,qr("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.ga=!1,e))));return this.fa=t,t}enqueueAfterDelay(e,t,n){this.Ea(),this.pa.indexOf(e)>-1&&(t=0);const r=bh.createAndSchedule(this,e,t,n,e=>this.Ra(e));return this._a.push(r),r}Ea(){this.ma&&zr()}verifyOperationInProgress(){}async ba(){let e;do{e=this.fa,await e}while(e!==this.fa)}Pa(e){for(const t of this._a)if(t.timerId===e)return!0;return!1}va(e){return this.ba().then(()=>{this._a.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this._a)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ba()})}Va(e){this.pa.push(e)}Ra(e){const t=this._a.indexOf(e);this._a.splice(t,1)}}function ad(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class cd{constructor(){this._progressObserver={},this._taskCompletionResolver=new Hr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ud extends Xl{constructor(e,t){super(e,t),this.type="firestore",this._queue=new od,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||ld(this),this._firestoreClient.terminate()}}function hd(e){return e._firestoreClient||ld(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function ld(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new Bl(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Cl(e._credentials,e._queue,r)}function dd(e,t,n){const r=new Hr;return e.asyncQueue.enqueue(async()=>{try{await Rl(e,n),await Dl(e,t),r.resolve()}catch(e){if(!function(e){return"FirebaseError"===e.name?e.code===Gr.FAILED_PRECONDITION||e.code===Gr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(e))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}}).then(()=>r.promise)}function fd(e){if(e._initialized||e._terminated)throw new Wr(Gr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class pd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Wr(Gr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gi(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class gd{constructor(e){this._byteString=e}static fromBase64String(e){try{return new gd(yi.fromBase64String(e))}catch(e){throw new Wr(Gr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new gd(yi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class md{constructor(e){this._methodName=e}}class yd{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Wr(Gr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Wr(Gr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ii(this._lat,e._lat)||ii(this._long,e._long)}}const vd=/^__.*__$/;class wd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new to(e,this.data,this.fieldMask,t,this.fieldTransforms):new eo(e,this.data,t,this.fieldTransforms)}}class Id{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new to(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Td(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw zr()}}class _d{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.N=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sa(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Da(){return this.settings.Da}Ca(e){return new _d(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Na(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.ka(e),r}$a(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.Sa(),r}Oa(e){return this.Ca({path:void 0,xa:!0})}Fa(e){return jd(e,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Sa(){if(this.path)for(let e=0;e<this.path.length;e++)this.ka(this.path.get(e))}ka(e){if(0===e.length)throw this.Fa("Document fields must not be empty");if(Td(this.Da)&&vd.test(e))throw this.Fa('Document fields cannot begin and end with "__"')}}class bd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.N=n||ju(e)}Ba(e,t,n,r=!1){return new _d({Da:e,methodName:t,La:n,path:gi.emptyPath(),xa:!1,Ma:r},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function Ed(e){const t=e._freezeSettings(),n=ju(e._databaseId);return new bd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Sd(e,t,n,r,i,s={}){const o=e.Ba(s.merge||s.mergeFields?2:0,t,n,i);Ud("Data must be an object, but it was:",o,r);const a=Md(r,o);let c,u;if(s.merge)c=new mi(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Vd(t,r,n);if(!o.contains(i))throw new Wr(Gr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);zd(e,i)||e.push(i)}c=new mi(e),u=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,u=o.fieldTransforms;return new wd(new zi(a),c,u)}class kd extends md{_toFieldTransform(e){if(2!==e.Da)throw e.Fa(1===e.Da?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof kd}}function Nd(e,t,n){return new _d({Da:3,La:t.settings.La,methodName:e._methodName,xa:n},t.databaseId,t.N,t.ignoreUndefinedProperties)}class Ad extends md{_toFieldTransform(e){return new Ks(e.path,new Ms)}isEqual(e){return e instanceof Ad}}class Cd extends md{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=Nd(this,e,!0),n=this.Ua.map(e=>Ld(e,t)),r=new Fs(n);return new Ks(e.path,r)}isEqual(e){return this===e}}class Rd extends md{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=Nd(this,e,!0),n=this.Ua.map(e=>Ld(e,t)),r=new Vs(n);return new Ks(e.path,r)}isEqual(e){return this===e}}class Dd extends md{constructor(e,t){super(e),this.qa=t}_toFieldTransform(e){const t=new Bs(e.N,Ds(e.N,this.qa));return new Ks(e.path,t)}isEqual(e){return this===e}}function Pd(e,t,n,r){const i=e.Ba(1,t,n);Ud("Data must be an object, but it was:",i,r);const s=[],o=zi.empty();hi(r,(e,r)=>{const a=Bd(t,e,n);r=(0,k.m9)(r);const c=i.$a(a);if(r instanceof kd)s.push(a);else{const e=Ld(r,c);null!=e&&(s.push(a),o.set(a,e))}});const a=new mi(s);return new Id(o,a,i.fieldTransforms)}function xd(e,t,n,r,i,s){const o=e.Ba(1,t,n),a=[Vd(t,r,n)],c=[i];if(s.length%2!=0)throw new Wr(Gr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Vd(t,s[d])),c.push(s[d+1]);const u=[],h=zi.empty();for(let d=a.length-1;d>=0;--d)if(!zd(u,a[d])){const e=a[d];let t=c[d];t=(0,k.m9)(t);const n=o.$a(e);if(t instanceof kd)u.push(e);else{const r=Ld(t,n);null!=r&&(u.push(e),h.set(e,r))}}const l=new mi(u);return new Id(h,l,o.fieldTransforms)}function Od(e,t,n,r=!1){return Ld(n,e.Ba(r?4:3,t))}function Ld(e,t){if(Fd(e=(0,k.m9)(e)))return Ud("Unsupported field value:",t,e),Md(e,t);if(e instanceof md)return function(e,t){if(!Td(t.Da))throw t.Fa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Fa(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xa&&4!==t.Da)throw t.Fa("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Ld(i,t.Oa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,k.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Ds(t.N,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ai.fromDate(e);return{timestampValue:qo(t.N,n)}}if(e instanceof ai){const n=new ai(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:qo(t.N,n)}}if(e instanceof yd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof gd)return{bytesValue:Bo(t.N,e._byteString)};if(e instanceof Zl){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Fa(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ko(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Fa(`Unsupported field value: ${Hl(e)}`)}(e,t)}function Md(e,t){const n={};return li(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):hi(e,(e,r)=>{const i=Ld(r,t.Na(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function Fd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ai||e instanceof yd||e instanceof gd||e instanceof Zl||e instanceof md)}function Ud(e,t,n){if(!Fd(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Hl(n);throw t.Fa("an object"===r?e+" a custom object":e+" "+r)}}function Vd(e,t,n){if((t=(0,k.m9)(t))instanceof pd)return t._internalPath;if("string"==typeof t)return Bd(e,t);throw jd("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}const qd=new RegExp("[~\\*/\\[\\]]");function Bd(e,t,n){if(t.search(qd)>=0)throw jd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new pd(...t.split("."))._internalPath}catch(r){throw jd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function jd(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Wr(Gr.INVALID_ARGUMENT,a+e+c)}function zd(e,t){return e.some(e=>e.isEqual(t))}class Kd{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Zl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new $d(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Gd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class $d extends Kd{data(){return super.data()}}function Gd(e,t){return"string"==typeof t?Bd(e,t):t instanceof pd?t._internalPath:t._delegate._internalPath}class Wd{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Hd extends Kd{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Qd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Gd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Qd extends Hd{data(e={}){return super.data(e)}}class Jd{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Wd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Qd(this._firestore,this._userDataWriter,n.key,n,new Wd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Wr(Gr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>({type:"added",doc:new Qd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Wd(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new Qd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Wd(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Yd(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Yd(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zr()}}function Xd(e,t){return e instanceof Hd&&t instanceof Hd?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Jd&&t instanceof Jd&&e._firestore===t._firestore&&sd(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Zd(e){if(ms(e)&&0===e.explicitOrderBy.length)throw new Wr(Gr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ef{}function tf(e,...t){for(const n of t)e=n._apply(e);return e}class nf extends ef{constructor(e,t,n){super(),this.Ka=e,this.ja=t,this.Qa=n,this.type="where"}_apply(e){const t=Ed(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Wr(Gr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on FieldPath.documentId().`);if("in"===s||"not-in"===s){hf(o,s);const t=[];for(const n of o)t.push(uf(r,e,n));a={arrayValue:{values:t}}}else a=uf(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||hf(o,s),a=Od(n,"where",o,"in"===s||"not-in"===s);const c=Yi.create(i,s,a);return function(e,t){if(t.v()){const n=vs(e);if(null!==n&&!n.isEqual(t.field))throw new Wr(Gr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=ys(e);null!==r&&lf(0,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw new Wr(Gr.INVALID_ARGUMENT,n===t.op?`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`:`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this.Ka,this.ja,this.Qa);return new ed(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new ds(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}class rf extends ef{constructor(e,t){super(),this.Ka=e,this.Wa=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Wr(Gr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Wr(Gr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new cs(t,n);return function(e,t){if(null===ys(e)){const n=vs(e);null!==n&&lf(0,n,t.field)}}(e,r),r}(e._query,this.Ka,this.Wa);return new ed(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new ds(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class sf extends ef{constructor(e,t,n){super(),this.type=e,this.Ga=t,this.za=n}_apply(e){return new ed(e.firestore,e.converter,_s(e._query,this.Ga,this.za))}}class of extends ef{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){const t=cf(e,this.type,this.Ha,this.Ja);return new ed(e.firestore,e.converter,function(e,t){return new ds(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class af extends ef{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){const t=cf(e,this.type,this.Ha,this.Ja);return new ed(e.firestore,e.converter,function(e,t){return new ds(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function cf(e,t,n,r){if(n[0]=(0,k.m9)(n[0]),n[0]instanceof Kd)return function(e,t,n,r,i){if(!r)throw new Wr(Gr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const o of Is(e))if(o.field.isKeyField())s.push(Mi(t,r.key));else{const e=r.data.field(o.field);if(_i(e))throw new Wr(Gr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new Wr(Gr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new os(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Ed(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Wr(Gr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let c=0;c<i.length;c++){const s=i[c];if(o[c].field.isKeyField()){if("string"!=typeof s)throw new Wr(Gr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof s}`);if(!ws(e)&&-1!==s.indexOf("/"))throw new Wr(Gr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${r}() must be a plain document ID, but '${s}' contains a slash.`);const n=e.path.child(fi.fromString(s));if(!Ai.isDocumentKey(n))throw new Wr(Gr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Ai(n);a.push(Mi(t,i))}else{const e=Od(n,r,s);a.push(e)}}return new os(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function uf(e,t,n){if("string"==typeof(n=(0,k.m9)(n))){if(""===n)throw new Wr(Gr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ws(t)&&-1!==n.indexOf("/"))throw new Wr(Gr.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(fi.fromString(n));if(!Ai.isDocumentKey(r))throw new Wr(Gr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Mi(e,new Ai(r))}if(n instanceof Zl)return Mi(e,n._key);throw new Wr(Gr.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Hl(n)}.`)}function hf(e,t){if(!Array.isArray(e)||0===e.length)throw new Wr(Gr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new Wr(Gr.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function lf(e,t,n){if(!n.isEqual(t))throw new Wr(Gr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class df{convertValue(e,t="none"){switch(Ci(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ii(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ti(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw zr()}}convertObject(e,t){const n={};return hi(e.fields,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new yd(Ii(e.latitude),Ii(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=bi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ei(e));default:return null}}convertTimestamp(e){const t=wi(e);return new ai(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=fi.fromString(e);Kr(ga(n));const r=new jl(n.get(1),n.get(3)),i=new Ai(n.popFirst(5));return r.isEqual(t)||qr(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function ff(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class pf extends df{constructor(e){super(),this.firestore=e}convertBytes(e){return new gd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Zl(this.firestore,null,t)}}class gf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ed(e)}set(e,t,n){this._verifyNotCommitted();const r=mf(e,this._firestore),i=ff(r.converter,t,n),s=Sd(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Gs.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=mf(e,this._firestore);let s;return s="string"==typeof(t=(0,k.m9)(t))||t instanceof pd?xd(this._dataReader,"WriteBatch.update",i._key,t,n,r):Pd(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Gs.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=mf(e,this._firestore);return this._mutations=this._mutations.concat(new so(t._key,Gs.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Wr(Gr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function mf(e,t){if((e=(0,k.m9)(e)).firestore!==t)throw new Wr(Gr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class yf extends df{constructor(e){super(),this.firestore=e}convertBytes(e){return new gd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Zl(this.firestore,null,t)}}function vf(e,t,n){e=Ql(e,Zl);const r=Ql(e.firestore,ud),i=ff(e.converter,t,n);return Tf(r,[Sd(Ed(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Gs.none())])}function wf(e,t,n,...r){e=Ql(e,Zl);const i=Ql(e.firestore,ud),s=Ed(i);let o;return o="string"==typeof(t=(0,k.m9)(t))||t instanceof pd?xd(s,"updateDoc",e._key,t,n,r):Pd(s,"updateDoc",e._key,t),Tf(i,[o.toMutation(e._key,Gs.exists(!0))])}function If(e,...t){var n,r,i;e=(0,k.m9)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||ad(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(ad(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,h;if(e instanceof Zl)u=Ql(e.firestore,ud),h=ps(e._key.path),c={next:n=>{t[o]&&t[o](_f(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Ql(e,ed);u=Ql(n.firestore,ud),h=n._query;const r=new yf(u);c={next:e=>{t[o]&&t[o](new Jd(u,r,n,e))},error:t[o+1],complete:t[o+2]},Zd(e._query)}return function(e,t,n,r){const i=new Sl(r),s=new Lh(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>Rh(await Ul(e),s)),()=>{i.Xo(),e.asyncQueue.enqueueAndForget(async()=>Dh(await Ul(e),s))}}(hd(u),h,a,c)}function Tf(e,t){return function(e,t){const n=new Hr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=wl(e);try{const e=await function(e,t){const n=$r(e),r=ai.now(),i=t.reduce((e,t)=>e.add(t.key),So());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>n.Qn.Pn(e,i).next(i=>{s=i;const o=[];for(const e of t){const t=Ys(e,s.get(e.key));null!=t&&o.push(new to(e.key,t,Ki(t.value.mapValue),Gs.exists(!0)))}return n.In.addMutationBatch(e,r,o,t)})).then(e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Lo[e.currentUser.toKey()];r||(r=new fo(ii)),r=r.insert(t,n),e.Lo[e.currentUser.toKey()]=r}(r,e.batchId,n),await al(r,e.changes),await lh(r.remoteStore)}catch(e){const t=Eh(e,"Failed to persist write");n.reject(t)}}(await Fl(e),t,n)),n.promise}(hd(e),t)}function _f(e,t,n){const r=n.docs.get(t._key),i=new yf(e);return new Hd(e,i,t._key,r,new Wd(n.hasPendingWrites,n.fromCache),t.converter)}class bf extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ed(e)}get(e){const t=mf(e,this._firestore),n=new pf(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return zr();const r=e[0];if(r.isFoundDocument())return new Kd(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Kd(this._firestore,n,t._key,null,t.converter);throw zr()})}set(e,t,n){const r=mf(e,this._firestore),i=ff(r.converter,t,n),s=Sd(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=mf(e,this._firestore);let s;return s="string"==typeof(t=(0,k.m9)(t))||t instanceof pd?xd(this._dataReader,"Transaction.update",i._key,t,n,r):Pd(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=mf(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=mf(e,this._firestore),n=new yf(this._firestore);return super.get(e).then(e=>new Hd(this._firestore,n,t._key,e._document,new Wd(!1,!1),t.converter))}}function Ef(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Wr("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function Sf(){if("undefined"==typeof Uint8Array)throw new Wr("unimplemented","Uint8Arrays are not available in this environment.")}function kf(){if("undefined"==typeof atob)throw new Wr("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e){Mr=e}(b.SDK_VERSION),(0,b._registerComponent)(new E.wA("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new ud(n,new Xr(e.getProvider("auth-internal")));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),(0,b.registerVersion)(Or,"3.1.1",void 0),(0,b.registerVersion)(Or,"3.1.1","esm2017");class Nf{constructor(e){this._delegate=e}static fromBase64String(e){return kf(),new Nf(gd.fromBase64String(e))}static fromUint8Array(e){return Sf(),new Nf(gd.fromUint8Array(e))}toBase64(){return kf(),this._delegate.toBase64()}toUint8Array(){return Sf(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Af(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class Cf{enableIndexedDbPersistence(e,t){return function(e,t){fd(e=Ql(e,ud));const n=hd(e),r=e._freezeSettings(),i=new bl;return dd(n,i,new Tl(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){fd(e=Ql(e,ud));const t=hd(e),n=e._freezeSettings(),r=new bl;return dd(t,r,new _l(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Wr(Gr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Hr;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!Ba.bt())return Promise.resolve();const t=e+"main";await Ba.delete(t)}(Xc(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class Rf{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof jl||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Br("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;const s=(e=Ql(e,Xl))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&Br("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Lr.MOCK_USER;else{t=(0,k.Sg)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Wr(Gr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Lr(s)}e._credentials=new Yr(new Qr(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue(async()=>{const t=await Ol(e),n=await Ml(e);return t.setNetworkEnabled(!0),function(e){const t=$r(e);return t.Kr.delete(0),Ju(t)}(n)})}(hd(e=Ql(e,ud)))}(this._delegate)}disableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue(async()=>{const t=await Ol(e),n=await Ml(e);return t.setNetworkEnabled(!1),async function(e){const t=$r(e);t.Kr.add(0),await Yu(t),t.Wr.set("Offline")}(n)})}(hd(e=Ql(e,ud)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,$l("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){return function(e){const t=new Hr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=$r(e);ih(n.remoteStore)||Vr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=$r(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.In.getHighestUnacknowledgedBatchId(e))}(n.localStore);if(-1===e)return void t.resolve();const r=n.Bo.get(e)||[];r.push(t),n.Bo.set(e,r)}catch(e){const n=Eh(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Fl(e),t)),t.promise}(hd(e=Ql(e,ud)))}(this._delegate)}onSnapshotsInSync(e){return function(e,t){return function(e,t){const n=new Sl(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){$r(e).Zr.add(t),t.next()}(await Ul(e),n)),()=>{n.Xo(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){$r(e).Zr.delete(t)}(await Ul(e),n))}}(hd(e=Ql(e,ud)),ad(t)?t:{next:t})}(this._delegate,e)}get app(){if(!this._appCompat)throw new Wr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Kf(this,nd(this._delegate,e))}catch(t){throw Mf(t,"collection()","Firestore.collection()")}}doc(e){try{return new Lf(this,rd(this._delegate,e))}catch(t){throw Mf(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Bf(this,function(e,t){if(e=Ql(e,Xl),Kl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Wr(Gr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ed(e,null,function(e){return new ds(fi.emptyPath(),e)}(t))}(this._delegate,e))}catch(t){throw Mf(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t){return function(e,t){const n=new Hr;return e.asyncQueue.enqueueAndForget(async()=>{const r=await function(e){return xl(e).then(e=>e.datastore)}(e);new Al(e.asyncQueue,r,t,n).run()}),n.promise}(hd(e),n=>t(new bf(e,n)))}(this._delegate,t=>e(new Pf(this,t)))}batch(){return hd(this._delegate),new xf(new gf(this._delegate,e=>Tf(this._delegate,e)))}loadBundle(e){return function(e,t){const n=hd(e=Ql(e,ud)),r=new cd;return function(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new kl(e,t)}(function(e,t){if(e instanceof Uint8Array)return El(e,t);if(e instanceof ArrayBuffer)return El(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,ju(t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=$r(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=$r(e),r=zo(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Je.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}(e.localStore,r))return await t.close(),void n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r));n._updateProgress(Vh(r));const i=new Uh(r,e.localStore,t.N);let s=await t.Qo();for(;s;){const e=await i.fo(s);e&&n._updateProgress(e),s=await t.Qo()}const o=await i.complete();await al(e,o.En,void 0),await function(e,t){const n=$r(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Je.saveBundleMetadata(e,t))}(e.localStore,r),n._completeWith(o.progress)}catch(e){Br("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e)}})(r,t,n).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(await Fl(e),i,r)})}(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return function(e,t){return function(e,t){return e.asyncQueue.enqueue(async()=>function(e,t){const n=$r(e);return n.persistence.runTransaction("Get named query","readonly",e=>n.Je.getNamedQuery(e,t))}(await Ll(e),t))}(hd(e=Ql(e,ud)),t).then(t=>t?new ed(e,null,t.query):null)}(this._delegate,e).then(e=>e?new Bf(this,e):null)}}class Df extends df{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nf(new gd(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Lf.forKey(t,this.firestore,null)}}class Pf{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Df(e)}get(e){const t=$f(e);return this._delegate.get(t).then(e=>new Vf(this._firestore,new Hd(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){const r=$f(e);return n?(Ef("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=$f(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=$f(e);return this._delegate.delete(t),this}}class xf{constructor(e){this._delegate=e}set(e,t,n){const r=$f(e);return n?(Ef("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=$f(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=$f(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Of{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Qd(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new qf(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Of.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Of(e,new Df(e),t),r.set(t,i)),i}}Of.INSTANCES=new WeakMap;class Lf{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Df(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Wr("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Lf(t,new Zl(t._delegate,n,new Ai(e)))}static forKey(e,t,n){return new Lf(t,new Zl(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Kf(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Kf(this.firestore,nd(this._delegate,e))}catch(t){throw Mf(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,k.m9)(e))instanceof Zl&&id(this._delegate,e)}set(e,t){t=Ef("DocumentReference.set",t);try{return t?vf(this._delegate,e,t):vf(this._delegate,e)}catch(n){throw Mf(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?wf(this._delegate,e):wf(this._delegate,e,t,...n)}catch(r){throw Mf(r,"updateDoc()","DocumentReference.update()")}}delete(){return function(e){return Tf(Ql(e.firestore,ud),[new so(e._key,Gs.none())])}(this._delegate)}onSnapshot(...e){const t=Ff(e),n=Uf(e,e=>new Vf(this.firestore,new Hd(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return If(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Ql(e,Zl);const t=Ql(e.firestore,ud),n=hd(t),r=new yf(t);return function(e,t){const n=new Hr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(e,t){const n=$r(e);return n.persistence.runTransaction("read document","readonly",e=>n.Qn.An(e,t))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Wr(Gr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Eh(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Ll(e),t,n)),n.promise}(n,e._key).then(n=>new Hd(t,r,e._key,n,new Wd(null!==n&&n.hasLocalMutations,!0),e.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Ql(e,Zl);const t=Ql(e.firestore,ud);return Vl(hd(t),e._key,{source:"server"}).then(n=>_f(t,e,n))}(this._delegate):function(e){e=Ql(e,Zl);const t=Ql(e.firestore,ud);return Vl(hd(t),e._key).then(n=>_f(t,e,n))}(this._delegate),t.then(e=>new Vf(this.firestore,new Hd(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new Lf(this.firestore,this._delegate.withConverter(e?Of.getInstance(this.firestore,e):null))}}function Mf(e,t,n){return e.message=e.message.replace(t,n),e}function Ff(e){for(const t of e)if("object"==typeof t&&!Af(t))return t;return{}}function Uf(e,t){var n,r;let i;return i=Af(e[0])?e[0]:Af(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Vf{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Lf(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Xd(this._delegate,e._delegate)}}class qf extends Vf{data(e){const t=this._delegate.data(e);return function(e,t){e||zr()}(void 0!==t),t}}class Bf{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Df(e)}where(e,t,n){try{return new Bf(this.firestore,tf(this._delegate,function(e,t,n){const r=t,i=Gd("where",e);return new nf(i,r,n)}(e,t,n)))}catch(r){throw Mf(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Bf(this.firestore,tf(this._delegate,function(e,t="asc"){const n=t,r=Gd("orderBy",e);return new rf(r,n)}(e,t)))}catch(n){throw Mf(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Bf(this.firestore,tf(this._delegate,function(e){return Jl("limit",e),new sf("limit",e,"F")}(e)))}catch(t){throw Mf(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Bf(this.firestore,tf(this._delegate,function(e){return Jl("limitToLast",e),new sf("limitToLast",e,"L")}(e)))}catch(t){throw Mf(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Bf(this.firestore,tf(this._delegate,function(...e){return new of("startAt",e,!0)}(...e)))}catch(t){throw Mf(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Bf(this.firestore,tf(this._delegate,function(...e){return new of("startAfter",e,!1)}(...e)))}catch(t){throw Mf(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Bf(this.firestore,tf(this._delegate,function(...e){return new af("endBefore",e,!0)}(...e)))}catch(t){throw Mf(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Bf(this.firestore,tf(this._delegate,function(...e){return new af("endAt",e,!1)}(...e)))}catch(t){throw Mf(t,"endAt()","Query.endAt()")}}isEqual(e){return sd(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Ql(e,ed);const t=Ql(e.firestore,ud),n=hd(t),r=new yf(t);return function(e,t){const n=new Hr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await lu(e,t,!0),i=new jh(t,r.Gn),s=i.Io(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=Eh(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Ll(e),t,n)),n.promise}(n,e._query).then(n=>new Jd(t,r,e,n))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Ql(e,ed);const t=Ql(e.firestore,ud),n=hd(t),r=new yf(t);return ql(n,e._query,{source:"server"}).then(n=>new Jd(t,r,e,n))}(this._delegate):function(e){e=Ql(e,ed);const t=Ql(e.firestore,ud),n=hd(t),r=new yf(t);return Zd(e._query),ql(n,e._query).then(n=>new Jd(t,r,e,n))}(this._delegate),t.then(e=>new zf(this.firestore,new Jd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){const t=Ff(e),n=Uf(e,e=>new zf(this.firestore,new Jd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return If(this._delegate,t,n)}withConverter(e){return new Bf(this.firestore,this._delegate.withConverter(e?Of.getInstance(this.firestore,e):null))}}class jf{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new qf(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class zf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Bf(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new qf(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new jf(this._firestore,e))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new qf(this._firestore,n))})}isEqual(e){return Xd(this._delegate,e._delegate)}}class Kf extends Bf{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Lf(this.firestore,e):null}doc(e){try{return new Lf(this.firestore,void 0===e?rd(this._delegate):rd(this._delegate,e))}catch(t){throw Mf(t,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Ql(e.firestore,ud),r=rd(e),i=ff(e.converter,t);return Tf(n,[Sd(Ed(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Gs.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new Lf(this.firestore,e))}isEqual(e){return id(this._delegate,e._delegate)}withConverter(e){return new Kf(this.firestore,this._delegate.withConverter(e?Of.getInstance(this.firestore,e):null))}}function $f(e){return Ql(e,Zl)}class Gf{constructor(...e){this._delegate=new pd(...e)}static documentId(){return new Gf(gi.keyField().canonicalString())}isEqual(e){return(e=(0,k.m9)(e))instanceof pd&&this._delegate._internalPath.isEqual(e._internalPath)}}class Wf{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Ad("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Wf(e)}static delete(){const e=new kd("deleteField");return e._methodName="FieldValue.delete",new Wf(e)}static arrayUnion(...e){const t=function(...e){return new Cd("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Wf(t)}static arrayRemove(...e){const t=function(...e){return new Rd("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Wf(t)}static increment(e){const t=function(e){return new Dd("increment",e)}(e);return t._methodName="FieldValue.increment",new Wf(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Hf={Firestore:Rf,GeoPoint:yd,Timestamp:ai,Blob:Nf,Transaction:Pf,WriteBatch:xf,DocumentReference:Lf,DocumentSnapshot:Vf,Query:Bf,QueryDocumentSnapshot:qf,QuerySnapshot:zf,CollectionReference:Kf,FieldPath:Gf,FieldValue:Wf,setLogLevel:function(e){!function(e){Fr.setLogLevel(e)}(e)},CACHE_SIZE_UNLIMITED:-1};var Qf;(Qf=_.Z).INTERNAL.registerComponent(new E.wA("firestore-compat",e=>{return t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate(),new Rf(t,n,new Cf);var t,n},"PUBLIC").setServiceProps(Object.assign({},Hf))),Qf.registerVersion("@firebase/firestore-compat","0.1.4");var Jf=n(8006),Yf=n(2965);function Xf(e,t){return function(e,t=o.z){return new a.y(n=>{let r;return null!=t?t.schedule(()=>{r=e.onSnapshot({includeMetadataChanges:!0},n)}):r=e.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(e,t)}function Zf(e,t){return Xf(e,t).pipe((0,i.U)(e=>({payload:e,type:"query"})))}function ep(e,t){return Zf(e,t).pipe((0,l.O)(void 0),f(),(0,i.U)(([e,t])=>{const n=t.payload.docChanges(),r=n.map(e=>({type:e.type,payload:e}));return e&&JSON.stringify(e.payload.metadata)!==JSON.stringify(t.payload.metadata)&&t.payload.docs.forEach((t,i)=>{const s=n.find(e=>e.doc.ref.isEqual(t.ref)),o=null==e?void 0:e.payload.docs.find(e=>e.ref.isEqual(t.ref));s&&JSON.stringify(s.doc.metadata)===JSON.stringify(t.metadata)||!s&&o&&JSON.stringify(o.metadata)===JSON.stringify(t.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:t}})}),r}))}function tp(e,t,n){return ep(e,n).pipe((0,y.R)((e,n)=>function(e,t,n){return t.forEach(t=>{n.indexOf(t.type)>-1&&(e=function(e,t){switch(t.type){case"added":if(!e[t.newIndex]||!e[t.newIndex].doc.ref.isEqual(t.doc.ref))return np(e,t.newIndex,0,t);break;case"modified":if(null==e[t.oldIndex]||e[t.oldIndex].doc.ref.isEqual(t.doc.ref)){if(t.oldIndex!==t.newIndex){const n=e.slice();return n.splice(t.oldIndex,1),n.splice(t.newIndex,0,t),n}return np(e,t.newIndex,1,t)}break;case"removed":if(e[t.oldIndex]&&e[t.oldIndex].doc.ref.isEqual(t.doc.ref))return np(e,t.oldIndex,1)}return e}(e,t))}),e}(e,n.map(e=>e.payload),t),[]),(0,v.x)(),(0,i.U)(e=>e.map(e=>({type:e.type,payload:e}))))}function np(e,t,n,...r){const i=e.slice();return i.splice(t,n,...r),i}function rp(e){return e&&0!==e.length||(e=["added","removed","modified"]),e}n(7841);class ip{constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=ep(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,i.U)(t=>t.filter(t=>e.indexOf(t.type)>-1)))),t.pipe((0,l.O)(void 0),f(),(0,w.h)(([e,t])=>t.length>0||!e),(0,i.U)(([e,t])=>t),h.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,y.R)((e,t)=>[...e,...t],[]))}snapshotChanges(e){const t=rp(e);return tp(this.query,t,this.afs.schedulers.outsideAngular).pipe(h.iC)}valueChanges(e={}){return Zf(this.query,this.afs.schedulers.outsideAngular).pipe((0,i.U)(t=>t.payload.docs.map(t=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data())),h.iC)}get(e){return(0,c.D)(this.query.get(e)).pipe(h.iC)}add(e){return this.ref.add(e)}doc(e){return new sp(this.ref.doc(e),this.afs)}}class sp{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:r,query:i}=lp(n,t);return new ip(r,i,this.afs)}snapshotChanges(){return Xf(this.ref,this.afs.schedulers.outsideAngular).pipe((0,l.O)(void 0),f(),(0,i.U)(([e,t])=>t.exists?(null==e?void 0:e.exists)?{payload:t,type:"modified"}:{payload:t,type:"added"}:{payload:t,type:"removed"})).pipe(h.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,i.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,c.D)(this.ref.get(e)).pipe(h.iC)}}class op{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ep(this.query,this.afs.schedulers.outsideAngular).pipe((0,i.U)(t=>t.filter(t=>e.indexOf(t.type)>-1)),(0,w.h)(e=>e.length>0),h.iC):ep(this.query,this.afs.schedulers.outsideAngular).pipe(h.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,y.R)((e,t)=>[...e,...t],[]))}snapshotChanges(e){const t=rp(e);return tp(this.query,t,this.afs.schedulers.outsideAngular).pipe(h.iC)}valueChanges(e={}){return Zf(this.query,this.afs.schedulers.outsideAngular).pipe((0,i.U)(t=>t.payload.docs.map(t=>e.idField?Object.assign({[e.idField]:t.id},t.data()):t.data())),h.iC)}get(e){return(0,c.D)(this.query.get(e)).pipe(h.iC)}}const ap=new s.OlP("angularfire2.enableFirestorePersistence"),cp=new s.OlP("angularfire2.firestore.persistenceSettings"),up=new s.OlP("angularfire2.firestore.settings"),hp=new s.OlP("angularfire2.firestore.use-emulator");function lp(e,t=(e=>e)){return{query:t(e),ref:e}}let dp=(()=>{class e{constructor(e,t,n,r,i,s,o,a,h,l,d,f,p,g,m,y,v){this.schedulers=o;const w=(0,I.on)(e,s,t),_=h;l&&(0,Jf.nw)(w,s,d,p,g,m,f,y),[this.firestore,this.persistenceEnabled$]=(0,I.cc)(`${w.name}.firestore`,"AngularFirestore",w.name,()=>{const e=s.runOutsideAngular(()=>w.firestore());if(r&&e.settings(r),_&&e.useEmulator(..._),n&&!(0,T.PM)(i)){const t=()=>{try{return(0,c.D)(e.enablePersistence(a||void 0).then(()=>!0,()=>!1))}catch(t){return"undefined"!=typeof console&&console.warn(t),(0,u.of)(!1)}};return[e,s.runOutsideAngular(t)]}return[e,(0,u.of)(!1)]},[r,_,n])}collection(e,t){let n;n="string"==typeof e?this.firestore.collection(e):e;const{ref:r,query:i}=lp(n,t),s=this.schedulers.ngZone.run(()=>r);return new ip(s,i,this)}collectionGroup(e,t){const n=t||(e=>e),r=this.firestore.collectionGroup(e);return new op(n(r),this)}doc(e){let t;t="string"==typeof e?this.firestore.doc(e):e;const n=this.schedulers.ngZone.run(()=>t);return new sp(n,this)}createId(){return this.firestore.collection("_").doc().id}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(I.Dh),s.LFG(I.xv,8),s.LFG(ap,8),s.LFG(up,8),s.LFG(s.Lbi),s.LFG(s.R0b),s.LFG(h.HU),s.LFG(cp,8),s.LFG(hp,8),s.LFG(Jf.zQ,8),s.LFG(Jf.Qv,8),s.LFG(Jf.L6,8),s.LFG(Jf._Q,8),s.LFG(Jf.rT,8),s.LFG(Jf.lh,8),s.LFG(Jf.f7,8),s.LFG(Yf.nm,8))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"any"}),e})(),fp=(()=>{class e{constructor(e){this.bd=e,this.pathOfCollection="users",this.referenceToCollection=this.bd.collection(this.pathOfCollection,e=>e.orderBy("fecha_creacion","asc"))}createOne(e){return(0,r.mG)(this,void 0,void 0,function*(){try{return e.id=this.bd.createId(),this.referenceToCollection.doc(e.id).set(Object.assign({},e))}catch(t){}})}getDuenios(){return this.getByPerfil("DUENIO")}getSupervisores(){return this.getByPerfil("SUPERVISOR")}getClientes(){return this.getByPerfil("CLIENTE")}getEmpleados(){return this.getByPerfil("EMPLEADO")}getAnonimos(){return this.getByPerfil("ANONIMO")}getByPerfil(e){try{return this.getAll().pipe((0,i.U)(t=>t.filter(t=>t.perfil.includes(e))))}catch(t){}}getAll(){try{return this.referenceToCollection.snapshotChanges().pipe((0,i.U)(e=>e.map(e=>e.payload.doc.data())))}catch(e){}}getByEmail(e){try{return this.getAll().pipe((0,i.U)(t=>t.find(t=>t.correo==e)))}catch(t){}}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(dp))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);